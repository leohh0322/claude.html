<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>í†µí•© ê·¼íƒœ ë¶„ì„ ì‹œìŠ¤í…œ</title><script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script><script src="https://cdn.tailwindcss.com"></script><style> @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap');body{font-family:'Noto Sans KR',sans-serif;background:#f4f7fa}.view{display:none}.view.active{display:block}.month-tabs{display:flex;gap:12px;margin-bottom:30px;padding:20px;background:white;border-radius:16px;box-shadow:0 2px 8px rgba(0,0,0,0.05);flex-wrap:wrap}.month-tab{padding:12px 24px;border-radius:10px;background:#f1f5f9;color:#64748b;border:2px solid transparent;cursor:pointer;font-weight:600;transition:all 0.3s ease;font-size:14px}.month-tab:hover{background:#e2e8f0;transform:translateY(-2px)}.month-tab.active{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border-color:#667eea;box-shadow:0 4px 12px rgba(102,126,234,0.4)}.month-tab.loading{opacity:0.6;cursor:wait}.month-tab.disabled{background:#e5e7eb;color:#9ca3af;cursor:not-allowed;opacity:0.5}.month-tab.disabled:hover{background:#e5e7eb;transform:none}.view-tabs{display:flex;gap:8px;margin-bottom:20px;padding:16px 20px;background:white;border-radius:12px;box-shadow:0 1px 4px rgba(0,0,0,0.05)}.view-tab{padding:10px 20px;border-radius:8px;background:#f8fafc;color:#64748b;border:2px solid transparent;cursor:pointer;font-weight:600;transition:all 0.3s ease;font-size:14px}.view-tab:hover{background:#e2e8f0}.view-tab.active{background:white;color:#667eea;border-color:#667eea;box-shadow:0 2px 8px rgba(102,126,234,0.15)}.member-view-content{display:none}.member-view-content.active{display:block}.stat-card{transition:all 0.3s ease;position:relative}.stat-card:hover{transform:translateY(-5px)}.stat-card.clickable{cursor:pointer}.member-list-popup{visibility:hidden;opacity:0;position:absolute;top:calc(100% + 10px);left:0;width:280px;max-height:350px;background:white;border-radius:12px;box-shadow:0 15px 35px rgba(0,0,0,0.2);z-index:100;padding:16px;border:1px solid #e2e8f0;overflow-y:auto;transition:opacity 0.2s ease,visibility 0.2s ease}.stat-card:hover .member-list-popup{visibility:visible;opacity:1}.member-list-popup::-webkit-scrollbar{width:6px}.member-list-popup::-webkit-scrollbar-thumb{background-color:#cbd5e1;border-radius:10px}.info-card{background:#f8fafc;border-radius:12px;padding:20px;transition:transform 0.2s;cursor:pointer;position:relative}.info-card:hover{transform:translateY(-3px);box-shadow:0 5px 15px rgba(0,0,0,0.05);background:#f1f5f9}.info-card::after{content:'ğŸ”';position:absolute;top:10px;right:10px;font-size:12px;opacity:0.3}.status-dot{display:inline-block;width:18px;height:18px;border-radius:50%;margin-right:8px;position:relative;cursor:help;transition:transform 0.2s}.status-dot:hover{transform:scale(1.3)}.status-dot.green{background-color:#10b981}.status-dot.red{background-color:#ef4444}.status-dot[data-tooltip]{position:relative}.status-dot[data-tooltip]::after{content:attr(data-tooltip);position:absolute;bottom:calc(100% + 10px);left:0;transform:translateX(0);background:rgba(0,0,0,0.95);color:white;padding:10px 16px;border-radius:8px;font-size:13px;white-space:normal;max-width:300px;min-width:200px;opacity:0;pointer-events:none;transition:opacity 0.3s;z-index:1000;line-height:1.4;box-shadow:0 4px 12px rgba(0,0,0,0.3);text-align:left}.status-dot[data-tooltip]::before{content:'';position:absolute;bottom:calc(100% + 4px);left:20px;transform:translateX(0);border:6px solid transparent;border-top-color:rgba(0,0,0,0.9);opacity:0;pointer-events:none;transition:opacity 0.3s;z-index:1000}.status-dot[data-tooltip]:hover::after,.status-dot[data-tooltip]:hover::before{opacity:1}.analysis-tab{padding:8px 16px;border:none;background:none;color:#64748b;font-size:13px;font-weight:600;cursor:pointer;border-bottom:2px solid transparent;transition:all 0.3s ease}.analysis-tab:hover{color:#3b82f6}.analysis-tab.active{color:#3b82f6;border-bottom-color:#3b82f6}.analysis-tab-content{display:none}.analysis-tab-content.active{display:block}.page-footer{margin-top:60px;padding:30px 20px;background:#f8fafc;border-top:1px solid #e2e8f0;text-align:left}.footer-content{max-width:1400px;margin:0 auto;color:#64748b;font-size:13px;line-height:1.8}.no-issue-btn{display:inline-block;padding:8px 20px;margin:0 6px;background:linear-gradient(135deg,#10b981 0%,#059669 100%);color:white;border-radius:8px;font-weight:600;cursor:pointer;transition:all 0.3s;border:2px solid #059669;text-decoration:none}.no-issue-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(16,185,129,0.4)}.help-icon{display:inline-block;width:18px;height:18px;background:#94a3b8;color:white;border-radius:50%;text-align:center;line-height:18px;font-size:12px;font-weight:bold;cursor:pointer;position:relative;margin-left:4px;transition:all 0.3s}.help-icon::before{content:'';position:absolute;bottom:100%;left:50%;transform:translateX(-50%);width:40px;height:30px;pointer-events:auto}.help-icon:hover{background:#64748b;transform:scale(1.1)}.help-icon.active{background:#3b82f6;transform:scale(1.1)}.help-tooltip{visibility:hidden;opacity:0;position:absolute;bottom:25px;left:0;transform:translateX(0);background:#1e293b;color:white;padding:12px 16px;border-radius:8px;font-size:13px;white-space:normal;max-width:300px;min-width:200px;z-index:1000;transition:opacity 0.3s;box-shadow:0 4px 12px rgba(0,0,0,0.2);text-align:left;pointer-events:auto}.help-tooltip::after{content:'';position:absolute;top:100%;left:20px;transform:translateX(0);border:6px solid transparent;border-top-color:#1e293b}.help-icon:hover .help-tooltip{visibility:visible;opacity:1}.help-tooltip:hover{visibility:visible;opacity:1}.help-icon.active .help-tooltip{visibility:visible;opacity:1}.mail-link{color:#3b82f6;text-decoration:underline;font-weight:600}.mail-link:hover{color:#2563eb}.admin-view{display:none}.admin-view.active{display:block}.admin-header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:30px;border-radius:16px;margin-bottom:30px;box-shadow:0 10px 30px rgba(102,126,234,0.3)}.admin-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:30px}.admin-stat-card{background:white;padding:20px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);border-left:4px solid #10b981}.admin-stat-value{font-size:32px;font-weight:800;color:#1e293b;margin:10px 0}.admin-stat-label{font-size:12px;color:#64748b;text-transform:uppercase;font-weight:600}.admin-table{background:white;border-radius:12px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,0.1)}.admin-table table{width:100%;border-collapse:collapse}.admin-table th{background:#f8fafc;padding:15px;text-align:left;font-size:12px;font-weight:700;color:#475569;text-transform:uppercase;border-bottom:2px solid #e2e8f0}.admin-table td{padding:15px;border-bottom:1px solid #f1f5f9;color:#334155}.admin-table tr:hover{background:#f8fafc}.delete-btn{background:#ef4444;color:white;border:none;padding:6px 12px;border-radius:6px;cursor:pointer;font-size:12px;font-weight:600;transition:all 0.2s}.delete-btn:hover{background:#dc2626;transform:translateY(-1px)}.clear-all-btn{background:#f59e0b;color:white;border:none;padding:12px 24px;border-radius:8px;cursor:pointer;font-size:14px;font-weight:700;margin-bottom:20px;transition:all 0.3s}.clear-all-btn:hover{background:#d97706;transform:translateY(-2px);box-shadow:0 4px 12px rgba(245,158,11,0.4)}.label{font-size:12px;color:#64748b;font-weight:600;text-transform:uppercase;margin-bottom:5px}.value{font-size:24px;font-weight:800;color:#1e293b}.sub-value{font-size:13px;color:#94a3b8;margin-top:4px}.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:none;justify-content:center;align-items:center;z-index:1000;backdrop-filter:blur(4px)}.modal-content{background:white;width:90%;max-width:800px;border-radius:20px;padding:30px;position:relative;max-height:85vh;overflow-y:auto}.modal-close{position:absolute;top:20px;right:20px;font-size:24px;cursor:pointer;color:#64748b}.modal-title{font-size:20px;font-weight:700;margin-bottom:20px;color:#1e293b;border-bottom:2px solid #f1f5f9;padding-bottom:10px}.modal-chart-wrapper{height:350px;width:100%;margin-bottom:20px}.modal-list-wrapper{max-height:400px;overflow-y:auto;background:#f8fafc;border-radius:10px;padding:15px}.modal-list-item{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #e2e8f0;font-size:14px}.modal-list-item:last-child{border-bottom:none}.nav-button{position:fixed;top:20px;left:20px;background:white;color:#667eea;border:none;padding:10px 20px;border-radius:10px;font-weight:600;cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,0.15);transition:all 0.3s ease;z-index:999}.nav-button:hover{background:#667eea;color:white;transform:translateY(-2px);box-shadow:0 6px 16px rgba(0,0,0,0.2)}.header-button:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.15)}select{background:white;color:#1f2937}select option{color:#1f2937;background:white}.loading-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,0.9);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:9999}#ceoTeamChart{cursor:pointer}.team-chart-hint{font-size:14px;color:#94a3b8;text-align:center;margin-top:8px;font-style:italic}.loading-spinner{width:50px;height:50px;border:4px solid #f3f3f3;border-top:4px solid #667eea;border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.loading-text{margin-top:20px;font-size:18px;color:#1e293b;font-weight:600}.remain-vacation-card{background:linear-gradient(135deg,#06b6d4 0%,#0891b2 100%);border-radius:16px;padding:24px;color:white;margin-bottom:24px;box-shadow:0 4px 12px rgba(6,182,212,0.3)}.remain-vacation-card .label{color:rgba(255,255,255,0.9);font-size:14px;margin-bottom:8px}.remain-vacation-card .value{color:white;font-size:36px;font-weight:900}.remain-vacation-card .sub-value{color:rgba(255,255,255,0.8);font-size:14px;margin-top:8px}.password-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:10000;justify-content:center;align-items:center;backdrop-filter:blur(8px)}.password-modal.active{display:flex}.password-box{background:white;border-radius:20px;padding:40px;max-width:400px;width:90%;box-shadow:0 20px 60px rgba(0,0,0,0.3)}.password-title{font-size:24px;font-weight:700;color:#1e293b;margin-bottom:10px;text-align:center}.password-subtitle{font-size:14px;color:#64748b;margin-bottom:30px;text-align:center}.password-input{width:100%;padding:12px 16px;border:2px solid #e2e8f0;border-radius:10px;font-size:16px;transition:all 0.3s}.password-input:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,0.1)}.password-input.error{border-color:#ef4444;animation:shake 0.5s}@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-10px)}75%{transform:translateX(10px)}}.password-buttons{display:flex;gap:10px;margin-top:20px}.password-btn{flex:1;padding:12px;border:none;border-radius:10px;font-weight:600;cursor:pointer;transition:all 0.3s}.password-btn.submit{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white}.password-btn.submit:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(102,126,234,0.4)}.password-btn.cancel{background:#f1f5f9;color:#64748b}.password-btn.cancel:hover{background:#e2e8f0}.password-error{color:#ef4444;font-size:14px;margin-top:10px;text-align:center;display:none}.password-error.active{display:block}.lock-icon{font-size:48px;text-align:center;margin-bottom:20px}</style>
</head><body><div class="loading-overlay" id="loadingOverlay" style="display: none;"><div class="loading-spinner"></div><div class="loading-text" id="loadingText">Google Sheetsì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div><div class="loading-progress" id="loadingProgress" style="margin-top: 15px; font-size: 14px; color: #94a3b8;"></div></div><div class="password-modal active" id="passwordModal"><div class="password-box"><div class="lock-icon">ğŸ”’</div><div class="password-title" id="passwordTitle">ê·¼íƒœ ì‹œìŠ¤í…œ ë¡œê·¸ì¸</div><div class="password-subtitle" id="passwordSubtitle">ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì—¬ í˜ì´ì§€ì— ì ‘ê·¼í•˜ì„¸ìš”</div><input type="password" class="password-input" id="passwordInput" placeholder="ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" onkeypress="if(event.key==='Enter') verifyInitialPassword()" /><div class="password-error" id="passwordError">âŒ ì•”í˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤</div><div class="password-buttons"><button class="password-btn submit" id="loginButton" onclick="verifyInitialPassword()" style="width: 100%;">ë¡œê·¸ì¸</button></div></div></div><div id="memberView" class="view"><button class="nav-button" onclick="showView('ceo')">CEOìš©ìœ¼ë¡œ ì´ë™ â†’</button><div class="modal-overlay" id="memberModalOverlay"><div class="modal-content"><span class="modal-close" id="memberModalClose">&times;</span><div class="modal-title" id="memberModalTitle">ìƒì„¸ ë‚´ì—­</div><div class="modal-chart-wrapper"><canvas id="memberModalChart"></canvas></div><div class="modal-list-wrapper" id="memberModalList"></div></div></div><div class="p-6 md:p-10"><div class="mx-auto bg-white rounded-2xl shadow-lg overflow-hidden" style="max-width: 2000px;"><div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-8"><div class="flex flex-col md:flex-row md:items-center justify-between gap-6"><div style="min-width: 300px;"><h1 id="memberReportTitle" class="text-3xl font-bold mb-2" style="word-break: keep-all; white-space: normal;">ğŸ“Š ê·¼íƒœ ì •ì‚° ë¦¬í¬íŠ¸</h1><p class="opacity-90" style="font-size: 14px; line-height: 1.6;">ğŸ“… ë¦¬í¬íŠ¸ ì •ë³´ ê¸°ì¤€: ë§¤ì›” 1ì¼ ì˜¤ì „ 10ì‹œ ê¸°ì¤€(1ì¼ì´ ì£¼ë§ ë˜ëŠ” ê³µíœ´ì¼ì¼ ê²½ìš°ì—ëŠ” ì²«ë²ˆ ì§¸ ì›”ìš”ì¼ ì˜¤ì „ 10ì‹œ ê¸°ì¤€)<br>ğŸ“… ë¦¬í¬íŠ¸ ê³µìœ : ë§¤ì›” ì²«ì§¸ ì£¼ ìˆ˜ìš”ì¼<br>â° ë¬¸ì˜ ë§ˆê°: ë§¤ì›” ë‘˜ì§¸ ì£¼ ì›”ìš”ì¼ê¹Œì§€
                            </p></div><div class="flex items-center gap-4 bg-white bg-opacity-20 p-4 rounded-xl backdrop-blur-sm"><select id="memberUserSelect" disabled class="px-4 py-2.5 rounded-lg border-none font-medium bg-white text-gray-800"><option>ëŒ€ìƒì ì„ íƒ</option></select></div></div></div><div class="month-tabs" id="memberMonthTabs"><div class="month-tab active" data-month="9ì›”" onclick="memberSwitchMonth('9ì›”')">ğŸ“… 9ì›”</div><div class="month-tab" data-month="10ì›”" onclick="memberSwitchMonth('10ì›”')">ğŸ“… 10ì›”</div><div class="month-tab" data-month="11ì›”" onclick="memberSwitchMonth('11ì›”')">ğŸ“… 11ì›”</div><div class="month-tab" data-month="12ì›”" onclick="memberSwitchMonth('12ì›”')">ğŸ“… 12ì›”</div></div><div class="p-8"><div id="personalView" class="member-view-content active"><div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><div class="lg:col-span-2"><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"><div class="info-card blue" onclick="memberShowDetail('workDays')"><div class="label"><span class="status-dot green" data-tooltip="ì´ë²ˆ ë‹¬ì˜ ê³µíœ´ì¼ íœ´ë¬´ì¼ì„ ì œì™¸í•œ ê·¼ë¬´ì¼ì…ë‹ˆë‹¤."></span>ê·¼ë¬´ì¼</div><div class="value" id="member_val_workDays">-</div><div class="sub-value">ì¤‘ë³µ ì œì™¸ ê·¼ë¬´ ì¼ìˆ˜</div></div><div class="info-card blue"><div class="label"><span class="status-dot green" data-tooltip="ì¼ì¼ ê·¼ë¬´ì‹œê°„ X ê·¼ë¬´ì¼ì„ í•œ ì‹œê°„ì…ë‹ˆë‹¤."></span>ê¸°ì¤€ ê·¼ë¡œì‹œê°„</div><div class="value" id="member_val_stdHours">-</div><div class="sub-value">ê·¼ë¬´ì¼ Ã— 8ì‹œê°„</div></div><div class="info-card purple" onclick="memberShowDetail('totalHours')"><div class="label"><span class="status-dot green" id="total_status_dot"></span>ì´ ê·¼ë¬´ì‹œê°„</div><div class="value" id="member_val_totalHours">-</div><div class="sub-value">ì‹¤ì œ ê·¼ë¬´ í•©ê³„</div></div><div class="info-card red" onclick="memberShowDetail('overTime')"><div class="label"><span class="status-dot red" id="overtime_status_dot"></span>ì´ˆê³¼ ê·¼ë¬´</div><div class="value" id="member_val_overTime">-</div><div class="sub-value">ì´ ê·¼ë¬´ - ê¸°ì¤€ ì‹œê°„</div></div><div class="info-card green" onclick="memberShowDetail('vacation')"><div class="label"><span class="status-dot green" data-tooltip="ì´ë²ˆ ë‹¬ ì‚¬ìš©í•œ ì—°ì°¨ì…ë‹ˆë‹¤."></span>íœ´ê°€ ì‚¬ìš©</div><div class="value" id="member_val_vacation">-</div><div class="sub-value">ì´ë²ˆ ë‹¬ ì‚¬ìš©í•œ ì—°ì°¨</div></div><div class="info-card red" onclick="memberShowDetail('missing')"><div class="label"><span class="status-dot green" id="missing_status_dot"></span>ê¸°ë¡ ëˆ„ë½</div><div class="value" id="member_val_missing">-</div></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"><div class="info-card" onclick="memberShowDetail('avgIn')"><div class="label"><span class="status-dot green" id="avgin_status_dot"></span>í‰ê·  ì¶œê·¼ ì‹œê°</div><div class="value" id="member_val_avgIn">-</div></div><div class="info-card" onclick="memberShowDetail('avgOut')"><div class="label"><span class="status-dot green" id="avgout_status_dot"></span>í‰ê·  í‡´ê·¼ ì‹œê°</div><div class="value" id="member_val_avgOut">-</div></div></div><div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-6 mb-6 border border-indigo-200"><h3 class="text-lg font-bold text-indigo-800 mb-4 text-center">ğŸ“Š ì¡°ì§ ì „ì²´ í‰ê·  ì¶œí‡´ê·¼</h3><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="bg-white rounded-lg p-4 shadow-sm"><div class="text-sm text-green-600 font-semibold mb-2">ğŸŒ… í‰ê·  ì¶œê·¼ì‹œê°„</div><div class="text-2xl font-bold text-green-700" id="org_avg_in">-</div><div class="text-xs text-green-500 mt-1">ì¡°ì§ ì „ì²´ í‰ê· </div></div><div class="bg-white rounded-lg p-4 shadow-sm"><div class="text-sm text-purple-600 font-semibold mb-2">ğŸŒ† í‰ê·  í‡´ê·¼ì‹œê°„</div><div class="text-2xl font-bold text-purple-700" id="org_avg_out">-</div><div class="text-xs text-purple-500 mt-1">ì¡°ì§ ì „ì²´ í‰ê· </div></div></div></div><div class="bg-gradient-to-r from-blue-50 to-cyan-50 rounded-xl p-6 mb-6 border border-blue-200"><h3 class="text-lg font-bold text-blue-800 mb-4 text-center" id="dept_avg_title">ğŸ‘¥ ì†Œì† ë¶€ì„œ í‰ê·  ì¶œí‡´ê·¼</h3><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="bg-white rounded-lg p-4 shadow-sm"><div class="text-sm text-blue-600 font-semibold mb-2">ğŸŒ… í‰ê·  ì¶œê·¼ì‹œê°„</div><div class="text-2xl font-bold text-blue-700" id="dept_avg_in">-</div><div class="text-xs text-blue-500 mt-1" id="dept_avg_in_label">ë¶€ì„œ í‰ê· </div></div><div class="bg-white rounded-lg p-4 shadow-sm"><div class="text-sm text-cyan-600 font-semibold mb-2">ğŸŒ† í‰ê·  í‡´ê·¼ì‹œê°„</div><div class="text-2xl font-bold text-cyan-700" id="dept_avg_out">-</div><div class="text-xs text-cyan-500 mt-1" id="dept_avg_out_label">ë¶€ì„œ í‰ê· </div></div></div></div></div><div class="lg:col-span-1"><div class="remain-vacation-card"><div class="label">ğŸ’ ì”ì—¬ ì—°ì°¨</div><div class="value" id="member_val_remainVacation">-</div></div><div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl p-6 mb-6 border border-orange-200 shadow-md"><div class="text-sm text-orange-600 font-semibold mb-2">â±ï¸ í•˜ë£¨ í‰ê·  ê·¼ë¬´ì‹œê°„</div><div class="text-4xl font-bold text-orange-700" id="member_val_avgHoursPerDay">-</div></div><div class="bg-white rounded-xl p-6 shadow-md border border-gray-200"><div class="flex gap-2 mb-4 border-b border-gray-200"><button class="analysis-tab active" data-tab="overtime" onclick="switchAnalysisTab('overtime')">ğŸ“Š ì´ˆê³¼ê·¼ë¬´
                                    </button><button class="analysis-tab" data-tab="commute" onclick="switchAnalysisTab('commute')">ğŸ“ˆ ì¶œí‡´ê·¼ íŒ¨í„´
                                    </button></div><div id="tab-overtime" class="analysis-tab-content active"><h3 class="text-md font-bold text-gray-700 mb-3">ìš”ì¼ë³„ ì´ˆê³¼ê·¼ë¬´ íšŸìˆ˜</h3><div class="text-xs text-gray-500 mb-3">8ì‹œê°„ ì´ìƒ ê·¼ë¬´ (ì›”~ê¸ˆ)</div><div style="height: 200px;"><canvas id="weekdayOvertimeChart"></canvas></div></div><div id="tab-commute" class="analysis-tab-content" style="display: none;"><h3 class="text-md font-bold text-gray-700 mb-3">ìš”ì¼ë³„ í‰ê·  ì¶œí‡´ê·¼ ì‹œê°„</h3><div class="text-xs text-gray-500 mb-3">ì›”~ê¸ˆ í‰ê·  ì‹œê°„</div><div style="height: 200px; position: relative;"><canvas id="weekdayCommuteChart" style="width: 100% !important; height: 100% !important;"></canvas></div></div></div></div></div></div></div><div class="page-footer"><div class="footer-content"><p style="margin-bottom: 15px;">* ê·¼íƒœ ê¸°ë¡ ë¦¬í¬íŠ¸ì— ì´ìƒì´ ì—†ì„ ê²½ìš°, <button class="no-issue-btn" onclick="saveNoIssue('member')">ì´ìƒ ì—†ìŒ</button>ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
                        </p><p>* ê·¼íƒœ ê¸°ë¡ ê´€ë ¨ ë¬¸ì˜ ë°©ë²•
                            <span class="help-icon">?
                                <span class="help-tooltip">ê²½ì˜ì§€ì›íŒ€ Leoì—ê²Œ ë©”ì¼ë¡œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.<br><a href="https://mail.google.com/mail/?view=cm&fs=1&to=leo@ards.co.kr" target="_blank" class="mail-link">ì—¬ê¸°</a>ë¥¼ ëˆ„ë¥´ì‹œë©´ êµ¬ê¸€ ë©”ì¼ë¡œ ì—°ê²°ë©ë‹ˆë‹¤.
                                </span></span></p></div></div></div></div></div><div id="ceoView" class="view"><div class="modal-overlay" id="ceoVacationModalOverlay"><div class="modal-content"><span class="modal-close" id="ceoVacationModalClose">&times;</span><div class="modal-title" id="ceoVacationModalTitle">ğŸ–ï¸ íœ´ê°€ ì‚¬ìš© ìƒì„¸</div><div class="modal-list-wrapper" id="ceoVacationModalList"></div></div></div><div class="modal-overlay" id="ceoMissingModalOverlay"><div class="modal-content"><span class="modal-close" id="ceoMissingModalClose">&times;</span><div class="modal-title" id="ceoMissingModalTitle">âš ï¸ ê·¼ë¬´ ê¸°ë¡ ëˆ„ë½ ìƒì„¸</div><div class="modal-list-wrapper" id="ceoMissingModalList"></div></div></div><div class="modal-overlay" id="ceoTeamDetailModalOverlay"><div class="modal-content"><span class="modal-close" id="ceoTeamDetailModalClose">&times;</span><div class="modal-title" id="ceoTeamDetailModalTitle">ğŸ“Š ì¡°ì§ë³„ êµ¬ì„±ì› ì´ˆê³¼ê·¼ë¬´ í˜„í™©</div><div class="modal-list-wrapper" id="ceoTeamDetailModalList"></div></div></div><div class="p-6 md:p-10"><div class="mx-auto" style="max-width: 2000px;"><header class="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-6"><h1 class="text-3xl font-bold text-gray-800 flex items-center gap-3" style="min-width: 300px; word-break: keep-all; white-space: normal;"><span class="bg-blue-600 p-2 rounded-lg text-white text-xl">ğŸ“Š</span>ì „ì‚¬ ê·¼íƒœ ë¶„ì„ ëŒ€ì‹œë³´ë“œ
                    </h1><div class="flex gap-3"><button class="header-button" onclick="showView('member')" style="background: white; color: #667eea; border: 2px solid #667eea; padding: 10px 20px; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">â† êµ¬ì„±ì› í˜ì´ì§€</button><button class="header-button" onclick="showView('admin')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 10px 20px; border-radius: 10px; font-weight: 600; cursor: pointer; border: none; transition: all 0.3s ease;">ğŸ” ê´€ë¦¬ì í˜ì´ì§€</button></div></header><div class="month-tabs" id="ceoMonthTabs"><div class="month-tab active" data-month="9ì›”" onclick="ceoSwitchMonth('9ì›”')">ğŸ“… 9ì›”</div><div class="month-tab" data-month="10ì›”" onclick="ceoSwitchMonth('10ì›”')">ğŸ“… 10ì›”</div><div class="month-tab" data-month="11ì›”" onclick="ceoSwitchMonth('11ì›”')">ğŸ“… 11ì›”</div><div class="month-tab" data-month="12ì›”" onclick="ceoSwitchMonth('12ì›”')">ğŸ“… 12ì›”</div></div><div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"><div class="stat-card bg-white p-6 rounded-2xl shadow-sm border border-gray-100 cursor-pointer"><p class="text-sm font-medium text-gray-500 mb-1">ì´ ë¶„ì„ ì¸ì›</p><h3 id="ceo_stat_totalPeople" class="text-3xl font-bold text-gray-800">- ëª…</h3><div class="member-list-popup" id="ceoMemberPopup"><p class="text-xs font-bold text-blue-600 mb-3 border-b pb-2 sticky top-0 bg-white">ë¶„ì„ëœ êµ¬ì„±ì› ëª…ë‹¨</p><div id="ceoPopupNameList" class="space-y-2 text-sm text-gray-600"></div></div></div><div class="stat-card bg-white p-6 rounded-2xl shadow-sm border border-gray-100 border-l-4 border-l-red-500"><p class="text-sm font-medium text-gray-500 mb-1">ì´ ì´ˆê³¼ê·¼ë¬´ ì‹œê°„</p><h3 id="ceo_stat_totalOver" class="text-3xl font-bold text-red-600">- ì‹œê°„</h3></div><div class="stat-card clickable bg-white p-6 rounded-2xl shadow-sm border border-gray-100 border-l-4 border-l-amber-500" onclick="showCeoMissingModal()"><p class="text-sm font-medium text-gray-500 mb-1">âš ï¸ ê·¼ë¬´ ê¸°ë¡ ëˆ„ë½</p><h3 id="ceo_stat_missingCount" class="text-3xl font-bold text-amber-600">- ê±´</h3><p class="text-xs text-gray-400 mt-1">í´ë¦­í•˜ì—¬ ìƒì„¸ ë³´ê¸°</p></div><div class="stat-card clickable bg-white p-6 rounded-2xl shadow-sm border border-gray-100 border-l-4 border-l-green-500" onclick="showCeoVacationModal()"><p class="text-sm font-medium text-gray-500 mb-1">ğŸ–ï¸ ì´ íœ´ê°€ ì‚¬ìš©</p><h3 id="ceo_stat_totalVacation" class="text-3xl font-bold text-green-600">- ì¼</h3><p class="text-xs text-gray-400 mt-1">í´ë¦­í•˜ì—¬ ìƒì„¸ ë³´ê¸°</p></div></div><div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8"><div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100"><div class="flex justify-between items-center mb-6"><h3 class="text-xl font-bold text-gray-800 italic"># ì¡°ì§ë³„ ì´ˆê³¼ê·¼ë¬´ ë¹„ìœ¨</h3><span class="text-sm text-gray-400">ì „ì²´ 100% ê¸°ì¤€</span></div><div class="h-[300px] flex items-center justify-center"><canvas id="ceoTeamChart"></canvas></div><p class="team-chart-hint">ğŸ’¡ ì¡°ì§ì„ í´ë¦­í•˜ë©´ êµ¬ì„±ì› ìƒì„¸ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤</p></div><div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100"><div class="flex justify-between items-center mb-6"><h3 class="text-xl font-bold text-gray-800 italic"># ì¸ì›ë³„ ì´ˆê³¼ê·¼ë¬´ ë¹„ìœ¨</h3><span class="text-sm text-gray-400">ì „ì²´ 100% ê¸°ì¤€</span></div><div class="h-[300px] flex items-center justify-center"><canvas id="ceoDeptChart"></canvas></div></div><div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100"><h3 class="text-xl font-bold text-gray-800 mb-6 italic"># ì´ˆê³¼ê·¼ë¬´ Top 5 êµ¬ì„±ì›(ì›”)</h3><div id="ceoTopList" class="space-y-4"></div></div></div><div class="grid grid-cols-1 gap-8"><div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100"><h3 class="text-xl font-bold text-gray-800 mb-6 italic" id="ceoTrendChartTitle"># ì¡°ì§ë³„ í‰ê·  ê·¼ë¬´ ì‹œê°„</h3><div id="ceoTrendChartsContainer"></div></div></div></div></div></div><div id="adminView" class="admin-view"><div class="p-6 md:p-10"><div class="mx-auto" style="max-width: 2000px;"><div class="admin-header"><div class="flex items-center justify-between"><div style="min-width: 250px;"><h1 class="text-3xl font-bold mb-2" style="word-break: keep-all; white-space: normal;">ğŸ” ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1><p class="text-blue-100">ì´ìƒ ì—†ìŒ í™•ì¸ ê¸°ë¡ ê´€ë¦¬</p></div><div class="flex gap-3"><button class="header-button" onclick="showView('member')" style="background: white; color: #667eea; padding: 10px 20px; border-radius: 10px; font-weight: 600; cursor: pointer; border: 2px solid white; transition: all 0.3s ease;">â† êµ¬ì„±ì› í˜ì´ì§€</button><button class="header-button" onclick="showView('ceo')" style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; padding: 10px 20px; border-radius: 10px; font-weight: 600; cursor: pointer; border: none; transition: all 0.3s ease;">ğŸ“Š CEO í˜ì´ì§€</button></div></div></div><div style="margin: 20px 0; display: flex; align-items: center; gap: 10px;">
<label style="font-weight: 600; color: #64748b;">ğŸ“… ì›” ì„ íƒ:</label>
<select id="adminMonthSelect" onchange="adminFilterByMonth(this.value)" style="padding: 8px 16px; border: 2px solid #e2e8f0; border-radius: 8px; font-weight: 600; background: white; cursor: pointer; color: #1e293b;">
<option value="ì „ì²´">ì „ì²´</option>
<option value="9ì›”">9ì›”</option>
<option value="10ì›”">10ì›”</option>
<option value="11ì›”">11ì›”</option>
<option value="12ì›”">12ì›”</option>
</select>
</div>
<div class="admin-stats"><div class="admin-stat-card"><div class="admin-stat-label">ì´ í™•ì¸ ê±´ìˆ˜</div><div class="admin-stat-value" id="adminTotalCount">0</div><div style="font-size: 12px; color: #64748b; margin-top: 5px;">ì „ì²´ ì´ìƒ ì—†ìŒ í™•ì¸</div></div><div class="admin-stat-card"><div class="admin-stat-label">ì˜¤ëŠ˜ í™•ì¸ ê±´ìˆ˜</div><div class="admin-stat-value" id="adminTodayCount">0</div><div style="font-size: 12px; color: #64748b; margin-top: 5px;">ê¸ˆì¼ í™•ì¸ëœ ê¸°ë¡</div></div><div class="admin-stat-card"><div class="admin-stat-label">ìµœê·¼ í™•ì¸</div><div class="admin-stat-value" style="font-size: 18px;" id="adminLastCheck">-</div><div style="font-size: 12px; color: #64748b; margin-top: 5px;">ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°</div></div></div><div class="bg-white rounded-xl p-6 shadow-md"><div class="flex items-center justify-between mb-4"><h2 class="text-xl font-bold text-gray-800">ğŸ“‹ ì´ìƒ ì—†ìŒ í™•ì¸ ê¸°ë¡</h2><button class="clear-all-btn" onclick="adminClearAll()">ì „ì²´ ê¸°ë¡ ì‚­ì œ</button></div><div class="admin-table"><table><thead><tr><th>ë²ˆí˜¸</th><th>ì´ë¦„</th><th>ì›”</th><th>í™•ì¸ ì¼ì‹œ</th><th>í˜ì´ì§€</th><th>ì‘ì—…</th></tr></thead><tbody id="adminTableBody"><tr><td colspan="6" style="text-align: center; color: #94a3b8; padding: 40px;">ì•„ì§ í™•ì¸ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
                                    </td></tr></tbody></table></div></div></div></div></div><script>
  const SHEET_URLS = {
   '2025.09': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTxBvVil1szQqCeFl2qOVYnSSK16ZtlRlUji8sTtdgzAKLa4M73ngCHPHh2oewE-GAP5VQLsLV8f_wT/pub?gid=1760267560&single=true&output=csv',
   '2025.10': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTxBvVil1szQqCeFl2qOVYnSSK16ZtlRlUji8sTtdgzAKLa4M73ngCHPHh2oewE-GAP5VQLsLV8f_wT/pub?gid=1965095219&single=true&output=csv',
   '2025.11': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTxBvVil1szQqCeFl2qOVYnSSK16ZtlRlUji8sTtdgzAKLa4M73ngCHPHh2oewE-GAP5VQLsLV8f_wT/pub?gid=0&single=true&output=csv',
   '2025.12': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTxBvVil1szQqCeFl2qOVYnSSK16ZtlRlUji8sTtdgzAKLa4M73ngCHPHh2oewE-GAP5VQLsLV8f_wT/pub?gid=116479416&single=true&output=csv',
   'íœ´ê°€': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTxBvVil1szQqCeFl2qOVYnSSK16ZtlRlUji8sTtdgzAKLa4M73ngCHPHh2oewE-GAP5VQLsLV8f_wT/pub?gid=1588070847&single=true&output=csv',
   '9ì›”': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTxBvVil1szQqCeFl2qOVYnSSK16ZtlRlUji8sTtdgzAKLa4M73ngCHPHh2oewE-GAP5VQLsLV8f_wT/pub?gid=1760267560&single=true&output=csv',
   '10ì›”': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTxBvVil1szQqCeFl2qOVYnSSK16ZtlRlUji8sTtdgzAKLa4M73ngCHPHh2oewE-GAP5VQLsLV8f_wT/pub?gid=1965095219&single=true&output=csv',
   '11ì›”': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTxBvVil1szQqCeFl2qOVYnSSK16ZtlRlUji8sTtdgzAKLa4M73ngCHPHh2oewE-GAP5VQLsLV8f_wT/pub?gid=0&single=true&output=csv',
   '12ì›”': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTxBvVil1szQqCeFl2qOVYnSSK16ZtlRlUji8sTtdgzAKLa4M73ngCHPHh2oewE-GAP5VQLsLV8f_wT/pub?gid=116479416&single=true&output=csv'
  };
  const ADMIN_PASSWORD = "admin2025";
  const MEMBER_SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTxBvVil1szQqCeFl2qOVYnSSK16ZtlRlUji8sTtdgzAKLa4M73ngCHPHh2oewE-GAP5VQLsLV8f_wT/pub?gid=1780552814&single=true&output=csv";
  const MONTH_MAPPING = {
   '9ì›”': '2025.09',
   '10ì›”': '2025.10',
   '11ì›”': '2025.11',
   '12ì›”': '2025.12'
  };
  function getSheetKeyForMonth(month) {
   return MONTH_MAPPING[month] || month;
  }
  let memberInfoData = null;
  let userAvailableMonths = [];
  async function loadMemberInfo() {
   if (memberInfoData) return memberInfoData;
   try {
    const response = await fetch(MEMBER_SHEET_URL);
    const text = await response.text();
    const parsed = Papa.parse(text, { header: true, skipEmptyLines: true });
    memberInfoData = parsed.data;
    return memberInfoData;
   } catch (error) {
    return [];
   }
  }
  const USER_PASSWORDS = {
  };
  function formatBirthdate(birthdate) {
   if (!birthdate) return null;
   const cleaned = String(birthdate).replace(/[^0-9]/g, '');
   if (cleaned.length === 8) {
    return cleaned.slice(2);
   }
   else if (cleaned.length === 6) {
    return cleaned;
   }
   return null;
  }
  async function getDefaultPassword(userKey) {
   const [name, compName] = userKey.split('|');
   if (!memberInfoData) {
    await loadMemberInfo();
   }
   if (memberInfoData) {
    const member = memberInfoData.find(m =>
     m['ì´ë¦„'] === name && (m['íšŒì‚¬ë‚´ ì´ë¦„'] || '') === compName
    );
    if (member && member['ìƒë…„ì›”ì¼']) {
     const password = formatBirthdate(member['ìƒë…„ì›”ì¼']);
     if (password) {
      return password;
     }
    }
   }
   return compName || name;
  }
  async function getUserPassword(userKey) {
   return USER_PASSWORDS[userKey] || await getDefaultPassword(userKey);
  }
  const authSession = {
   admin: false,
   users: new Set()
  };
  let pendingUserKey = null;
  let pendingCallback = null;
  function openPasswordModal(userKey, callback, isCeoView = false) {
   pendingUserKey = userKey;
   pendingCallback = callback;
   const modal = document.getElementById('passwordModal');
   const title = document.getElementById('passwordTitle');
   const subtitle = document.getElementById('passwordSubtitle');
   const input = document.getElementById('passwordInput');
   const error = document.getElementById('passwordError');
   if (isCeoView) {
    title.innerText = 'ê´€ë¦¬ì ì¸ì¦';
    subtitle.innerText = 'CEO í˜ì´ì§€ì— ì ‘ê·¼í•˜ë ¤ë©´ ê´€ë¦¬ì ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”';
   } else {
    const [name, compName] = userKey.split('|');
    const displayName = compName ? `${name} (${compName})` : name;
    title.innerText = 'êµ¬ì„±ì› ì¸ì¦';
    subtitle.innerText = `${displayName}ì˜ í˜ì´ì§€ì— ì ‘ê·¼í•˜ë ¤ë©´ ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”`;
    if (!USER_PASSWORDS[userKey]) {
     const hint = document.createElement('div');
     hint.style.cssText = 'font-size: 12px; color: #94a3b8; margin-top: -20px; margin-bottom: 20px; text-align: center;';
     subtitle.parentNode.insertBefore(hint, subtitle.nextSibling);
    }
   }
   input.value = '';
   input.classList.remove('error');
   error.classList.remove('active');
   modal.classList.add('active');
   input.focus();
   input.onkeypress = (e) => {
    if (e.key === 'Enter') verifyPassword();
   };
  }
  function closePasswordModal() {
   const modal = document.getElementById('passwordModal');
   modal.classList.remove('active');
   pendingUserKey = null;
   pendingCallback = null;
  }
  async function verifyPassword() {
   const input = document.getElementById('passwordInput');
   const error = document.getElementById('passwordError');
   const enteredPassword = input.value.trim();
   if (!enteredPassword) {
    input.classList.add('error');
    error.innerText = 'âš ï¸ ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”';
    error.classList.add('active');
    return;
   }
   let isValid = false;
   if (enteredPassword === ADMIN_PASSWORD) {
    authSession.admin = true;
    isValid = true;
   }
   else if (pendingUserKey) {
    const correctPassword = await getUserPassword(pendingUserKey);
    if (enteredPassword === correctPassword) {
     authSession.users.add(pendingUserKey);
     isValid = true;
    }
   }
   if (isValid) {
    closePasswordModal();
    if (pendingCallback) {
     pendingCallback();
    }
   } else {
    input.classList.add('error');
    input.value = '';
    error.innerText = 'âŒ ì•”í˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤';
    error.classList.add('active');
    setTimeout(() => {
     input.classList.remove('error');
    }, 500);
   }
  }
  function hasAccess(userKey) {
   return authSession.admin || authSession.users.has(userKey);
  }
  function hasAdminAccess() {
   return authSession.admin;
  }
  async function verifyInitialPassword() {
   const input = document.getElementById('passwordInput');
   const error = document.getElementById('passwordError');
   const loginButton = document.getElementById('loginButton');
   const enteredPassword = input.value.trim();
   if (!enteredPassword) {
    input.classList.add('error');
    error.innerText = 'âš ï¸ ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”';
    error.classList.add('active');
    return;
   }
   input.disabled = true;
   loginButton.disabled = true;
   loginButton.style.opacity = '0.6';
   loginButton.style.cursor = 'wait';
   document.getElementById('loadingOverlay').style.display = 'flex';
   document.getElementById('loadingText').innerText = 'ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì¤‘ì…ë‹ˆë‹¤...';
   document.getElementById('loadingProgress').innerText = 'ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”';
   if (enteredPassword === ADMIN_PASSWORD) {
    authSession.admin = true;
    closePasswordModal();
    await initializeData();
    document.getElementById('loadingOverlay').style.display = 'none';
    showView('ceo');
    return;
   }
   await initializeData();
   if (!memberInfoData) {
    await loadMemberInfo();
   }
   const months = ['9ì›”', '10ì›”', '11ì›”', '12ì›”'];
   let foundUser = null;
   let userFirstMonth = null;
   let availableMonths = [];
   for (let i = 0; i < months.length; i++) {
    const month = months[i];
    document.getElementById('loadingText').innerText = `${month} ë°ì´í„° í™•ì¸ ì¤‘...`;
    document.getElementById('loadingProgress').innerText = `ì§„í–‰ë¥ : ${i + 1} / ${months.length}`;
    const memberData = await loadSheetData(month);
    const userMap = new Map();
    memberData.forEach(r => {
     const name = r['ì´ë¦„'];
     const compName = r['íšŒì‚¬ë‚´ ì´ë¦„'] || '';
     if (name && compName) {
      const key = `${name}|${compName}`;
      if (!userMap.has(key)) {
       userMap.set(key, { name, compName });
      }
     }
    });
    for (const [key, userData] of userMap) {
     const correctPassword = await getUserPassword(key);
     if (enteredPassword === correctPassword) {
      if (!foundUser) {
       foundUser = { key, ...userData };
       userFirstMonth = month;
      }
      availableMonths.push(month);
      break;
     }
    }
   }
   userAvailableMonths = availableMonths;
   if (foundUser) {
    document.getElementById('loadingText').innerText = 'ë¡œê·¸ì¸ ì„±ê³µ! ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
    document.getElementById('loadingProgress').innerText = 'í˜ì´ì§€ë¥¼ ì¤€ë¹„í•˜ê³  ìˆìŠµë‹ˆë‹¤';
    authSession.users.add(foundUser.key);
    closePasswordModal();
    document.getElementById('memberView').classList.add('active');
    currentMemberMonth = userFirstMonth;
    const allMonths = ['9ì›”', '10ì›”', '11ì›”', '12ì›”'];
    document.querySelectorAll('#memberMonthTabs .month-tab').forEach(t => {
     t.classList.remove('active', 'disabled');
     const month = t.getAttribute('data-month');
     if (!availableMonths.includes(month)) {
      t.classList.add('disabled');
     }
    });
    document.querySelector(`#memberMonthTabs .month-tab[data-month="${userFirstMonth}"]`)?.classList.add('active');
    await memberLoadMonth(userFirstMonth, true);
    const selectElement = document.getElementById('memberUserSelect');
    selectElement.value = foundUser.key;
    selectedUserKey = foundUser.key;
    const calculatedData = memberCalculateData(foundUser.key);
    memberUpdateUI(calculatedData);
    document.getElementById('loadingOverlay').style.display = 'none';
   } else {
    document.getElementById('loadingOverlay').style.display = 'none';
    input.disabled = false;
    loginButton.disabled = false;
    loginButton.style.opacity = '1';
    loginButton.style.cursor = 'pointer';
    input.classList.add('error');
    input.value = '';
    error.innerText = 'âŒ ì•”í˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤';
    error.classList.add('active');
    setTimeout(() => {
     input.classList.remove('error');
    }, 500);
   }
  }
  const DATA_CACHE = {};
  let VACATION_DATA = [];
  let currentMemberMonth = '9ì›”', currentCeoMonth = '9ì›”';
  let ceoVacationDetails = [];
  let ceoMissingDetails = [];
  let selectedUserKey = null;
  async function loadSheetData(key) {
   if (DATA_CACHE[key]) return DATA_CACHE[key];
   let url = SHEET_URLS[key];
   if (!url) return [];
   if (key === 'íœ´ê°€') {
    url += '&_=' + Date.now();
   }
   try {
    const response = await fetch(url, { cache: 'no-cache' });
    const csvText = await response.text();
    return new Promise((resolve) => {
     Papa.parse(csvText, {
      header: true,
      skipEmptyLines: true,
      complete: (results) => { DATA_CACHE[key] = results.data; resolve(results.data); }
     });
    });
   } catch (error) { return []; }
  }
  function getVacationInfo(name, compName, month) {
   let usedHours = 0;
   if (memberRawData && memberRawData.length > 0) {
    memberRawData.forEach(row => {
     if (row['ì´ë¦„'] === name && (row['íšŒì‚¬ë‚´ ì´ë¦„'] || '') === compName) {
      const vacationTimeStr = row['íœ´ê°€ì‹œê°„'];
      if (!vacationTimeStr) return;
      let hours = 0;
      if (typeof vacationTimeStr === 'number') {
       hours = vacationTimeStr;
      } else if (typeof vacationTimeStr === 'string') {
       const cleaned = vacationTimeStr.replace(/ì‹œê°„|hr|h/gi, '').trim();
       hours = parseFloat(cleaned) || 0;
      }
      usedHours += hours;
     }
    });
   }
   const usedDays = usedHours / 8;
   if (!VACATION_DATA || VACATION_DATA.length === 0) {
    return { used: usedDays, remain: 0 };
   }
   let userRow = null;
   const possibleCompNameCols = ['íšŒì‚¬ë‚´ì´ë¦„', 'íšŒì‚¬ë‚´ ì´ë¦„', 'íšŒì‚¬ë‚´_ì´ë¦„'];
   for (const row of VACATION_DATA) {
    if (row['ì´ë¦„'] === name) {
     let matchedCompName = '';
     for (const col of possibleCompNameCols) {
      if (row[col] !== undefined) {
       matchedCompName = row[col] || '';
       break;
      }
     }
     if (matchedCompName === compName) {
      userRow = row;
      break;
     }
    }
   }
   if (!userRow) {
    console.log(`âš ï¸ ì”ì—¬ ì—°ì°¨ ì°¾ê¸° ì‹¤íŒ¨: ${name} (${compName})`);
    if (VACATION_DATA.length > 0) {
     console.log('ì²« ë²ˆì§¸ í–‰ ì»¬ëŸ¼:', Object.keys(VACATION_DATA[0]));
    }
    return { used: usedDays, remain: 0 };
   }
   const possibleRemainCols = ['ì”ì—¬ ì—°ì°¨', 'ì”ì—¬ì—°ì°¨', 'ë‚¨ì€ ì—°ì°¨', 'ë‚¨ì€ì—°ì°¨', 'ì”ì—¬', 'remain'];
   let remainValue = 0;
   for (const col of possibleRemainCols) {
    if (userRow[col] !== undefined && userRow[col] !== null && userRow[col] !== '') {
     remainValue = parseFloat(userRow[col]) || 0;
     console.log(`âœ… ì”ì—¬ ì—°ì°¨ ì°¾ìŒ: ${name} (${compName}) = ${remainValue}ì¼ (ì»¬ëŸ¼: "${col}")`);
     break;
    }
   }
   return { used: usedDays, remain: remainValue };
  }
  async function getTotalVacationByMonth(month) {
   const sheetKey = getSheetKeyForMonth(month);
   const monthData = await loadSheetData(sheetKey);
   if (!monthData || monthData.length === 0) {
    console.log(`âŒ ${sheetKey} ì‹œíŠ¸ ë°ì´í„° ì—†ìŒ`);
    return { total: 0, details: [] };
   }
   const userVacationMap = {};
   monthData.forEach(row => {
    const name = row['ì´ë¦„'];
    const compName = row['íšŒì‚¬ë‚´ ì´ë¦„'] || '';
    const vacationTimeStr = row['íœ´ê°€ì‹œê°„'];
    if (!name || !vacationTimeStr) return;
    const userKey = `${name}|${compName}`;
    let hours = 0;
    if (typeof vacationTimeStr === 'number') {
     hours = vacationTimeStr;
    } else if (typeof vacationTimeStr === 'string') {
     const cleaned = vacationTimeStr.replace(/ì‹œê°„|hr|h/gi, '').trim();
     hours = parseFloat(cleaned) || 0;
    }
    if (hours > 0) {
     if (!userVacationMap[userKey]) {
      userVacationMap[userKey] = { name, compName, hours: 0 };
     }
     userVacationMap[userKey].hours += hours;
    }
   });
   const details = [];
   let totalHours = 0;
   Object.entries(userVacationMap).forEach(([userKey, data]) => {
    const days = data.hours / 8;
    totalHours += data.hours;
    const displayName = data.compName ? `${data.name} (${data.compName})` : data.name;
    details.push({ name: displayName, used: days });
   });
   const totalDays = totalHours / 8;
   details.sort((a, b) => b.used - a.used);
   return { total: totalDays, details };
  }
  async function initializeData() {
   document.getElementById('loadingOverlay').style.display = 'flex';
   try {
    await loadMemberInfo();
    VACATION_DATA = await loadSheetData('íœ´ê°€');
    await loadSheetData('9ì›”');
    memberLoadMonth('9ì›”', true);
   } catch (error) { }
   document.getElementById('loadingOverlay').style.display = 'none';
  }
  function showView(v) {
   if (v === 'ceo') {
    if (hasAdminAccess()) {
     document.querySelectorAll('.view, .admin-view').forEach(el => el.classList.remove('active'));
     document.getElementById('ceoView').classList.add('active');
     ceoLoadMonth(currentCeoMonth);
    } else {
     openPasswordModal('CEO_VIEW', () => {
      document.querySelectorAll('.view, .admin-view').forEach(el => el.classList.remove('active'));
      document.getElementById('ceoView').classList.add('active');
      ceoLoadMonth(currentCeoMonth);
     }, true);
    }
   } else if (v === 'admin') {
    if (hasAdminAccess()) {
     document.querySelectorAll('.view, .admin-view').forEach(el => el.classList.remove('active'));
     document.getElementById('adminView').classList.add('active');
     loadAdminData();
    } else {
     openPasswordModal('ADMIN_VIEW', () => {
      document.querySelectorAll('.view, .admin-view').forEach(el => el.classList.remove('active'));
      document.getElementById('adminView').classList.add('active');
      loadAdminData();
     }, true);
    }
   } else if (v === 'member') {
    document.querySelectorAll('.view, .admin-view').forEach(el => el.classList.remove('active'));
    document.getElementById('memberView').classList.add('active');
    memberLoadMonth(currentMemberMonth, true);
   }
  }
  async function switchToMemberView(name, dept, month) {
   showView('member');
   currentMemberMonth = month;
   document.querySelectorAll('#memberMonthTabs .month-tab').forEach(t => t.classList.remove('active'));
   document.querySelector(`#memberMonthTabs .month-tab[data-month="${month}"]`)?.classList.add('active');
   await memberLoadMonth(month, true);
   const userKey = `${name}|${dept}`;
   const selectElement = document.getElementById('memberUserSelect');
   const option = Array.from(selectElement.options).find(opt => opt.value === userKey);
   if (option) {
    selectElement.value = userKey;
    selectedUserKey = userKey;
    const event = new Event('change');
    selectElement.dispatchEvent(event);
   } else {
   }
  }
  function showCeoVacationModal() {
   console.log('ğŸ–ï¸ íœ´ê°€ ëª¨ë‹¬ ì—´ê¸°');
   console.log('  - currentCeoMonth:', currentCeoMonth);
   console.log('  - ceoVacationDetails:', ceoVacationDetails);
   console.log('  - VACATION_DATA:', VACATION_DATA?.length, 'í–‰');
   const overlay = document.getElementById('ceoVacationModalOverlay');
   const title = document.getElementById('ceoVacationModalTitle');
   const list = document.getElementById('ceoVacationModalList');
   title.innerText = `ğŸ–ï¸ ${currentCeoMonth} íœ´ê°€ ì‚¬ìš© ìƒì„¸`;
   list.innerHTML = ceoVacationDetails.length === 0
    ? '<div class="text-center text-gray-400 py-4">íœ´ê°€ ì‚¬ìš© ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>'
    : ceoVacationDetails.map((item, idx) => `<div class="modal-list-item"><span class="flex items-center gap-2"><span class="w-6 h-6 flex items-center justify-center bg-green-100 text-green-600 rounded-full text-xs font-bold">${idx + 1}</span><span class="font-medium">${item.name}</span></span><span class="text-green-600 font-bold">${item.used}ì¼</span></div>`).join('');
   overlay.style.display = 'flex';
  }
  function showCeoMissingModal() {
   const overlay = document.getElementById('ceoMissingModalOverlay');
   const title = document.getElementById('ceoMissingModalTitle');
   const list = document.getElementById('ceoMissingModalList');
   title.innerText = `âš ï¸ ${currentCeoMonth} ê·¼ë¬´ ê¸°ë¡ ëˆ„ë½ ìƒì„¸`;
   list.innerHTML = ceoMissingDetails.length === 0
    ? '<div class="text-center text-gray-400 py-4">ê·¼ë¬´ ê¸°ë¡ ëˆ„ë½ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>'
    : ceoMissingDetails.map((item, idx) => `<div class="modal-list-item"><span class="flex items-center gap-2"><span class="w-6 h-6 flex items-center justify-center bg-amber-100 text-amber-600 rounded-full text-xs font-bold">${idx + 1}</span><span class="font-medium">${item.name}</span></span><span class="text-amber-600 font-bold">${item.count}íšŒ</span></div>`).join('');
   overlay.style.display = 'flex';
  }
  let ceoTeamMembersData = {};
  function showCeoTeamDetailModal(teamName) {
   const overlay = document.getElementById('ceoTeamDetailModalOverlay');
   const title = document.getElementById('ceoTeamDetailModalTitle');
   const list = document.getElementById('ceoTeamDetailModalList');
   const members = ceoTeamMembersData[teamName] || [];
   title.innerText = `ğŸ“Š ${teamName} êµ¬ì„±ì› ì´ˆê³¼ê·¼ë¬´ í˜„í™© (${currentCeoMonth})`;
   if (members.length === 0) {
    list.innerHTML = '<div class="text-center text-gray-400 py-4">í•´ë‹¹ ì¡°ì§ì— ì´ˆê³¼ê·¼ë¬´ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
   } else {
    list.innerHTML = members.map((item, idx) => {
     const timeStr = ceoFormatHoursMinutes(item.overMins);
     return `<div class="modal-list-item">
      <span class="flex items-center gap-2">
       <span class="w-6 h-6 flex items-center justify-center bg-blue-100 text-blue-600 rounded-full text-xs font-bold">${idx + 1}</span>
       <span class="font-medium">${item.name}</span>
      </span>
      <span class="text-red-600 font-bold">${timeStr}</span>
     </div>`;
    }).join('');
   }
   overlay.style.display = 'flex';
  }
  document.getElementById('ceoVacationModalClose').onclick = () => document.getElementById('ceoVacationModalOverlay').style.display = 'none';
  document.getElementById('ceoMissingModalClose').onclick = () => document.getElementById('ceoMissingModalOverlay').style.display = 'none';
  document.getElementById('ceoTeamDetailModalClose').onclick = () => document.getElementById('ceoTeamDetailModalOverlay').style.display = 'none';
  window.addEventListener('click', (e) => {
   if (e.target === document.getElementById('ceoVacationModalOverlay')) document.getElementById('ceoVacationModalOverlay').style.display = 'none';
   if (e.target === document.getElementById('ceoMissingModalOverlay')) document.getElementById('ceoMissingModalOverlay').style.display = 'none';
   if (e.target === document.getElementById('ceoTeamDetailModalOverlay')) document.getElementById('ceoTeamDetailModalOverlay').style.display = 'none';
  });
  let memberRawData = [], memberModalChart = null, memberCurrentCalculatedData = null;
  function calculateOrgStats(month) {
   if (!memberRawData || memberRawData.length === 0) {
    return;
   }
   let totalInSum = 0;
   let totalOutSum = 0;
   let inCount = 0;
   let outCount = 0;
   memberRawData.forEach(row => {
    const special = row['íŠ¹ì´ì‚¬í•­'] ? String(row['íŠ¹ì´ì‚¬í•­']).trim() : '';
    if (special.includes('ì…ì‚¬ì¼ ì´ì „')) return;
    let inTime = memberParseToMinutes(row['ì¶œê·¼ì‹œê°']);
    let outTime = memberParseToMinutes(row['í‡´ê·¼ì‹œê°']);
    if (outTime > 0 && inTime > 0 && outTime < inTime) {
     outTime += 1440;
    }
    if (inTime > 0) {
     totalInSum += inTime;
     inCount++;
    }
    if (outTime > 0) {
     totalOutSum += outTime;
     outCount++;
    }
   });
   const avgInMins = inCount > 0 ? totalInSum / inCount : 0;
   const avgOutMins = outCount > 0 ? totalOutSum / outCount : 0;
   const inHour = Math.floor(avgInMins / 60);
   const inMin = Math.round(avgInMins % 60);
   document.getElementById('org_avg_in').innerText = `${String(inHour).padStart(2,'0')}:${String(inMin).padStart(2,'0')}`;
   const displayOutMins = avgOutMins % 1440;
   const outHour = Math.floor(displayOutMins / 60);
   const outMin = Math.round(displayOutMins % 60);
   const nextDay = avgOutMins >= 1440 ? ' (ìµì¼)' : '';
   document.getElementById('org_avg_out').innerText = `${String(outHour).padStart(2,'0')}:${String(outMin).padStart(2,'0')}${nextDay}`;
  }
  function calculateDeptStats(userKey, month) {
   if (!memberRawData || memberRawData.length === 0 || !userKey) {
    document.getElementById('dept_avg_in').innerText = '-';
    document.getElementById('dept_avg_out').innerText = '-';
    return;
   }
   const [userName, userCompName] = userKey.split('|');
   const userDept = userCompName || userName;
   const deptToTeamMap = {
    'Anthony': 'ê°œë°œíŒ€',
    'Greg': 'ê°œë°œíŒ€',
    'Hyuna': 'ê°œë°œíŒ€',
    'Liel': 'ê°œë°œíŒ€',
    'Sonny': 'ê°œë°œíŒ€',
    'Teddy': 'ê°œë°œíŒ€',
    'Timmy': 'ê°œë°œíŒ€',
    'Janice': 'ê¸°íš1íŒ€',
    'Lucy': 'ê¸°íš1íŒ€',
    'Sol': 'ê¸°íš1íŒ€',
    'Green': 'ê¸°íš2íŒ€',
    'Joy': 'ê¸°íš2íŒ€',
    'Newyear': 'ê¸°íš2íŒ€',
    'Spring': 'ê¸°íš2íŒ€',
    'Claire': 'ë©”ë””ì»¬íŒ€',
    'Iris': 'ë©”ë””ì»¬íŒ€',
    'Dante': 'ë©”ë””ì»¬íŒ€',
    'Guy': 'ê²½ì˜ì§€ì›íŒ€',
    'Kaylee': 'ê²½ì˜ì§€ì›íŒ€',
    'Leo': 'ê²½ì˜ì§€ì›íŒ€',
    'Jake': 'í’ˆì§ˆì±…ì„íŒ€'
   };
   const userTeam = deptToTeamMap[userDept] || 'ê¸°íƒ€';
   let totalInSum = 0;
   let totalOutSum = 0;
   let inCount = 0;
   let outCount = 0;
   memberRawData.forEach(row => {
    const dept = row['íšŒì‚¬ë‚´ ì´ë¦„'];
    const team = deptToTeamMap[dept];
    if (team !== userTeam) return;
    const special = row['íŠ¹ì´ì‚¬í•­'] ? String(row['íŠ¹ì´ì‚¬í•­']).trim() : '';
    if (special.includes('ì…ì‚¬ì¼ ì´ì „')) return;
    const vacationMins = memberParseToMinutes(row['íœ´ê°€ì‹œê°„']);
    if (vacationMins > 0) return;
    let inTime = memberParseToMinutes(row['ì¶œê·¼ì‹œê°']);
    let outTime = memberParseToMinutes(row['í‡´ê·¼ì‹œê°']);
    if (outTime > 0 && inTime > 0 && outTime < inTime) {
     outTime += 1440;
    }
    if (inTime > 0) {
     totalInSum += inTime;
     inCount++;
    }
    if (outTime > 0) {
     totalOutSum += outTime;
     outCount++;
    }
   });
   const avgInMins = inCount > 0 ? totalInSum / inCount : 0;
   const avgOutMins = outCount > 0 ? totalOutSum / outCount : 0;
   document.getElementById('dept_avg_title').innerText = `ğŸ‘¥ ${userTeam} í‰ê·  ì¶œí‡´ê·¼`;
   if (inCount > 0) {
    const inHour = Math.floor(avgInMins / 60);
    const inMin = Math.round(avgInMins % 60);
    document.getElementById('dept_avg_in').innerText = `${String(inHour).padStart(2,'0')}:${String(inMin).padStart(2,'0')}`;
    document.getElementById('dept_avg_in_label').innerText = `${userTeam} í‰ê· `;
   } else {
    document.getElementById('dept_avg_in').innerText = '-';
    document.getElementById('dept_avg_in_label').innerText = `${userTeam} í‰ê· `;
   }
   if (outCount > 0) {
    const displayOutMins = avgOutMins % 1440;
    const outHour = Math.floor(displayOutMins / 60);
    const outMin = Math.round(displayOutMins % 60);
    const nextDay = avgOutMins >= 1440 ? ' (ìµì¼)' : '';
    document.getElementById('dept_avg_out').innerText = `${String(outHour).padStart(2,'0')}:${String(outMin).padStart(2,'0')}${nextDay}`;
    document.getElementById('dept_avg_out_label').innerText = `${userTeam} í‰ê· `;
   } else {
    document.getElementById('dept_avg_out').innerText = '-';
    document.getElementById('dept_avg_out_label').innerText = `${userTeam} í‰ê· `;
   }
  }
  async function memberSwitchMonth(m) {
   if (userAvailableMonths.length > 0 && !userAvailableMonths.includes(m)) {
    alert(`${m}ì—ëŠ” ê·¼ë¬´ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.\nì…ì‚¬ ì´í›„ì˜ ì›”ë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
    return;
   }
   currentMemberMonth = m;
   document.querySelectorAll('#memberMonthTabs .month-tab').forEach(t => { t.classList.remove('active'); t.classList.add('loading'); });
   document.querySelector(`#memberMonthTabs .month-tab[data-month="${m}"]`).classList.add('active');
   await memberLoadMonth(m);
   document.querySelectorAll('#memberMonthTabs .month-tab').forEach(t => t.classList.remove('loading'));
  }
  async function memberLoadMonth(m, skipAlert = false) {
   memberRawData = await loadSheetData(m);
   if (!memberRawData.length) return;
   const userSet = new Set(), uniqueUsers = [];
   memberRawData.forEach(r => {
    const name = r['ì´ë¦„'], compName = r['íšŒì‚¬ë‚´ ì´ë¦„'] || '';
    if (name) { const key = `${name}|${compName}`; if (!userSet.has(key)) { userSet.add(key); uniqueUsers.push({ key, displayName: compName ? `${name} (${compName})` : name }); } }
   });
   const sel = document.getElementById('memberUserSelect');
   sel.innerHTML = '<option value="">ëŒ€ìƒì ì„ íƒ</option>';
   uniqueUsers.sort((a,b) => a.displayName.localeCompare(b.displayName)).forEach(u => { const o = document.createElement('option'); o.value = u.key; o.text = u.displayName; sel.appendChild(o); });
   sel.disabled = false;
   let calculatedData = null;
   if (selectedUserKey && uniqueUsers.some(u => u.key === selectedUserKey)) {
    sel.value = selectedUserKey;
    calculatedData = memberCalculateData(selectedUserKey);
    memberUpdateUI(calculatedData);
    calculateDeptStats(selectedUserKey, m);
    const commuteTab = document.getElementById('tab-commute');
    if (commuteTab && commuteTab.classList.contains('active')) {
     setTimeout(() => {
      updateWeekdayCommuteChart();
     }, 100);
    }
   }
   else if (uniqueUsers.length > 0) {
    selectedUserKey = uniqueUsers[0].key;
    sel.value = selectedUserKey;
    calculatedData = memberCalculateData(selectedUserKey);
    memberUpdateUI(calculatedData);
    calculateDeptStats(selectedUserKey, m);
    const commuteTab = document.getElementById('tab-commute');
    if (commuteTab && commuteTab.classList.contains('active')) {
     setTimeout(() => {
      updateWeekdayCommuteChart();
     }, 100);
    }
   }
   calculateOrgStats(m);
  }
  function memberFormatMinutes(mins, style = 'text') {
   if (!mins || mins === Infinity || mins === -Infinity) return '-';
   let nextDay = '';
   if (style === 'colon' && mins >= 1440) {
    nextDay = ' (ìµì¼)';
    mins = mins % 1440;
   }
   let h = Math.floor(mins / 60);
   let m = Math.round(mins % 60);
   if (m === 60) {
    h += 1;
    m = 0;
   }
   return style === 'colon' ? `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}${nextDay}` : `${h}ì‹œê°„ ${m}ë¶„`;
  }
  function memberParseToMinutes(val) {
   if (!val) return 0;
   if (typeof val === 'number') return Math.round(val * 24 * 60);
   if (typeof val === 'string') { const p = val.trim().split(':'); if (p.length >= 2) return parseInt(p[0]) * 60 + parseInt(p[1]); }
   return 0;
  }
  function memberFormatDaysToText(days) {
   if (!days || days === 0) return '0ì¼';
   const isNegative = days < 0;
   let absDays = Math.abs(days);
   let fullDays = Math.floor(absDays);
   let remainingHours = Math.round((absDays - fullDays) * 8);
   if (remainingHours === 8) {
    fullDays += 1;
    remainingHours = 0;
   }
   const sign = isNegative ? '-' : '';
   if (fullDays === 0) {
    return `${sign}${remainingHours}ì‹œê°„`;
   } else if (remainingHours === 0) {
    return `${sign}${fullDays}ì¼`;
   } else {
    return `${sign}${fullDays}ì¼ ${remainingHours}ì‹œê°„`;
   }
  }
  function memberCalculateData(key) {
   const [targetName, targetCompName] = key.split('|');
   const userRows = memberRawData.filter(r => r['ì´ë¦„'] === targetName && (r['íšŒì‚¬ë‚´ ì´ë¦„'] || '') === targetCompName);
   if (!userRows.length) return null;
   const dailyMap = new Map();
   userRows.forEach(row => {
    let rawDateValue = row['ë‚ ì§œ'];
    if (rawDateValue && typeof rawDateValue === 'string') {
     rawDateValue = rawDateValue.replace(/\.\s*/g, '-').trim();
     rawDateValue = rawDateValue.replace(/-$/, '');
    }
    let dateStr = rawDateValue || 'ì•Œ ìˆ˜ ì—†ìŒ';
    if (typeof dateStr === 'string' && dateStr.includes('-')) {
     try {
      const d = new Date(dateStr);
      dateStr = `${d.getMonth()+1}/${d.getDate()}`;
     } catch(e) {}
    }
    const total = memberParseToMinutes(row['ì´ ê·¼ë¬´']), vacation = memberParseToMinutes(row['íœ´ê°€ì‹œê°„']);
    let inTime = memberParseToMinutes(row['ì¶œê·¼ì‹œê°']), outTime = memberParseToMinutes(row['í‡´ê·¼ì‹œê°']);
    if (outTime > 0 && inTime > 0 && outTime < inTime) {
     outTime += 1440;
    }
    const hasHolidayType = row['íœ´ì¼êµ¬ë¶„'] && String(row['íœ´ì¼êµ¬ë¶„']).trim() !== '';
    const specialNote = row['íŠ¹ì´ì‚¬í•­'] ? String(row['íŠ¹ì´ì‚¬í•­']).trim() : '';
    const isBeforeJoinDate = specialNote.includes('ì…ì‚¬ì¼ ì´ì „');
    const isMissing = !row['ê·¼ë¬´ì •ì±…'] && !row['íœ´ê°€ì •ì±…'] && !row['íœ´ì¼êµ¬ë¶„'];
    if (!dailyMap.has(dateStr)) {
     dailyMap.set(dateStr, {
      date: dateStr,
      rawDate: rawDateValue,
      total: 0,
      vacation: 0,
      in: inTime > 0 ? inTime : Infinity,
      out: outTime > 0 ? outTime : -Infinity,
      hasHolidayType: false,
      isBeforeJoinDate: false,
      isMissing: true,
      policies: []
     });
    } else {
     const existing = dailyMap.get(dateStr);
     if (!existing.rawDate && rawDateValue) {
      existing.rawDate = rawDateValue;
     }
    }
    const day = dailyMap.get(dateStr);
    day.total += total;
    day.vacation += vacation;
    if (hasHolidayType) { day.hasHolidayType = true; }
    if (isBeforeJoinDate) { day.isBeforeJoinDate = true; }
    if (row['ê·¼ë¬´ì •ì±…']) { day.isMissing = false; day.policies.push(row['ê·¼ë¬´ì •ì±…']); }
    if (row['íœ´ê°€ì •ì±…'] || row['íœ´ì¼êµ¬ë¶„']) day.isMissing = false;
    if (inTime > 0 && inTime < day.in) day.in = inTime;
    if (outTime > 0 && outTime > day.out) day.out = outTime;
   });
   let workDays = 0, totalMins = 0, vacationMins = 0, clockInSum = 0, clockOutSum = 0, clockInCount = 0, clockOutCount = 0, dayByDay = [];
   const weekdayOvertime = [0, 0, 0, 0, 0];
   const weekdayOvertimeDates = [[], [], [], [], []];
   const weekdayMaxCount = [0, 0, 0, 0, 0];
   dailyMap.forEach(day => {
    const finalIn = day.in === Infinity ? 0 : day.in, finalOut = day.out === -Infinity ? 0 : day.out;
    const isWorkDay = !day.hasHolidayType && !day.isBeforeJoinDate;
    if (isWorkDay) workDays++;
    if (!day.isBeforeJoinDate) { totalMins += day.total + day.vacation; vacationMins += day.vacation; }
    if (day.vacation === 0) {
     if (finalIn > 0) { clockInSum += finalIn; clockInCount++; }
     if (finalOut > 0) { clockOutSum += finalOut; clockOutCount++; }
    }
    if (day.rawDate && isWorkDay) {
     const dateStr = String(day.rawDate);
     if (dateStr.includes('-')) {
      try {
       const dateObj = new Date(dateStr);
       const dayOfWeek = dateObj.getDay();
       if (dayOfWeek >= 1 && dayOfWeek <= 5) {
        weekdayMaxCount[dayOfWeek - 1]++;
       }
      } catch(e) {}
     }
    }
    if (day.rawDate) {
     const dateStr = String(day.rawDate);
     if (dateStr.includes('-')) {
      try {
       const dateObj = new Date(dateStr);
       const dayOfWeek = dateObj.getDay();
       const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
       const totalHours = (day.total / 60).toFixed(1);
       if (dayOfWeek >= 1 && dayOfWeek <= 5) {
        if (day.total >= 480) {
         weekdayOvertime[dayOfWeek - 1]++;
         weekdayOvertimeDates[dayOfWeek - 1].push({
          date: day.date,
          rawDate: dateStr,
          hours: totalHours
         });
        } else {
        }
       } else {
       }
      } catch(e) {
      }
     } else {
     }
    }
    const totalWithVacation = day.total + day.vacation;
    const isInsufficientTime = isWorkDay && totalWithVacation > 0 && totalWithVacation < 470;
    dayByDay.push({
     date: day.date,
     rawDate: day.rawDate,
     total: day.total,
     vacation: day.vacation,
     over: Math.max(0, day.total - 480),
     in: finalIn,
     out: finalOut,
     isWorkDay: isWorkDay,
     isMissing: (day.isMissing || isInsufficientTime) && !day.isBeforeJoinDate,
     policy: [...new Set(day.policies)].join(', ')
    });
   });
   const stdMins = workDays * 480, overMins = Math.max(0, totalMins - stdMins);
   const avgIn = clockInCount > 0 ? clockInSum / clockInCount : 0, avgOut = clockOutCount > 0 ? clockOutSum / clockOutCount : 0;
   const vacationInfo = getVacationInfo(targetName, targetCompName, currentMemberMonth);
   let avgHoursPerDay = 0;
   if (avgIn > 0 && avgOut > 0) {
    let workMins = avgOut - avgIn;
    if (avgIn > avgOut) {
     workMins += 1440;
    }
    if (workMins >= 0 && workMins <= 900) {
     workMins -= 60;
     if (workMins < 0) workMins = 0;
     avgHoursPerDay = workMins / 60;
    }
   }
   memberCurrentCalculatedData = {
    name: targetCompName ? `${targetName} (${targetCompName})` : targetName, realName: targetName, dayByDay, workDays,
    stdHoursRaw: stdMins / 60, totalHoursRaw: totalMins / 60, overHoursRaw: overMins / 60, vacationHoursRaw: vacationMins / 60,
    vacationUsed: vacationInfo.used, vacationRemain: vacationInfo.remain,
    avgHoursPerDay: avgHoursPerDay,
    weekdayOvertime: weekdayOvertime,
    weekdayMaxCount: weekdayMaxCount,
    weekdayOvertimeDates: weekdayOvertimeDates,
    display: { workDays: `${workDays}ì¼`, stdHours: memberFormatMinutes(stdMins), totalHours: memberFormatMinutes(totalMins), overTime: memberFormatMinutes(overMins), vacation: memberFormatDaysToText(vacationInfo.used), remainVacation: memberFormatDaysToText(vacationInfo.remain), avgIn: avgIn > 0 ? memberFormatMinutes(avgIn, 'colon') : '-', avgOut: avgOut > 0 ? memberFormatMinutes(avgOut, 'colon') : '-', missing: `${dayByDay.filter(d => d.isMissing).length}ê±´` }
   };
   return memberCurrentCalculatedData;
  }
  function memberShowDetail(type) {
   if (!memberCurrentCalculatedData) return;
   const overlay = document.getElementById('memberModalOverlay'), title = document.getElementById('memberModalTitle'), list = document.getElementById('memberModalList'), ctx = document.getElementById('memberModalChart').getContext('2d');
   overlay.style.display = 'flex'; list.innerHTML = '';
   if (memberModalChart) memberModalChart.destroy();
   const labels = memberCurrentCalculatedData.dayByDay.map(d => d.date);
   let cfg = { type: 'bar', data: { labels, datasets: [] }, options: { responsive: true, maintainAspectRatio: false, scales: { x: { ticks: { autoSkip: false, maxRotation: 90, minRotation: 45, font: { size: 10 } } } }, plugins: { tooltip: { callbacks: { label: c => { const v = c.parsed.y; if (v === null) return null; if (type === 'avgIn' || type === 'avgOut') return ` ì‹œê°: ${memberFormatMinutes(v, 'colon')}`; if (type === 'missing' || type === 'workDays') return v === 1 ? ' í•´ë‹¹í•¨' : ' í•´ë‹¹ì—†ìŒ'; return ` ì‹œê°„: ${memberFormatMinutes(v)}`; } } } } } };
   switch(type) {
    case 'workDays': title.innerText = 'ğŸ“… í†µí•© ê·¼ë¬´ ì¼ì ìƒì„¸'; memberCurrentCalculatedData.dayByDay.filter(d => d.isWorkDay).forEach(d => { list.innerHTML += `<div class="modal-list-item"><span>${d.date}</span><span>${d.policy}</span></div>`; }); cfg.data.datasets.push({ label: 'ê·¼ë¬´ ì—¬ë¶€', data: memberCurrentCalculatedData.dayByDay.map(d => d.isWorkDay ? 1 : 0), backgroundColor: '#3b82f6' }); cfg.options.scales.y = { display: false }; break;
    case 'totalHours': 
      title.innerText = 'ğŸ’¼ ì¼ìë³„ ì´ ê·¼ë¬´ ì‹œê°„ (ê·¼ë¬´ + íœ´ê°€)'; 
      cfg.data.datasets.push({ 
        label: 'ì‹¤ì œ ê·¼ë¬´', 
        data: memberCurrentCalculatedData.dayByDay.map(d => d.total), 
        backgroundColor: '#8b5cf6' 
      }); 
      cfg.data.datasets.push({ 
        label: 'íœ´ê°€ ì‹œê°„', 
        data: memberCurrentCalculatedData.dayByDay.map(d => d.vacation), 
        backgroundColor: '#10b981' 
      }); 
      cfg.options.scales.y = { 
        stacked: true,
        ticks: { callback: v => memberFormatMinutes(v) }
      }; 
      cfg.options.scales.x.stacked = true;
      memberCurrentCalculatedData.dayByDay.forEach(d => { 
        const totalTime = d.total + d.vacation;
        if (totalTime > 0) {
          let detailText = '';
          if (d.total > 0 && d.vacation > 0) {
            detailText = `${memberFormatMinutes(d.total)} + ${memberFormatMinutes(d.vacation)} = ${memberFormatMinutes(totalTime)}`;
          } else if (d.total > 0) {
            detailText = memberFormatMinutes(d.total);
          } else {
            detailText = memberFormatMinutes(d.vacation);
          }
          const isInsufficient = d.isWorkDay && totalTime < 470;
          const itemClass = isInsufficient ? ' style="color:#ef4444; font-weight:600;"' : '';
          const warningIcon = isInsufficient ? ' âš ï¸' : '';
          list.innerHTML += `<div class="modal-list-item"${itemClass}><span>${d.date}</span><span>${detailText}${warningIcon}</span></div>`; 
        }
      }); 
      break;
    case 'overTime': title.innerText = 'ğŸ”¥ ì¼ìë³„ ì´ˆê³¼ ê·¼ë¬´'; cfg.data.datasets.push({ label: 'ë¶„', data: memberCurrentCalculatedData.dayByDay.map(d => d.over), backgroundColor: '#ef4444' }); memberCurrentCalculatedData.dayByDay.forEach(d => { if (d.over > 0) list.innerHTML += `<div class="modal-list-item"><span>${d.date}</span><span>${memberFormatMinutes(d.over)}</span></div>`; }); break;
    case 'vacation': title.innerText = 'ğŸ–ï¸ íœ´ê°€ ì‚¬ìš© ìƒì„¸'; memberCurrentCalculatedData.dayByDay.filter(d => d.vacation > 0).forEach(d => { list.innerHTML += `<div class="modal-list-item"><span>${d.date}</span><span>${memberFormatMinutes(d.vacation)}</span></div>`; }); cfg.data.datasets.push({ label: 'ë¶„', data: memberCurrentCalculatedData.dayByDay.map(d => d.vacation), backgroundColor: '#10b981' }); break;
    case 'missing': 
      title.innerText = 'âš ï¸ ê¸°ë¡ ëˆ„ë½ ì¼ì'; 
      cfg.data.datasets.push({ 
        label: 'ëˆ„ë½', 
        data: memberCurrentCalculatedData.dayByDay.map(d => d.isMissing ? 1 : 0), 
        backgroundColor: '#ef4444' 
      }); 
      cfg.options.scales.y = { display: false }; 
      memberCurrentCalculatedData.dayByDay.filter(d => d.isMissing).forEach(d => { 
        const totalTime = d.total + d.vacation;
        let reason = '';
        if (totalTime === 0) {
          reason = 'ê¸°ë¡ ì—†ìŒ';
        } else if (totalTime < 470) {
          reason = `ê·¼ë¬´ì‹œê°„ ë¶€ì¡± (${memberFormatMinutes(totalTime)})`;
        } else {
          reason = 'ê¸°ë¡ ì—†ìŒ';
        }
        list.innerHTML += `<div class="modal-list-item" style="color:#ef4444"><span>${d.date}</span><span>${reason}</span></div>`; 
      }); 
      break;
    case 'avgIn': title.innerText = 'ğŸŒ… ì¼ìë³„ ì¶œê·¼ ì‹œê°'; cfg.type = 'line'; cfg.data.datasets.push({ label: 'ì¶œê·¼', data: memberCurrentCalculatedData.dayByDay.map(d => d.in > 0 ? d.in : null), borderColor: '#3b82f6', pointBackgroundColor: '#3b82f6', tension: 0.3, spanGaps: true }); cfg.options.scales.y = { ticks: { callback: v => memberFormatMinutes(v, 'colon') } }; memberCurrentCalculatedData.dayByDay.filter(d => d.in > 0).forEach(d => { list.innerHTML += `<div class="modal-list-item"><span>${d.date}</span><span>${memberFormatMinutes(d.in, 'colon')}</span></div>`; }); break;
    case 'avgOut': title.innerText = 'ğŸŒ† ì¼ìë³„ í‡´ê·¼ ì‹œê°'; cfg.type = 'line'; cfg.data.datasets.push({ label: 'í‡´ê·¼', data: memberCurrentCalculatedData.dayByDay.map(d => d.out > 0 ? d.out : null), borderColor: '#8b5cf6', pointBackgroundColor: '#8b5cf6', tension: 0.3, spanGaps: true }); cfg.options.scales.y = { ticks: { callback: v => memberFormatMinutes(v, 'colon') } }; memberCurrentCalculatedData.dayByDay.filter(d => d.out > 0).forEach(d => { list.innerHTML += `<div class="modal-list-item"><span>${d.date}</span><span>${memberFormatMinutes(d.out, 'colon')}</span></div>`; }); break;
   }
   memberModalChart = new Chart(ctx, cfg);
  }
  function memberUpdateUI(result) {
   if (!result) return;
   document.getElementById('memberReportTitle').innerText = `ğŸ“Š [${result.name}]ë‹˜ ê·¼íƒœ ì •ì‚° ë¦¬í¬íŠ¸ (${currentMemberMonth})`;
   document.getElementById('member_val_workDays').innerText = result.display.workDays;
   document.getElementById('member_val_stdHours').innerText = result.display.stdHours;
   document.getElementById('member_val_totalHours').innerText = result.display.totalHours;
   document.getElementById('member_val_overTime').innerText = result.display.overTime;
   document.getElementById('member_val_vacation').innerText = result.display.vacation;
   document.getElementById('member_val_remainVacation').innerText = result.display.remainVacation;
   document.getElementById('member_val_missing').innerText = result.display.missing;
   document.getElementById('member_val_avgIn').innerText = result.display.avgIn;
   document.getElementById('member_val_avgOut').innerText = result.display.avgOut;
   const totalDot = document.getElementById('total_status_dot');
   if (totalDot) {
    totalDot.classList.remove('green', 'red');
    if (result.totalHoursRaw < result.stdHoursRaw) {
     totalDot.classList.add('red');
     totalDot.setAttribute('data-tooltip', 'ê¸°ë¡ ëˆ„ë½ëœ ê±´ì´ ìˆì–´ ê¸°ì¤€ ê·¼ë¡œì‹œê°„ì— ë¯¸ì¹˜ì§€ ëª»í•©ë‹ˆë‹¤.');
    } else {
     totalDot.classList.add('green');
     totalDot.setAttribute('data-tooltip', 'ê¸°ë¡ ëˆ„ë½ëœ ê±´ì´ ì—†ìŠµë‹ˆë‹¤.');
    }
   }
   const overtimeDot = document.getElementById('overtime_status_dot');
   if (overtimeDot) {
    overtimeDot.classList.remove('green', 'red');
    overtimeDot.classList.add('red');
    if (result.display.overTime === '-' || result.display.overTime === '0ì‹œê°„') {
     overtimeDot.setAttribute('data-tooltip', 'ì´ˆê³¼ ê·¼ë¬´ê°€ ì—†ìŠµë‹ˆë‹¤.');
    } else {
     overtimeDot.setAttribute('data-tooltip', 'ì´ˆê³¼ ê·¼ë¬´ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
   }
   const missingDot = document.getElementById('missing_status_dot');
   if (missingDot) {
    missingDot.classList.remove('green', 'red');
    if (result.display.missing === '0ì¼' || result.display.missing === '0ê±´') {
     missingDot.classList.add('green');
     missingDot.setAttribute('data-tooltip', 'ê¸°ë¡ì´ ëˆ„ë½ëœ ë¶€ë¶„ì´ ì—†ìŠµë‹ˆë‹¤.');
    } else {
     missingDot.classList.add('red');
     missingDot.setAttribute('data-tooltip', 'ê¸°ë¡ì´ ëˆ„ë½ëœ ë¶€ë¶„ì´ ìˆìŠµë‹ˆë‹¤.');
    }
   }
   const avgInDot = document.getElementById('avgin_status_dot');
   if (avgInDot) {
    avgInDot.classList.remove('green', 'red');
    if (result.display.avgIn === '-') {
     avgInDot.classList.add('red');
     avgInDot.setAttribute('data-tooltip', 'ì¶œê·¼ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.');
    } else {
     avgInDot.classList.add('green');
     avgInDot.setAttribute('data-tooltip', 'ì´ë²ˆ ë‹¬ í‰ê·  ì¶œê·¼ ì‹œê°ì…ë‹ˆë‹¤.');
    }
   }
   const avgOutDot = document.getElementById('avgout_status_dot');
   if (avgOutDot) {
    avgOutDot.classList.remove('green', 'red');
    if (result.display.avgOut === '-') {
     avgOutDot.classList.add('red');
     avgOutDot.setAttribute('data-tooltip', 'í‡´ê·¼ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.');
    } else {
     avgOutDot.classList.add('green');
     avgOutDot.setAttribute('data-tooltip', 'ì´ë²ˆ ë‹¬ í‰ê·  í‡´ê·¼ ì‹œê°ì…ë‹ˆë‹¤.');
    }
   }
   if (result.workDays === 0 || result.avgHoursPerDay === 0) {
    document.getElementById('member_val_avgHoursPerDay').innerText = '-';
   } else {
    let avgHours = Math.floor(result.avgHoursPerDay);
    let avgMins = Math.round((result.avgHoursPerDay - avgHours) * 60);
    if (avgMins === 60) {
     avgHours += 1;
     avgMins = 0;
    }
    if (avgMins === 0) {
     document.getElementById('member_val_avgHoursPerDay').innerText = `${avgHours}h`;
    } else {
     document.getElementById('member_val_avgHoursPerDay').innerText = `${avgHours}.${String(avgMins).padStart(2,'0')}h`;
    }
   }
   if (result.weekdayOvertime && Array.isArray(result.weekdayOvertime)) {
    updateWeekdayOvertimeChart(result.weekdayOvertime);
   } else {
    updateWeekdayOvertimeChart([0, 0, 0, 0, 0]);
   }
  }
  function switchAnalysisTab(tabName) {
   document.querySelectorAll('.analysis-tab').forEach(tab => tab.classList.remove('active'));
   document.querySelectorAll('.analysis-tab-content').forEach(content => {
    content.classList.remove('active');
    content.style.display = 'none';
   });
   const targetTab = document.getElementById(`tab-${tabName}`);
   const targetButton = document.querySelector(`.analysis-tab[data-tab="${tabName}"]`);
   if (targetTab && targetButton) {
    targetButton.classList.add('active');
    targetTab.style.display = 'block';
    targetTab.classList.add('active');
   }
   if (tabName === 'commute') {
    setTimeout(() => {
     updateWeekdayCommuteChart();
    }, 300);
   }
  }
  let weekdayOvertimeChart = null;
  let weekdayCommuteChart = null;
  function updateWeekdayOvertimeChart(weekdayData) {
   const ctx = document.getElementById('weekdayOvertimeChart');
   if (!ctx) {
    return;
   }
   if (weekdayOvertimeChart) {
    weekdayOvertimeChart.destroy();
   }
   const displayData = weekdayData.every(v => v === 0) ? [0, 0, 0, 0, 0] : weekdayData;
   weekdayOvertimeChart = new Chart(ctx.getContext('2d'), {
    type: 'bar',
    data: {
     labels: ['ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼'],
     datasets: [{
      label: 'ì´ˆê³¼ê·¼ë¬´ íšŸìˆ˜',
      data: displayData,
      backgroundColor: [
       'rgba(239, 68, 68, 0.8)',
       'rgba(249, 115, 22, 0.8)',
       'rgba(234, 179, 8, 0.8)',
       'rgba(34, 197, 94, 0.8)',
       'rgba(59, 130, 246, 0.8)'
      ],
      borderColor: [
       'rgb(239, 68, 68)',
       'rgb(249, 115, 22)',
       'rgb(234, 179, 8)',
       'rgb(34, 197, 94)',
       'rgb(59, 130, 246)'
      ],
      borderWidth: 2,
      borderRadius: 6
     }]
    },
    options: {
     responsive: true,
     maintainAspectRatio: false,
     plugins: {
      legend: { display: false },
      tooltip: {
       callbacks: {
        label: function(context) {
         const actualCount = context.parsed.y;
         const dayIndex = context.dataIndex;
         if (memberCurrentCalculatedData && memberCurrentCalculatedData.weekdayMaxCount) {
          const maxCount = memberCurrentCalculatedData.weekdayMaxCount[dayIndex];
          return ` ${actualCount}/${maxCount}íšŒ`;
         }
         return ` ${actualCount}íšŒ`;
        }
       }
      }
     },
     scales: {
      y: {
       beginAtZero: true,
       ticks: {
        stepSize: 1,
        callback: function(value) {
         return value + 'íšŒ';
        }
       },
       grid: { color: '#f1f5f9' }
      },
      x: {
       grid: { display: false }
      }
     }
    }
   });
  }
  function updateWeekdayCommuteChart() {
   if (!memberCurrentCalculatedData) {
    return;
   }
   const ctx = document.getElementById('weekdayCommuteChart');
   if (!ctx) {
    return;
   }
   if (weekdayCommuteChart) {
    weekdayCommuteChart.destroy();
    weekdayCommuteChart = null;
   }
   const weekdayInData = [[], [], [], [], []];
   const weekdayOutData = [[], [], [], [], []];
   memberCurrentCalculatedData.dayByDay.forEach((day) => {
    if (!day.rawDate) return;
    try {
     const dateObj = new Date(day.rawDate);
     const dayOfWeek = dateObj.getDay();
     if (dayOfWeek >= 1 && dayOfWeek <= 5) {
      const idx = dayOfWeek - 1;
      if (day.in !== null && day.in !== undefined && day.in !== Infinity && day.in > 0) {
       weekdayInData[idx].push(day.in);
      }
      if (day.out !== null && day.out !== undefined && day.out !== -Infinity && day.out > 0) {
       weekdayOutData[idx].push(day.out);
      }
     }
    } catch(e) {}
   });
   const avgInTimes = weekdayInData.map(arr => 
    arr.length > 0 ? arr.reduce((a, b) => a + b, 0) / arr.length : null
   );
   const avgOutTimes = weekdayOutData.map(arr => 
    arr.length > 0 ? arr.reduce((a, b) => a + b, 0) / arr.length : null
   );
   const hasData = avgInTimes.some(t => t !== null) || avgOutTimes.some(t => t !== null);
   if (!hasData) {
    return;
   }
   try {
    weekdayCommuteChart = new Chart(ctx.getContext('2d'), {
    type: 'line',
    data: {
     labels: ['ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼'],
     datasets: [
      {
       label: 'í‰ê·  ì¶œê·¼',
       data: avgInTimes,
       borderColor: '#3b82f6',
       backgroundColor: 'rgba(59, 130, 246, 0.1)',
       tension: 0.4,
       fill: true,
       spanGaps: true
      },
      {
       label: 'í‰ê·  í‡´ê·¼',
       data: avgOutTimes,
       borderColor: '#8b5cf6',
       backgroundColor: 'rgba(139, 92, 246, 0.1)',
       tension: 0.4,
       fill: true,
       spanGaps: true
      }
     ]
    },
    options: {
     responsive: true,
     maintainAspectRatio: false,
     plugins: {
      legend: {
       display: true,
       position: 'top',
       labels: { font: { size: 11 } }
      },
      tooltip: {
       callbacks: {
        label: function(context) {
         const value = context.parsed.y;
         if (value === null) return null;
         const hours = Math.floor(value / 60);
         const mins = Math.round(value % 60);
         return ` ${context.dataset.label}: ${String(hours).padStart(2,'0')}:${String(mins).padStart(2,'0')}`;
        }
       }
      }
     },
     scales: {
      y: {
       beginAtZero: false,
       grace: '5%',
       ticks: {
        callback: function(value) {
         const hours = Math.floor(value / 60);
         const mins = Math.round(value % 60);
         return `${String(hours).padStart(2,'0')}:${String(mins).padStart(2,'0')}`;
        }
       },
       grid: { color: '#f1f5f9' }
      },
      x: {
       grid: { display: false }
      }
     },
     layout: {
      padding: {
       top: 10,
       bottom: 10
      }
     }
    }
   });
   weekdayCommuteChart.resize();
   weekdayCommuteChart.update('none');
   } catch(error) {
   }
  }
  window.addEventListener('DOMContentLoaded', function() {
   setTimeout(function() {
    const ctx = document.getElementById('weekdayOvertimeChart');
    if (ctx && !weekdayOvertimeChart) {
     updateWeekdayOvertimeChart([0, 0, 0, 0, 0]);
    }
   }, 1000);
  });
  document.getElementById('memberUserSelect').addEventListener('change', e => {
   if (e.target.value) {
    const userKey = e.target.value;
    if (hasAccess(userKey)) {
     selectedUserKey = userKey;
     memberUpdateUI(memberCalculateData(userKey));
     calculateDeptStats(userKey, currentMemberMonth);
     const commuteTab = document.getElementById('tab-commute');
     if (commuteTab && commuteTab.classList.contains('active')) {
      setTimeout(() => {
       updateWeekdayCommuteChart();
      }, 100);
     }
    } else {
     openPasswordModal(userKey, () => {
      selectedUserKey = userKey;
      memberUpdateUI(memberCalculateData(userKey));
      calculateDeptStats(userKey, currentMemberMonth);
      const commuteTab = document.getElementById('tab-commute');
      if (commuteTab && commuteTab.classList.contains('active')) {
       setTimeout(() => {
        updateWeekdayCommuteChart();
       }, 100);
      }
     }, false);
    }
   }
  });
  document.getElementById('memberModalClose').onclick = () => document.getElementById('memberModalOverlay').style.display = 'none';
  window.onclick = e => { if (e.target == document.getElementById('memberModalOverlay')) document.getElementById('memberModalOverlay').style.display = 'none'; };
  let ceoRawData = [], ceoDeptChart = null, ceoTeamChart = null, ceoTrendCharts = [];
  async function ceoSwitchMonth(m) {
   currentCeoMonth = m;
   document.querySelectorAll('#ceoMonthTabs .month-tab').forEach(t => { t.classList.remove('active'); t.classList.add('loading'); });
   document.querySelector(`#ceoMonthTabs .month-tab[data-month="${m}"]`).classList.add('active');
   await ceoLoadMonth(m);
   document.querySelectorAll('#ceoMonthTabs .month-tab').forEach(t => t.classList.remove('loading'));
  }
  async function ceoLoadMonth(m) { 
   if (!VACATION_DATA || VACATION_DATA.length === 0) {
    console.log('ğŸ”„ ì—°ì°¨ ë°ì´í„° ë¡œë“œ ì¤‘...');
    VACATION_DATA = await loadSheetData('íœ´ê°€');
    console.log('âœ… ì—°ì°¨ ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', VACATION_DATA?.length, 'í–‰');
    if (VACATION_DATA && VACATION_DATA.length > 0) {
     console.log('ğŸ“Š ì—°ì°¨ ì‹œíŠ¸ ì»¬ëŸ¼:', Object.keys(VACATION_DATA[0]));
     console.log('ğŸ“Š ìƒ˜í”Œ ë°ì´í„° (ì²« 3í–‰):');
     for (let i = 0; i < Math.min(3, VACATION_DATA.length); i++) {
      const row = VACATION_DATA[i];
      const compNameCol = Object.keys(row).find(k => k.includes('íšŒì‚¬ë‚´'));
      console.log(`  í–‰ ${i}: ì´ë¦„="${row['ì´ë¦„']}", íšŒì‚¬ë‚´ì´ë¦„="${row[compNameCol]}", ì”ì—¬="${row['ì”ì—¬ ì—°ì°¨'] || row['ì”ì—¬ì—°ì°¨']}"`);
     }
    } else {
     console.error('âŒ ì—°ì°¨ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤!');
    }
   }
   ceoRawData = await loadSheetData(m); 
   if (ceoRawData.length) await ceoProcessExcel(ceoRawData); 
  }
  function getCurrentMonthOrgData() {
   console.log('ğŸ” [DEBUG] getCurrentMonthOrgData ì‹œì‘');
   const teamData = {
    'ê°œë°œíŒ€': { members: {} },
    'ë©”ë””ì»¬íŒ€': { members: {} },
    'ê²½ì˜ì§€ì›íŒ€': { members: {} },
    'í’ˆì§ˆì±…ì„íŒ€': { members: {} },
    'ê¸°íš1íŒ€': { members: {} },
    'ê¸°íš2íŒ€': { members: {} }
   };
   const deptToTeamMap = {
    'Anthony': 'ê°œë°œíŒ€',
    'Greg': 'ê°œë°œíŒ€',
    'Hyuna': 'ê°œë°œíŒ€',
    'Liel': 'ê°œë°œíŒ€',
    'Sonny': 'ê°œë°œíŒ€',
    'Teddy': 'ê°œë°œíŒ€',
    'Timmy': 'ê°œë°œíŒ€',
    'Janice': 'ê¸°íš1íŒ€',
    'Lucy': 'ê¸°íš1íŒ€',
    'Sol': 'ê¸°íš1íŒ€',
    'Green': 'ê¸°íš2íŒ€',
    'Joy': 'ê¸°íš2íŒ€',
    'Newyear': 'ê¸°íš2íŒ€',
    'Spring': 'ê¸°íš2íŒ€',
    'Claire': 'ë©”ë””ì»¬íŒ€',
    'Iris': 'ë©”ë””ì»¬íŒ€',
    'Dante': 'ë©”ë””ì»¬íŒ€',
    'Guy': 'ê²½ì˜ì§€ì›íŒ€',
    'Kaylee': 'ê²½ì˜ì§€ì›íŒ€',
    'Leo': 'ê²½ì˜ì§€ì›íŒ€',
    'Jake': 'í’ˆì§ˆì±…ì„íŒ€'
   };
   ceoRawData.forEach(row => {
    const dept = row['íšŒì‚¬ë‚´ ì´ë¦„'];
    const name = row['ì´ë¦„'];
    const team = deptToTeamMap[dept];
    if (!team || !teamData[team]) return;
    const special = row['íŠ¹ì´ì‚¬í•­'] ? String(row['íŠ¹ì´ì‚¬í•­']).trim() : '';
    if (special.includes('ì…ì‚¬ì¼ ì´ì „')) return;
    const vacationMins = ceoParseToMinutes(row['íœ´ê°€ì‹œê°„']);
    if (vacationMins > 0) return;
    const inTime = ceoParseToMinutes(row['ì¶œê·¼ì‹œê°']);
    const outTime = ceoParseToMinutes(row['í‡´ê·¼ì‹œê°']);
    if (inTime <= 0 || outTime <= 0) return;
    const dateStr = row['ë‚ ì§œ'];
    if (!dateStr) return;
    let dateKey;
    try {
     const d = dateStr instanceof Date ? dateStr : new Date(dateStr);
     dateKey = d.toISOString().split('T')[0];
    } catch(e) {
     dateKey = String(dateStr);
    }
    if (!teamData[team].members[dept]) {
     teamData[team].members[dept] = {
      name: name,
      dailyData: {}
     };
    }
    if (!teamData[team].members[dept].dailyData[dateKey]) {
     teamData[team].members[dept].dailyData[dateKey] = {
      inMin: Infinity,
      outMax: -Infinity
     };
    }
    if (inTime < teamData[team].members[dept].dailyData[dateKey].inMin) {
     teamData[team].members[dept].dailyData[dateKey].inMin = inTime;
    }
    if (outTime > teamData[team].members[dept].dailyData[dateKey].outMax) {
     teamData[team].members[dept].dailyData[dateKey].outMax = outTime;
    }
   });
   const teamOrder = ['ê°œë°œíŒ€', 'ë©”ë””ì»¬íŒ€', 'ê²½ì˜ì§€ì›íŒ€', 'í’ˆì§ˆì±…ì„íŒ€', 'ê¸°íš1íŒ€', 'ê¸°íš2íŒ€'];
   const teamLabels = [];
   const teamValues = [];
   teamOrder.forEach(team => {
    const memberList = Object.values(teamData[team].members);
    teamLabels.push(team);
    if (memberList.length === 0) {
     teamValues.push(0);
    } else {
     let teamTotalMins = 0;
     let validMemberCount = 0;
     memberList.forEach(member => {
      const dates = Object.values(member.dailyData);
      if (dates.length === 0) return;
      let inSum = 0, outSum = 0, count = 0;
      dates.forEach(day => {
       const finalIn = day.inMin === Infinity ? 0 : day.inMin;
       const finalOut = day.outMax === -Infinity ? 0 : day.outMax;
       if (finalIn > 0 && finalOut > 0) {
        inSum += finalIn;
        outSum += finalOut;
        count++;
       }
      });
      if (count === 0) return;
      const avgIn = inSum / count;
      const avgOut = outSum / count;
      if (avgIn <= 0 || avgOut <= 0) return;
      let workMins = avgOut - avgIn;
      if (avgIn > avgOut) {
       workMins += 1440;
      }
      console.log(`  ${member.name} (${team}): avgIn=${(avgIn/60).toFixed(2)}h, avgOut=${(avgOut/60).toFixed(2)}h, workMins=${(workMins/60).toFixed(2)}h`);
      if (workMins < 0 || workMins > 900) {
       console.log(`    â†’ ë²”ìœ„ ì´ˆê³¼ ì œì™¸ (${(workMins/60).toFixed(2)}h)`);
       return;
      }
      workMins -= 60;
      if (workMins < 0) workMins = 0;
      if (workMins > 0) {
       teamTotalMins += workMins;
       validMemberCount++;
       console.log(`    â†’ í¬í•¨! ê·¼ë¬´ì‹œê°„=${(workMins/60).toFixed(2)}h`);
      }
     });
     const teamAvg = validMemberCount > 0 ? teamTotalMins / validMemberCount : 0;
     console.log(`  ${team} ìµœì¢…: ${(teamAvg/60).toFixed(2)}h (${validMemberCount}ëª…)`);
     teamValues.push(teamAvg);
    }
   });
   return { labels: teamLabels, values: teamValues };
  }
  function ceoParseToMinutes(val) {
   if (!val) return 0;
   if (typeof val === 'number') return Math.round(val * 24 * 60);
   if (typeof val === 'string') { const p = val.trim().split(':'); if (p.length >= 2) return parseInt(p[0]) * 60 + parseInt(p[1]); }
   return 0;
  }
    function ceoFormatHoursMinutes(mins) {
   let hours = Math.floor(mins / 60);
   let minutes = Math.round(mins % 60);
   if (minutes === 60) {
    hours += 1;
    minutes = 0;
   }
   if (minutes === 0) {
    return `${hours}ì‹œê°„`;
   }
   return `${hours}ì‹œê°„ ${minutes}ë¶„`;
  }
  function adjustPercentsTo100(values) {
   if (values.length === 0) return values;
   const rounded = values.map(v => Math.round(v * 10) / 10);
   const sum = rounded.reduce((a, b) => a + b, 0);
   const diff = Math.round((100 - sum) * 10) / 10;
   if (diff !== 0) {
    const maxIndex = rounded.indexOf(Math.max(...rounded));
    rounded[maxIndex] = Math.round((rounded[maxIndex] + diff) * 10) / 10;
   }
   return rounded;
  }
  function formatMinutesToHoursMinutes(minutes) {
   let hours = Math.floor(minutes / 60);
   let mins = Math.round(minutes % 60);
   if (mins === 60) {
    hours += 1;
    mins = 0;
   }
   if (mins === 0) {
    return `${hours}ì‹œê°„`;
   }
   return `${hours}ì‹œê°„ ${mins}ë¶„`;
  }
  const TEAM_COLORS = {
   'ê°œë°œíŒ€': '#3b82f6',
   'ê²½ì˜ì§€ì›íŒ€': '#10b981',
   'ê¸°íš1íŒ€': '#f59e0b',
   'ê¸°íš2íŒ€': '#ef4444',
   'ë©”ë””ì»¬íŒ€': '#8b5cf6',
   'í’ˆì§ˆì±…ì„íŒ€': '#6366f1',
   'ê¸°íƒ€': '#94a3b8'
  };
  function adjustPercentsTo100(values) {
   if (values.length === 0) return values;
   const total = values.reduce((sum, v) => sum + v, 0);
   if (total === 0) return values;
   const rounded = values.map(p => Math.round(p * 10) / 10);
   const sum = rounded.reduce((s, v) => s + v, 0);
   const diff = Math.round((100 - sum) * 10) / 10;
   if (diff !== 0) {
    const maxIndex = rounded.indexOf(Math.max(...rounded));
    rounded[maxIndex] = Math.round((rounded[maxIndex] + diff) * 10) / 10;
   }
   return rounded;
  }
  let currentDeptToTeamMap = {};
  function getDeptTeamCategory(deptName) {
   return currentDeptToTeamMap[deptName] || 'ê¸°íƒ€';
  }
  function ceoInitCharts(deptData, teamData, trendData) {
   const titleElement = document.getElementById('ceoTrendChartTitle');
   if (titleElement) {
    titleElement.textContent = `# ${currentCeoMonth} ì¡°ì§ë³„ í•˜ë£¨ í‰ê·  ê·¼ë¬´ì‹œê°„`;
   }
   const ctxDept = document.getElementById('ceoDeptChart').getContext('2d');
   if (ceoDeptChart) ceoDeptChart.destroy();
   const deptColors = deptData.labels.map(deptName => {
    const teamCat = getDeptTeamCategory(deptName);
    return TEAM_COLORS[teamCat] || TEAM_COLORS['ê¸°íƒ€'];
   });
   ceoDeptChart = new Chart(ctxDept, {
    type: 'doughnut',
    data: {
     labels: deptData.labels,
     datasets: [{
      data: deptData.values,
      backgroundColor: deptColors,
      borderWidth: 0,
      hoverOffset: 20
     }]
    },
    options: {
     responsive: true,
     maintainAspectRatio: false,
     plugins: {
      legend: {
       position: 'bottom',
       labels: {
        usePointStyle: true,
        padding: 15,
        font: { size: 14 }
       }
      },
      tooltip: {
       callbacks: {
        label: function(context) {
         const label = context.label || '';
         const value = context.parsed || 0;
         return ` ${label}: ${value.toFixed(1)}%`;
        }
       }
      }
     },
     cutout: '65%'
    }
   });
   const ctxTeam = document.getElementById('ceoTeamChart').getContext('2d');
   if (ceoTeamChart) ceoTeamChart.destroy();
   const teamColors = teamData.labels.map(teamName => TEAM_COLORS[teamName] || TEAM_COLORS['ê¸°íƒ€']);
   ceoTeamChart = new Chart(ctxTeam, {
    type: 'pie',
    data: {
     labels: teamData.labels,
     datasets: [{
      data: teamData.values,
      backgroundColor: teamColors,
      borderWidth: 2,
      borderColor: '#fff'
     }]
    },
    options: {
     responsive: true,
     maintainAspectRatio: false,
     onClick: (event, elements) => {
      if (elements.length > 0) {
       const index = elements[0].index;
       const teamName = teamData.labels[index];
       showCeoTeamDetailModal(teamName);
      }
     },
     plugins: {
      legend: {
       position: 'bottom',
       labels: {
        usePointStyle: true,
        padding: 15,
        font: { size: 14, weight: 'bold' }
       },
       onClick: (event, legendItem, legend) => {
        const index = legendItem.index;
        const teamName = teamData.labels[index];
        showCeoTeamDetailModal(teamName);
       }
      },
      tooltip: {
       callbacks: {
        label: function(context) {
         const label = context.label || '';
         const value = context.parsed || 0;
         return ` ${label}: ${value.toFixed(1)}%`;
        }
       }
      }
     }
    }
   });
   ceoTrendCharts.forEach(chart => {
    if (chart) chart.destroy();
   });
   ceoTrendCharts = [];
   const container = document.getElementById('ceoTrendChartsContainer');
   container.innerHTML = '';
   if (!trendData.labels || trendData.labels.length === 0) {
    container.innerHTML = '<p class="text-center text-gray-500 py-8">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</p>';
    return;
   }
   container.innerHTML = '<div style="height: 500px;"><canvas id="ceoOrgTrendChart"></canvas></div>';
   const canvas = document.getElementById('ceoOrgTrendChart');
   const ctx = canvas.getContext('2d');
   const orgColors = trendData.labels.map((orgName) => {
    const teamCat = getDeptTeamCategory(orgName);
    return TEAM_COLORS[teamCat] || TEAM_COLORS['ê¸°íƒ€'];
   });
   const chart = new Chart(ctx, {
    type: 'bar',
    data: {
     labels: trendData.labels,
     datasets: [{
      label: 'í•˜ë£¨ í‰ê·  ê·¼ë¬´ì‹œê°„',
      data: trendData.values,
      backgroundColor: orgColors,
      borderRadius: 8,
      barThickness: 50
     }]
    },
    options: {
     responsive: true,
     maintainAspectRatio: false,
     plugins: {
      legend: { display: false },
      tooltip: {
       callbacks: {
        label: function(context) {
         return ` ${formatMinutesToHoursMinutes(context.parsed.y)}`;
        }
       }
      }
     },
     scales: {
      y: {
       beginAtZero: true,
       grid: { color: '#f1f5f9' },
       ticks: {
        callback: function(value) {
         return formatMinutesToHoursMinutes(value);
        },
        font: { size: 13 }
       },
       title: {
        display: true,
        text: 'í•˜ë£¨ í‰ê·  ê·¼ë¬´ì‹œê°„',
        font: { size: 15, weight: 'bold' }
       }
      },
      x: {
       grid: { display: false },
       ticks: {
        font: { size: 14 }
       },
       title: {
        display: true,
        text: 'ì¡°ì§',
        font: { size: 15, weight: 'bold' }
       }
      }
     }
    }
   });
   ceoTrendCharts.push(chart);
  }
  async function ceoProcessExcel(data) {
   const users = {}, departments = {}, teams = {}, weekdayTrend = {}, missingStats = {};
   const weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
   const weekdayData = { 'ì›”': [], 'í™”': [], 'ìˆ˜': [], 'ëª©': [], 'ê¸ˆ': [], 'í† ': [], 'ì¼': [] };
   const dailyPersonData = {};
   const deptToTeamMap = {
    'Anthony': 'ê°œë°œíŒ€',
    'Greg': 'ê°œë°œíŒ€',
    'Hyuna': 'ê°œë°œíŒ€',
    'Liel': 'ê°œë°œíŒ€',
    'Sonny': 'ê°œë°œíŒ€',
    'Teddy': 'ê°œë°œíŒ€',
    'Timmy': 'ê°œë°œíŒ€',
    'Janice': 'ê¸°íš1íŒ€',
    'Lucy': 'ê¸°íš1íŒ€',
    'Sol': 'ê¸°íš1íŒ€',
    'Green': 'ê¸°íš2íŒ€',
    'Joy': 'ê¸°íš2íŒ€',
    'Newyear': 'ê¸°íš2íŒ€',
    'Spring': 'ê¸°íš2íŒ€',
    'Claire': 'ë©”ë””ì»¬íŒ€',
    'Iris': 'ë©”ë””ì»¬íŒ€',
    'Dante': 'ë©”ë””ì»¬íŒ€',
    'Guy': 'ê²½ì˜ì§€ì›íŒ€',
    'Kaylee': 'ê²½ì˜ì§€ì›íŒ€',
    'Leo': 'ê²½ì˜ì§€ì›íŒ€',
    'Jake': 'í’ˆì§ˆì±…ì„íŒ€'
   };
   let totalOverMins = 0, totalMissingCount = 0;
   data.forEach(row => {
    const name = row['ì´ë¦„'], dept = row['íšŒì‚¬ë‚´ ì´ë¦„'] || 'ë¯¸ë¶„ë¥˜';
    const dateStr = row['ë‚ ì§œ'];
    const workMins = ceoParseToMinutes(row['ì´ ê·¼ë¬´']);
    const vacationMins = ceoParseToMinutes(row['íœ´ê°€ì‹œê°„']);
    const inTime = row['ì¶œê·¼ì‹œê°'], outTime = row['í‡´ê·¼ì‹œê°'], policy = row['ê·¼ë¬´ì •ì±…'], leavePolicy = row['íœ´ê°€ì •ì±…'], holidayType = row['íœ´ì¼êµ¬ë¶„'];
    const specialNote = row['íŠ¹ì´ì‚¬í•­'] ? String(row['íŠ¹ì´ì‚¬í•­']).trim() : '';
    const isBeforeJoinDate = specialNote.includes('ì…ì‚¬ì¼ ì´ì „');
    if (!name) return;
    if (isBeforeJoinDate) return;
    const userId = `${name}_${dept}`;
    if (!users[userId]) {
     users[userId] = {
      name,
      dept,
      overMins: 0,
      totalMins: 0,
      workDays: 0,
      missingCount: 0,
      dailyMap: new Map()
     };
     if (!missingStats[name]) missingStats[name] = 0;
    }
    const isOffDay = (holidayType && String(holidayType).trim() !== '');
    const isNoPolicy = !policy || String(policy).trim() === '';
    const isTimeMissing = (!inTime || String(inTime).trim() === '') || (!outTime || String(outTime).trim() === '');
    if (dateStr) {
     let dateKey;
     try {
      const d = dateStr instanceof Date ? dateStr : new Date(dateStr);
      dateKey = d.toISOString().split('T')[0];
     } catch(e) {
      dateKey = String(dateStr);
     }
     if (!users[userId].dailyMap.has(dateKey)) {
      users[userId].dailyMap.set(dateKey, {
       workMins: 0,
       vacationMins: 0,
       hasHolidayType: false,
       hasPolicy: false
      });
     }
     const dayData = users[userId].dailyMap.get(dateKey);
     dayData.workMins += workMins;
     dayData.vacationMins += vacationMins;
     if (isOffDay) dayData.hasHolidayType = true;
     if (!isNoPolicy) dayData.hasPolicy = true;
    }
    if (!isOffDay && dateStr) {
     try {
      let d;
      if (dateStr instanceof Date) {
       d = dateStr;
      } else if (typeof dateStr === 'string' && dateStr.includes('-')) {
       d = new Date(dateStr);
      } else {
       d = new Date(dateStr);
      }
      const dayOfWeek = weekdays[d.getDay()];
      const dateKey = `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
      const personDateKey = `${name}_${dateKey}`;
      if (!dailyPersonData[personDateKey]) {
       dailyPersonData[personDateKey] = {
        name: name,
        date: dateKey,
        dayOfWeek: dayOfWeek,
        totalMins: 0
       };
      }
      dailyPersonData[personDateKey].totalMins += workMins;
     } catch(e) {
     }
    }
   });
   Object.values(users).forEach(user => {
    let workDays = 0;
    let totalMins = 0;
    let missingCount = 0;
    user.dailyMap.forEach((dayData, dateKey) => {
     const isWorkDay = !dayData.hasHolidayType;
     if (isWorkDay) {
      workDays++;
     }
     const dayTotal = dayData.workMins + dayData.vacationMins;
     totalMins += dayTotal;
     const isNoPolicy = !dayData.hasPolicy;
     const isInsufficientTime = dayTotal > 0 && dayTotal < 470;
     if (isWorkDay && (isNoPolicy || isInsufficientTime)) {
      missingCount++;
     }
    });
    user.workDays = workDays;
    user.totalMins = totalMins;
    user.missingCount = missingCount;
    totalMissingCount += missingCount;
    if (!missingStats[user.name]) missingStats[user.name] = 0;
    missingStats[user.name] += missingCount;
    const stdMins = workDays * 480;
    user.overMins = Math.max(0, totalMins - stdMins);
    totalOverMins += user.overMins;
    if (!departments[user.dept]) departments[user.dept] = 0;
    departments[user.dept] += user.overMins;
    const teamCat = deptToTeamMap[user.dept] || 'ê¸°íƒ€';
    if (teamCat !== 'EXCLUDED') {
     if (!teams[teamCat]) teams[teamCat] = 0;
     teams[teamCat] += user.overMins;
    }
   });
   Object.values(dailyPersonData).forEach(personDay => {
    if (personDay.totalMins > 0 && weekdayData[personDay.dayOfWeek]) {
     weekdayData[personDay.dayOfWeek].push(personDay.totalMins);
    }
   });
   const weekdayLabels = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ'];
   const weekdayValues = weekdayLabels.map(day => {
    const dayData = weekdayData[day];
    if (dayData.length === 0) return 0;
    const avgMins = dayData.reduce((sum, val) => sum + val, 0) / dayData.length;
    return avgMins;
   });
   const vacationData = await getTotalVacationByMonth(currentCeoMonth);
   console.log('ğŸ’¾ vacationData ê²°ê³¼:', vacationData);
   ceoVacationDetails = vacationData.details;
   console.log('ğŸ’¾ ceoVacationDetails ì„¤ì •:', ceoVacationDetails.length, 'ê±´');
   ceoMissingDetails = Object.entries(missingStats).filter(([name, count]) => count > 0).sort((a, b) => b[1] - a[1]).map(([name, count]) => ({ name, count }));
   const userList = Object.values(users);
   document.getElementById('ceo_stat_totalPeople').innerText = `${userList.length} ëª…`;
   document.getElementById('ceo_stat_totalOver').innerText = ceoFormatHoursMinutes(totalOverMins);
   document.getElementById('ceo_stat_missingCount').innerText = `${totalMissingCount} ê±´`;
   document.getElementById('ceo_stat_totalVacation').innerText = `${vacationData.total.toFixed(1)} ì¼`;
   document.getElementById('ceoPopupNameList').innerHTML = userList.sort((a,b) => a.name.localeCompare(b.name)).map(u => `<div class="flex justify-between items-center py-2 border-b border-gray-50 hover:bg-blue-50 px-1 rounded cursor-pointer transition-colors" onclick="switchToMemberView('${u.name}', '${u.dept}', currentCeoMonth)"><span class="font-bold text-gray-700">${u.name}</span><span class="text-[10px] bg-blue-50 text-blue-600 px-2 py-0.5 rounded-full font-medium">${u.dept}</span></div>`).join('');
   const top5 = [...userList].sort((a,b) => b.overMins - a.overMins).slice(0, 5);
   document.getElementById('ceoTopList').innerHTML = top5.map((u,i) => `<div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl"><div class="flex items-center gap-3"><span class="w-8 h-8 flex items-center justify-center bg-gray-200 rounded-full text-xs font-bold">${i+1}</span><div><p class="text-base font-bold text-gray-800">${u.name}</p><p class="text-xs text-gray-500">${u.dept}</p></div></div><div class="text-right"><p class="text-red-600 text-lg font-bold">${ceoFormatHoursMinutes(u.overMins)}</p></div></div>`).join('');
   const deptEntries = Object.entries(departments).filter(([dept, mins]) => mins > 0);
   const deptLabels = deptEntries.map(([dept, mins]) => dept);
   const deptValuesRaw = deptEntries.map(([dept, mins]) => mins);
   const deptTotal = deptValuesRaw.reduce((sum, v) => sum + v, 0);
   const deptValuesPercent = deptTotal > 0 ? deptValuesRaw.map(v => (v / deptTotal * 100)) : deptValuesRaw;
   const deptValues = adjustPercentsTo100(deptValuesPercent);
   const teamLabels = Object.keys(teams);
   const teamValuesRaw = Object.values(teams);
   const teamTotal = teamValuesRaw.reduce((sum, v) => sum + v, 0);
   const teamValuesPercent = teamTotal > 0 ? teamValuesRaw.map(v => (v / teamTotal * 100)) : teamValuesRaw;
   const teamValues = adjustPercentsTo100(teamValuesPercent);
   currentDeptToTeamMap = deptToTeamMap;
   ceoTeamMembersData = {};
   userList.forEach(user => {
    const team = deptToTeamMap[user.dept] || 'ê¸°íƒ€';
    if (team !== 'EXCLUDED' && user.overMins > 0) {
     if (!ceoTeamMembersData[team]) {
      ceoTeamMembersData[team] = [];
     }
     ceoTeamMembersData[team].push({
      name: user.name,
      dept: user.dept,
      overMins: user.overMins
     });
    }
   });
   Object.keys(ceoTeamMembersData).forEach(team => {
    ceoTeamMembersData[team].sort((a, b) => b.overMins - a.overMins);
   });
   const orgMonthlyData = getCurrentMonthOrgData();
   ceoInitCharts({ labels: deptLabels, values: deptValues }, { labels: teamLabels, values: teamValues }, orgMonthlyData);
  }
  ceoInitCharts({labels:[],values:[]},{labels:[],values:[]},{labels:[],values:[]});
  function saveNoIssue(pageType) {
   const now = new Date();
   const dateStr = now.toLocaleString('ko-KR', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
   });
   let userName = 'ì•Œ ìˆ˜ ì—†ìŒ';
   let userDept = 'ì•Œ ìˆ˜ ì—†ìŒ';
   let currentMonth = '';
   if (pageType === 'member') {
    currentMonth = currentMemberMonth;
    const selectElement = document.getElementById('memberUserSelect');
    if (selectElement && selectElement.value) {
     const userKey = selectElement.value;
     const userName_raw = userKey.split('|')[0];
     userName = userName_raw;
     if (memberRawData && memberRawData.length > 0) {
      const userRecord = memberRawData.find(r => r['ì´ë¦„'] === userName_raw);
      if (userRecord) {
       userDept = userRecord['ë¶€ì„œ'] || 'ì•Œ ìˆ˜ ì—†ìŒ';
      }
     }
    }
   } else if (pageType === 'ceo') {
    currentMonth = currentCeoMonth;
    userName = 'CEO';
    userDept = 'ê²½ì˜ì§€ì›íŒ€';
   }
   let records = JSON.parse(localStorage.getItem('noIssueRecords') || '[]');
   const existingRecord = records.find(r => r.name === userName && r.month === currentMonth);
   if (existingRecord) {
    alert(`ì´ë¯¸ ${currentMonth}ì— ì´ìƒ ì—†ìŒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.\ní™•ì¸ ì¼ì‹œ: ${existingRecord.datetime}`);
    return;
   }
   const record = {
    id: Date.now(),
    name: userName,
    dept: userDept,
    datetime: dateStr,
    month: currentMonth,
    page: pageType === 'ceo' ? 'CEO í˜ì´ì§€' : 'êµ¬ì„±ì› í˜ì´ì§€',
    timestamp: now.getTime()
   };
   records.push(record);
   localStorage.setItem('noIssueRecords', JSON.stringify(records));
   alert('ì´ìƒ ì—†ìŒì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤!');
  }
  let currentAdminMonth = 'ì „ì²´';
  function loadAdminData(filterMonth = 'ì „ì²´') {
   const records = JSON.parse(localStorage.getItem('noIssueRecords') || '[]');
   const filteredRecords = filterMonth === 'ì „ì²´'
    ? records
    : records.filter(r => r.month === filterMonth);
   const totalCount = filteredRecords.length;
   const today = new Date();
   today.setHours(0, 0, 0, 0);
   const todayCount = filteredRecords.filter(r => {
    const recordDate = new Date(r.timestamp);
    recordDate.setHours(0, 0, 0, 0);
    return recordDate.getTime() === today.getTime();
   }).length;
   const lastCheck = filteredRecords.length > 0
    ? filteredRecords[filteredRecords.length - 1].datetime
    : '-';
   document.getElementById('adminTotalCount').innerText = totalCount;
   document.getElementById('adminTodayCount').innerText = todayCount;
   document.getElementById('adminLastCheck').innerText = lastCheck;
   const tbody = document.getElementById('adminTableBody');
   if (filteredRecords.length === 0) {
    tbody.innerHTML = `
     <tr>
      <td colspan="6" style="text-align: center; color: #94a3b8; padding: 40px;">
       ${filterMonth === 'ì „ì²´' ? 'ì•„ì§ í™•ì¸ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.' : filterMonth + 'ì— í™•ì¸ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.'}
      </td>
     </tr>
    `;
   } else {
    tbody.innerHTML = filteredRecords
     .sort((a, b) => b.timestamp - a.timestamp)
     .map((r, idx) => `
      <tr>
       <td>${filteredRecords.length - idx}</td>
       <td style=\"font-weight: 600;\">${r.name}</td>
       <td><span style="background: #f0fdf4; color: #15803d; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">${r.month || '-'}</span></td>
       <td>${r.datetime}</td>
       <td>${r.page}</td>
       <td>
        <button class="delete-btn" onclick="adminDeleteRecord(${r.id})">ì‚­ì œ</button>
       </td>
      </tr>
     `)
     .join('');
   }
  }
  function adminFilterByMonth(month) {
   currentAdminMonth = month;
   document.getElementById('adminMonthSelect').value = month;
   loadAdminData(month);
  }
  function adminDeleteRecord(id) {
   if (!confirm('ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
   let records = JSON.parse(localStorage.getItem('noIssueRecords') || '[]');
   records = records.filter(r => r.id !== id);
   localStorage.setItem('noIssueRecords', JSON.stringify(records));
   loadAdminData(currentAdminMonth);
  }
  function adminClearAll() {
   if (!confirm('ì •ë§ë¡œ ëª¨ë“  ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) return;
   localStorage.removeItem('noIssueRecords');
   loadAdminData(currentAdminMonth);
   alert('ëª¨ë“  ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
  }
  document.getElementById('passwordInput').addEventListener('keypress', (e) => {
   if (e.key === 'Enter') {
    verifyInitialPassword();
   }
  });
  document.querySelectorAll('.help-icon').forEach(icon => {
   icon.addEventListener('click', function(e) {
    e.stopPropagation();
    this.classList.toggle('active');
   });
  });
  document.addEventListener('click', function(e) {
   if (!e.target.closest('.help-icon')) {
    document.querySelectorAll('.help-icon').forEach(icon => {
     icon.classList.remove('active');
    });
   }
  });
  document.getElementById('passwordInput').focus();
 </script>
<!-- VERSION: 2025-01-06-v2 ë‚ ì§œë³„ ê·¸ë£¹í™” ì ìš© -->
</body></html>
