<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í†µí•© ê·¼íƒœ ë¶„ì„ ì‹œìŠ¤í…œ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background: #f4f7fa; }
        .view { display: none; }
        .view.active { display: block; }
        .month-tabs { display: flex; gap: 12px; margin-bottom: 30px; padding: 20px; background: white; border-radius: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); flex-wrap: wrap; }
        .month-tab { padding: 12px 24px; border-radius: 10px; background: #f1f5f9; color: #64748b; border: 2px solid transparent; cursor: pointer; font-weight: 600; transition: all 0.3s ease; font-size: 14px; }
        .month-tab:hover { background: #e2e8f0; transform: translateY(-2px); }
        .month-tab.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-color: #667eea; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
        .month-tab.loading { opacity: 0.6; cursor: wait; }
        
        /* ê°œì¸/ì¡°ì§ íƒ­ */
        .view-tabs { display: flex; gap: 8px; margin-bottom: 20px; padding: 16px 20px; background: white; border-radius: 12px; box-shadow: 0 1px 4px rgba(0,0,0,0.05); }
        .view-tab { padding: 10px 20px; border-radius: 8px; background: #f8fafc; color: #64748b; border: 2px solid transparent; cursor: pointer; font-weight: 600; transition: all 0.3s ease; font-size: 14px; }
        .view-tab:hover { background: #e2e8f0; }
        .view-tab.active { background: white; color: #667eea; border-color: #667eea; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15); }
        .member-view-content { display: none; }
        .member-view-content.active { display: block; }
        
        .stat-card { transition: all 0.3s ease; position: relative; }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-card.clickable { cursor: pointer; }
        .member-list-popup { visibility: hidden; opacity: 0; position: absolute; top: calc(100% + 10px); left: 0; width: 280px; max-height: 350px; background: white; border-radius: 12px; box-shadow: 0 15px 35px rgba(0,0,0,0.2); z-index: 100; padding: 16px; border: 1px solid #e2e8f0; overflow-y: auto; transition: opacity 0.2s ease, visibility 0.2s ease; }
        .stat-card:hover .member-list-popup { visibility: visible; opacity: 1; }
        .member-list-popup::-webkit-scrollbar { width: 6px; }
        .member-list-popup::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 10px; }
        .info-card { background: #f8fafc; border-radius: 12px; padding: 20px; transition: transform 0.2s; cursor: pointer; position: relative; }
        .info-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); background: #f1f5f9; }
        .info-card::after { content: 'ğŸ”'; position: absolute; top: 10px; right: 10px; font-size: 12px; opacity: 0.3; }
        
        /* ìƒíƒœ ì› ìŠ¤íƒ€ì¼ */
        .status-dot { 
            display: inline-block; 
            width: 18px; 
            height: 18px; 
            border-radius: 50%; 
            margin-right: 8px; 
            position: relative;
            cursor: help;
            transition: transform 0.2s;
        }
        .status-dot:hover {
            transform: scale(1.3);
        }
        .status-dot.green { background-color: #10b981; }
        .status-dot.red { background-color: #ef4444; }
        
        /* íˆ´íŒ ìŠ¤íƒ€ì¼ */
        .status-dot[data-tooltip] {
            position: relative;
        }
        .status-dot[data-tooltip]::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 13px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 1000;
            line-height: 1.4;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .status-dot[data-tooltip]::before {
            content: '';
            position: absolute;
            bottom: calc(100% + 4px);
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.9);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 1000;
        }
        .status-dot[data-tooltip]:hover::after,
        .status-dot[data-tooltip]:hover::before {
            opacity: 1;
        }
        
        /* Footer ìŠ¤íƒ€ì¼ */
        .page-footer { 
            margin-top: 60px; 
            padding: 30px 20px; 
            background: #f8fafc; 
            border-top: 1px solid #e2e8f0;
            text-align: center;
        }
        .footer-content { 
            max-width: 800px; 
            margin: 0 auto; 
            color: #64748b; 
            font-size: 13px; 
            line-height: 1.8;
        }
        .no-issue-btn {
            display: inline-block;
            padding: 8px 20px;
            margin: 0 6px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #059669;
            text-decoration: none;
        }
        .no-issue-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }
        .help-icon {
            display: inline-block;
            width: 18px;
            height: 18px;
            background: #94a3b8;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 18px;
            font-size: 12px;
            font-weight: bold;
            cursor: help;
            position: relative;
            margin-left: 4px;
        }
        .help-tooltip {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #1e293b;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            white-space: nowrap;
            z-index: 1000;
            transition: opacity 0.3s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .help-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #1e293b;
        }
        .help-icon:hover .help-tooltip {
            visibility: visible;
            opacity: 1;
        }
        .mail-link {
            color: #3b82f6;
            text-decoration: underline;
            font-weight: 600;
        }
        .mail-link:hover {
            color: #2563eb;
        }
        
        /* ê´€ë¦¬ì í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        .admin-view {
            display: none;
        }
        .admin-view.active {
            display: block;
        }
        .admin-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .admin-stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #10b981;
        }
        .admin-stat-value {
            font-size: 32px;
            font-weight: 800;
            color: #1e293b;
            margin: 10px 0;
        }
        .admin-stat-label {
            font-size: 12px;
            color: #64748b;
            text-transform: uppercase;
            font-weight: 600;
        }
        .admin-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .admin-table table {
            width: 100%;
            border-collapse: collapse;
        }
        .admin-table th {
            background: #f8fafc;
            padding: 15px;
            text-align: left;
            font-size: 12px;
            font-weight: 700;
            color: #475569;
            text-transform: uppercase;
            border-bottom: 2px solid #e2e8f0;
        }
        .admin-table td {
            padding: 15px;
            border-bottom: 1px solid #f1f5f9;
            color: #334155;
        }
        .admin-table tr:hover {
            background: #f8fafc;
        }
        .delete-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
        }
        .delete-btn:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }
        .clear-all-btn {
            background: #f59e0b;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 20px;
            transition: all 0.3s;
        }
        .clear-all-btn:hover {
            background: #d97706;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
        }
        
        .label { font-size: 12px; color: #64748b; font-weight: 600; text-transform: uppercase; margin-bottom: 5px; }
        .value { font-size: 24px; font-weight: 800; color: #1e293b; }
        .sub-value { font-size: 13px; color: #94a3b8; margin-top: 4px; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(4px); }
        .modal-content { background: white; width: 90%; max-width: 800px; border-radius: 20px; padding: 30px; position: relative; max-height: 85vh; overflow-y: auto; }
        .modal-close { position: absolute; top: 20px; right: 20px; font-size: 24px; cursor: pointer; color: #64748b; }
        .modal-title { font-size: 20px; font-weight: 700; margin-bottom: 20px; color: #1e293b; border-bottom: 2px solid #f1f5f9; padding-bottom: 10px; }
        .modal-chart-wrapper { height: 350px; width: 100%; margin-bottom: 20px; }
        .modal-list-wrapper { max-height: 400px; overflow-y: auto; background: #f8fafc; border-radius: 10px; padding: 15px; }
        .modal-list-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e2e8f0; font-size: 14px; }
        .modal-list-item:last-child { border-bottom: none; }
        .nav-button { position: fixed; top: 20px; left: 20px; background: white; color: #667eea; border: none; padding: 10px 20px; border-radius: 10px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.15); transition: all 0.3s ease; z-index: 999; }
        .nav-button:hover { background: #667eea; color: white; transform: translateY(-2px); box-shadow: 0 6px 16px rgba(0,0,0,0.2); }
        .header-button:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        select { background: white; color: #1f2937; }
        select option { color: #1f2937; background: white; }
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; }
        #ceoTeamChart { cursor: pointer; }
        .team-chart-hint { font-size: 11px; color: #94a3b8; text-align: center; margin-top: 8px; font-style: italic; }
        .loading-spinner { width: 50px; height: 50px; border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .loading-text { margin-top: 20px; font-size: 16px; color: #64748b; }
        .remain-vacation-card { background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); border-radius: 16px; padding: 24px; color: white; margin-bottom: 24px; box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3); }
        .remain-vacation-card .label { color: rgba(255, 255, 255, 0.9); font-size: 14px; margin-bottom: 8px; }
        .remain-vacation-card .value { color: white; font-size: 36px; font-weight: 900; }
        .remain-vacation-card .sub-value { color: rgba(255, 255, 255, 0.8); font-size: 14px; margin-top: 8px; }
        
        /* ì•”í˜¸ ì…ë ¥ ëª¨ë‹¬ */
        .password-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; justify-content: center; align-items: center; backdrop-filter: blur(8px); }
        .password-modal.active { display: flex; }
        .password-box { background: white; border-radius: 20px; padding: 40px; max-width: 400px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .password-title { font-size: 24px; font-weight: 700; color: #1e293b; margin-bottom: 10px; text-align: center; }
        .password-subtitle { font-size: 14px; color: #64748b; margin-bottom: 30px; text-align: center; }
        .password-input { width: 100%; padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 16px; transition: all 0.3s; }
        .password-input:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        .password-input.error { border-color: #ef4444; animation: shake 0.5s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
        .password-buttons { display: flex; gap: 10px; margin-top: 20px; }
        .password-btn { flex: 1; padding: 12px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .password-btn.submit { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .password-btn.submit:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
        .password-btn.cancel { background: #f1f5f9; color: #64748b; }
        .password-btn.cancel:hover { background: #e2e8f0; }
        .password-error { color: #ef4444; font-size: 14px; margin-top: 10px; text-align: center; display: none; }
        .password-error.active { display: block; }
        .lock-icon { font-size: 48px; text-align: center; margin-bottom: 20px; }
    </style>
</head>
<body>
    <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-spinner"></div>
        <div class="loading-text">Google Sheetsì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>

    <!-- ì•”í˜¸ ì…ë ¥ ëª¨ë‹¬ -->
    <div class="password-modal active" id="passwordModal">
        <div class="password-box">
            <div class="lock-icon">ğŸ”’</div>
            <div class="password-title" id="passwordTitle">ê·¼íƒœ ì‹œìŠ¤í…œ ë¡œê·¸ì¸</div>
            <div class="password-subtitle" id="passwordSubtitle">ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì—¬ í˜ì´ì§€ì— ì ‘ê·¼í•˜ì„¸ìš”</div>
            <input type="password" class="password-input" id="passwordInput" placeholder="ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
            <div class="password-error" id="passwordError">âŒ ì•”í˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤</div>
            <div class="password-buttons">
                <button class="password-btn submit" onclick="verifyInitialPassword()" style="width: 100%;">ë¡œê·¸ì¸</button>
            </div>
        </div>
    </div>

    <!-- êµ¬ì„±ì› ë·° -->
    <div id="memberView" class="view">
        <button class="nav-button" onclick="showView('ceo')">CEOìš©ìœ¼ë¡œ ì´ë™ â†’</button>
        <div class="modal-overlay" id="memberModalOverlay">
            <div class="modal-content">
                <span class="modal-close" id="memberModalClose">&times;</span>
                <div class="modal-title" id="memberModalTitle">ìƒì„¸ ë‚´ì—­</div>
                <div class="modal-chart-wrapper"><canvas id="memberModalChart"></canvas></div>
                <div class="modal-list-wrapper" id="memberModalList"></div>
            </div>
        </div>
        <div class="p-6 md:p-10">
            <div class="max-w-7xl mx-auto bg-white rounded-2xl shadow-lg overflow-hidden">
                <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-8">
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
                        <div style="min-width: 300px;">
                            <h1 id="memberReportTitle" class="text-3xl font-bold mb-2" style="word-break: keep-all; white-space: normal;">ğŸ“Š ê·¼íƒœ ì •ì‚° ë¦¬í¬íŠ¸</h1>
                            <p class="opacity-90">ì›”ë³„ íƒ­ì„ ì„ íƒí•˜ê³  êµ¬ì„±ì›ì„ ì„ íƒí•˜ì„¸ìš”</p>
                        </div>
                        <div class="flex items-center gap-4 bg-white bg-opacity-20 p-4 rounded-xl backdrop-blur-sm">
                            <select id="memberUserSelect" disabled class="px-4 py-2.5 rounded-lg border-none font-medium bg-white text-gray-800">
                                <option>ëŒ€ìƒì ì„ íƒ</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="month-tabs" id="memberMonthTabs">
                    <div class="month-tab active" data-month="9ì›”" onclick="memberSwitchMonth('9ì›”')">ğŸ“… 9ì›”</div>
                    <div class="month-tab" data-month="10ì›”" onclick="memberSwitchMonth('10ì›”')">ğŸ“… 10ì›”</div>
                    <div class="month-tab" data-month="11ì›”" onclick="memberSwitchMonth('11ì›”')">ğŸ“… 11ì›”</div>
                </div>
                
                <div class="p-8">
                    <!-- ê°œì¸ ì •ë³´ ë·° -->
                    <div id="personalView" class="member-view-content active">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <div class="info-card blue" onclick="memberShowDetail('workDays')">
                                    <div class="label"><span class="status-dot green" data-tooltip="ì´ë²ˆ ë‹¬ì˜ ê³µíœ´ì¼ íœ´ë¬´ì¼ì„ ì œì™¸í•œ ê·¼ë¬´ì¼ì…ë‹ˆë‹¤."></span>ê·¼ë¬´ì¼</div>
                                    <div class="value" id="member_val_workDays">-</div>
                                    <div class="sub-value">ì¤‘ë³µ ì œì™¸ ê·¼ë¬´ ì¼ìˆ˜</div>
                                </div>
                                <div class="info-card blue">
                                    <div class="label"><span class="status-dot green" data-tooltip="ì¼ì¼ ê·¼ë¬´ì‹œê°„ X ê·¼ë¬´ì¼ì„ í•œ ì‹œê°„ì…ë‹ˆë‹¤."></span>ê¸°ì¤€ ê·¼ë¡œì‹œê°„</div>
                                    <div class="value" id="member_val_stdHours">-</div>
                                    <div class="sub-value">ê·¼ë¬´ì¼ Ã— 8ì‹œê°„</div>
                                </div>
                                <div class="info-card purple" onclick="memberShowDetail('totalHours')">
                                    <div class="label"><span class="status-dot green" id="total_status_dot"></span>ì´ ê·¼ë¬´ì‹œê°„</div>
                                    <div class="value" id="member_val_totalHours">-</div>
                                    <div class="sub-value">ì‹¤ì œ ê·¼ë¬´ í•©ê³„</div>
                                </div>
                                <div class="info-card red" onclick="memberShowDetail('overTime')">
                                    <div class="label"><span class="status-dot red" id="overtime_status_dot"></span>ì´ˆê³¼ ê·¼ë¬´</div>
                                    <div class="value" id="member_val_overTime">-</div>
                                    <div class="sub-value">ì´ ê·¼ë¬´ - ê¸°ì¤€ ì‹œê°„</div>
                                </div>
                                <div class="info-card green" onclick="memberShowDetail('vacation')">
                                    <div class="label"><span class="status-dot green" data-tooltip="ì´ë²ˆ ë‹¬ ì‚¬ìš©í•œ ì—°ì°¨ì…ë‹ˆë‹¤."></span>íœ´ê°€ ì‚¬ìš©</div>
                                    <div class="value" id="member_val_vacation">-</div>
                                    <div class="sub-value">ì´ë²ˆ ë‹¬ ì‚¬ìš©í•œ ì—°ì°¨</div>
                                </div>
                                <div class="info-card red" onclick="memberShowDetail('missing')">
                                    <div class="label"><span class="status-dot green" id="missing_status_dot"></span>ê¸°ë¡ ëˆ„ë½</div>
                                    <div class="value" id="member_val_missing">-</div>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <div class="info-card" onclick="memberShowDetail('avgIn')">
                                    <div class="label"><span class="status-dot green" id="avgin_status_dot"></span>í‰ê·  ì¶œê·¼ ì‹œê°</div>
                                    <div class="value" id="member_val_avgIn">-</div>
                                </div>
                                <div class="info-card" onclick="memberShowDetail('avgOut')">
                                    <div class="label"><span class="status-dot green" id="avgout_status_dot"></span>í‰ê·  í‡´ê·¼ ì‹œê°</div>
                                    <div class="value" id="member_val_avgOut">-</div>
                                </div>
                            </div>
                            
                            <!-- ì¡°ì§ í‰ê·  ì¶œí‡´ê·¼ -->
                            <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-6 mb-6 border border-indigo-200">
                                <h3 class="text-lg font-bold text-indigo-800 mb-4 text-center">ğŸ“Š ì¡°ì§ ì „ì²´ í‰ê·  ì¶œí‡´ê·¼</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-white rounded-lg p-4 shadow-sm">
                                        <div class="text-sm text-green-600 font-semibold mb-2">ğŸŒ… í‰ê·  ì¶œê·¼ì‹œê°„</div>
                                        <div class="text-2xl font-bold text-green-700" id="org_avg_in">-</div>
                                        <div class="text-xs text-green-500 mt-1">ì¡°ì§ ì „ì²´ í‰ê· </div>
                                    </div>
                                    <div class="bg-white rounded-lg p-4 shadow-sm">
                                        <div class="text-sm text-purple-600 font-semibold mb-2">ğŸŒ† í‰ê·  í‡´ê·¼ì‹œê°„</div>
                                        <div class="text-2xl font-bold text-purple-700" id="org_avg_out">-</div>
                                        <div class="text-xs text-purple-500 mt-1">ì¡°ì§ ì „ì²´ í‰ê· </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ì†Œì† ë¶€ì„œ í‰ê·  ì¶œí‡´ê·¼ -->
                            <div class="bg-gradient-to-r from-blue-50 to-cyan-50 rounded-xl p-6 mb-6 border border-blue-200">
                                <h3 class="text-lg font-bold text-blue-800 mb-4 text-center" id="dept_avg_title">ğŸ‘¥ ì†Œì† ë¶€ì„œ í‰ê·  ì¶œí‡´ê·¼</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-white rounded-lg p-4 shadow-sm">
                                        <div class="text-sm text-blue-600 font-semibold mb-2">ğŸŒ… í‰ê·  ì¶œê·¼ì‹œê°„</div>
                                        <div class="text-2xl font-bold text-blue-700" id="dept_avg_in">-</div>
                                        <div class="text-xs text-blue-500 mt-1" id="dept_avg_in_label">ë¶€ì„œ í‰ê· </div>
                                    </div>
                                    <div class="bg-white rounded-lg p-4 shadow-sm">
                                        <div class="text-sm text-cyan-600 font-semibold mb-2">ğŸŒ† í‰ê·  í‡´ê·¼ì‹œê°„</div>
                                        <div class="text-2xl font-bold text-cyan-700" id="dept_avg_out">-</div>
                                        <div class="text-xs text-cyan-500 mt-1" id="dept_avg_out_label">ë¶€ì„œ í‰ê· </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="lg:col-span-1">
                            <!-- ì”ì—¬ ì—°ì°¨ ì¹´ë“œ -->
                            <div class="remain-vacation-card">
                                <div class="label">ğŸ’ ì”ì—¬ ì—°ì°¨</div>
                                <div class="value" id="member_val_remainVacation">-</div>
                                <div class="sub-value">í˜„ì¬ ì‚¬ìš© ê°€ëŠ¥í•œ ì—°ì°¨</div>
                            </div>
                            
                            <!-- í•˜ë£¨ í‰ê·  ê·¼ë¬´ì‹œê°„ ì¹´ë“œ -->
                            <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl p-6 mb-6 border border-orange-200 shadow-md">
                                <div class="text-sm text-orange-600 font-semibold mb-2">â±ï¸ í•˜ë£¨ í‰ê·  ê·¼ë¬´ì‹œê°„</div>
                                <div class="text-4xl font-bold text-orange-700" id="member_val_avgHoursPerDay">-</div>
                                <div class="text-xs text-orange-500 mt-1">OH / Day</div>
                            </div>
                            
                            <!-- ìš”ì¼ë³„ ì´ˆê³¼ê·¼ë¬´ íšŸìˆ˜ -->
                            <div class="bg-white rounded-xl p-6 shadow-md border border-gray-200">
                                <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ“… ìš”ì¼ë³„ ì´ˆê³¼ê·¼ë¬´ íšŸìˆ˜</h3>
                                <div class="text-xs text-gray-500 mb-3">8ì‹œê°„ ì´ìƒ ê·¼ë¬´ (ì›”~ê¸ˆ)</div>
                                <div style="height: 250px;"><canvas id="weekdayOvertimeChart"></canvas></div>
                            </div>
                        </div>
                    </div>
                    </div>
                    <!-- ê°œì¸ ë·° ë -->
                </div>
                
                <!-- Footer -->
                <div class="page-footer">
                    <div class="footer-content">
                        <p style="margin-bottom: 15px;">
                            * ê·¼íƒœ ê¸°ë¡ ë¦¬í¬íŠ¸ì— ì´ìƒì´ ì—†ì„ ê²½ìš°, <button class="no-issue-btn" onclick="saveNoIssue('member')">ì´ìƒ ì—†ìŒ</button>ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
                        </p>
                        <p style="margin-bottom: 15px;">
                            * ë¦¬í¬íŠ¸ ê³µìœ ì¼: ë§¤ë‹¬ ì²« ë²ˆì§¸ ìˆ˜ìš”ì¼ì…ë‹ˆë‹¤. ìˆ˜ì • ë¬¸ì˜ ë˜ëŠ” ê·¼íƒœ ë¬¸ì˜ì˜ ê²½ìš°ì—ëŠ” ë§¤ë‹¬ ë‘ ë²ˆì§¸ ì›”ìš”ì¼ê¹Œì§€ì…ë‹ˆë‹¤.
                        </p>
                        <p>
                            * ê·¼íƒœ ê¸°ë¡ ê´€ë ¨ ë¬¸ì˜ ë°©ë²•
                            <span class="help-icon">?
                                <span class="help-tooltip">
                                    ê²½ì˜ì§€ì›íŒ€ Leoì—ê²Œ ë©”ì¼ë¡œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.<br>
                                    <a href="https://mail.google.com/mail/?view=cm&fs=1&to=leo@company.com" target="_blank" class="mail-link">ì—¬ê¸°</a>ë¥¼ ëˆ„ë¥´ì‹œë©´ êµ¬ê¸€ ë©”ì¼ë¡œ ì—°ê²°ë©ë‹ˆë‹¤.
                                </span>
                            </span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CEO ë·° -->
    <div id="ceoView" class="view">
        
        <!-- CEO íœ´ê°€ ìƒì„¸ ëª¨ë‹¬ -->
        <div class="modal-overlay" id="ceoVacationModalOverlay">
            <div class="modal-content">
                <span class="modal-close" id="ceoVacationModalClose">&times;</span>
                <div class="modal-title" id="ceoVacationModalTitle">ğŸ–ï¸ íœ´ê°€ ì‚¬ìš© ìƒì„¸</div>
                <div class="modal-list-wrapper" id="ceoVacationModalList"></div>
            </div>
        </div>
        
        <!-- CEO ê·¼ë¬´ ê¸°ë¡ ëˆ„ë½ ëª¨ë‹¬ -->
        <div class="modal-overlay" id="ceoMissingModalOverlay">
            <div class="modal-content">
                <span class="modal-close" id="ceoMissingModalClose">&times;</span>
                <div class="modal-title" id="ceoMissingModalTitle">âš ï¸ ê·¼ë¬´ ê¸°ë¡ ëˆ„ë½ ìƒì„¸</div>
                <div class="modal-list-wrapper" id="ceoMissingModalList"></div>
            </div>
        </div>
        
        <!-- CEO ì¡°ì§ë³„ êµ¬ì„±ì› ìƒì„¸ ëª¨ë‹¬ -->
        <div class="modal-overlay" id="ceoTeamDetailModalOverlay">
            <div class="modal-content">
                <span class="modal-close" id="ceoTeamDetailModalClose">&times;</span>
                <div class="modal-title" id="ceoTeamDetailModalTitle">ğŸ“Š ì¡°ì§ë³„ êµ¬ì„±ì› ì´ˆê³¼ê·¼ë¬´ í˜„í™©</div>
                <div class="modal-list-wrapper" id="ceoTeamDetailModalList"></div>
            </div>
        </div>
        
        <div class="p-6 md:p-10">
            <div class="max-w-7xl mx-auto">
                <header class="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-6">
                    <h1 class="text-3xl font-bold text-gray-800 flex items-center gap-3" style="min-width: 300px; word-break: keep-all; white-space: normal;">
                        <span class="bg-blue-600 p-2 rounded-lg text-white text-xl">ğŸ“Š</span>
                        ì „ì‚¬ ê·¼íƒœ ë¶„ì„ ëŒ€ì‹œë³´ë“œ
                    </h1>
                    <div class="flex gap-3">
                        <button class="header-button" onclick="showView('member')" style="background: white; color: #667eea; border: 2px solid #667eea; padding: 10px 20px; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">â† êµ¬ì„±ì› í˜ì´ì§€</button>
                        <button class="header-button" onclick="showView('admin')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 10px 20px; border-radius: 10px; font-weight: 600; cursor: pointer; border: none; transition: all 0.3s ease;">ğŸ” ê´€ë¦¬ì í˜ì´ì§€</button>
                    </div>
                </header>
                <div class="month-tabs" id="ceoMonthTabs">
                    <div class="month-tab active" data-month="9ì›”" onclick="ceoSwitchMonth('9ì›”')">ğŸ“… 9ì›”</div>
                    <div class="month-tab" data-month="10ì›”" onclick="ceoSwitchMonth('10ì›”')">ğŸ“… 10ì›”</div>
                    <div class="month-tab" data-month="11ì›”" onclick="ceoSwitchMonth('11ì›”')">ğŸ“… 11ì›”</div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="stat-card bg-white p-6 rounded-2xl shadow-sm border border-gray-100 cursor-pointer">
                        <p class="text-sm font-medium text-gray-500 mb-1">ì´ ë¶„ì„ ì¸ì›</p>
                        <h3 id="ceo_stat_totalPeople" class="text-3xl font-bold text-gray-800">- ëª…</h3>
                        <div class="member-list-popup" id="ceoMemberPopup">
                            <p class="text-xs font-bold text-blue-600 mb-3 border-b pb-2 sticky top-0 bg-white">ë¶„ì„ëœ êµ¬ì„±ì› ëª…ë‹¨</p>
                            <div id="ceoPopupNameList" class="space-y-2 text-sm text-gray-600"></div>
                        </div>
                    </div>
                    <div class="stat-card bg-white p-6 rounded-2xl shadow-sm border border-gray-100 border-l-4 border-l-red-500">
                        <p class="text-sm font-medium text-gray-500 mb-1">ì´ ì´ˆê³¼ê·¼ë¬´ ì‹œê°„</p>
                        <h3 id="ceo_stat_totalOver" class="text-3xl font-bold text-red-600">- ì‹œê°„</h3>
                    </div>
                    <div class="stat-card clickable bg-white p-6 rounded-2xl shadow-sm border border-gray-100 border-l-4 border-l-amber-500" onclick="showCeoMissingModal()">
                        <p class="text-sm font-medium text-gray-500 mb-1">âš ï¸ ê·¼ë¬´ ê¸°ë¡ ëˆ„ë½</p>
                        <h3 id="ceo_stat_missingCount" class="text-3xl font-bold text-amber-600">- ê±´</h3>
                        <p class="text-xs text-gray-400 mt-1">í´ë¦­í•˜ì—¬ ìƒì„¸ ë³´ê¸°</p>
                    </div>
                    <div class="stat-card clickable bg-white p-6 rounded-2xl shadow-sm border border-gray-100 border-l-4 border-l-green-500" onclick="showCeoVacationModal()">
                        <p class="text-sm font-medium text-gray-500 mb-1">ğŸ–ï¸ ì´ íœ´ê°€ ì‚¬ìš©</p>
                        <h3 id="ceo_stat_totalVacation" class="text-3xl font-bold text-green-600">- ì¼</h3>
                        <p class="text-xs text-gray-400 mt-1">í´ë¦­í•˜ì—¬ ìƒì„¸ ë³´ê¸°</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                    <div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-bold text-gray-800 italic"># ì¡°ì§ë³„ ì´ˆê³¼ê·¼ë¬´ ë¹„ìœ¨</h3>
                            <span class="text-xs text-gray-400">ì „ì²´ 100% ê¸°ì¤€</span>
                        </div>
                        <div class="h-[300px] flex items-center justify-center"><canvas id="ceoTeamChart"></canvas></div>
                        <p class="team-chart-hint">ğŸ’¡ ì¡°ì§ì„ í´ë¦­í•˜ë©´ êµ¬ì„±ì› ìƒì„¸ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                    </div>
                    <div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-bold text-gray-800 italic"># ì¸ì›ë³„ ì´ˆê³¼ê·¼ë¬´ ë¹„ìœ¨</h3>
                            <span class="text-xs text-gray-400">ì „ì²´ 100% ê¸°ì¤€</span>
                        </div>
                        <div class="h-[300px] flex items-center justify-center"><canvas id="ceoDeptChart"></canvas></div>
                    </div>
                    <div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-bold text-gray-800 mb-6 italic"># ì´ˆê³¼ê·¼ë¬´ Top 5 êµ¬ì„±ì›(ì›”)</h3>
                        <div id="ceoTopList" class="space-y-4"></div>
                    </div>
                </div>
                <div class="grid grid-cols-1 gap-8">
                    <div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-bold text-gray-800 mb-6 italic"># ìš”ì¼ë³„ ê·¼ë¬´ ê°•ë„ ì¶”ì´</h3>
                        <div class="h-[300px]"><canvas id="ceoTrendChart"></canvas></div>
                    </div>
                </div>
                
                <!-- Footer -->
                <div class="page-footer">
                    <div class="footer-content">
                        <p style="margin-bottom: 15px;">
                            * ê·¼íƒœ ê¸°ë¡ ë¦¬í¬íŠ¸ì— ì´ìƒì´ ì—†ì„ ê²½ìš°, <button class="no-issue-btn" onclick="saveNoIssue('ceo')">ì´ìƒ ì—†ìŒ</button>ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
                        </p>
                        <p style="margin-bottom: 15px;">
                            * ë¦¬í¬íŠ¸ ê³µìœ ì¼: ë§¤ë‹¬ ì²« ë²ˆì§¸ ìˆ˜ìš”ì¼ì…ë‹ˆë‹¤. ìˆ˜ì • ë¬¸ì˜ ë˜ëŠ” ê·¼íƒœ ë¬¸ì˜ì˜ ê²½ìš°ì—ëŠ” ë§¤ë‹¬ ë‘ ë²ˆì§¸ ì›”ìš”ì¼ê¹Œì§€ì…ë‹ˆë‹¤.
                        </p>
                        <p>
                            * ê·¼íƒœ ê¸°ë¡ ê´€ë ¨ ë¬¸ì˜ ë°©ë²•
                            <span class="help-icon">?
                                <span class="help-tooltip">
                                    ê²½ì˜ì§€ì›íŒ€ Leoì—ê²Œ ë©”ì¼ë¡œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.<br>
                                    <a href="https://mail.google.com/mail/?view=cm&fs=1&to=leo@company.com" target="_blank" class="mail-link">ì—¬ê¸°</a>ë¥¼ ëˆ„ë¥´ì‹œë©´ êµ¬ê¸€ ë©”ì¼ë¡œ ì—°ê²°ë©ë‹ˆë‹¤.
                                </span>
                            </span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ê´€ë¦¬ì ë·° -->
    <div id="adminView" class="admin-view">
        <div class="p-6 md:p-10">
            <div class="max-w-7xl mx-auto">
                <div class="admin-header">
                    <div class="flex items-center justify-between">
                        <div style="min-width: 250px;">
                            <h1 class="text-3xl font-bold mb-2" style="word-break: keep-all; white-space: normal;">ğŸ” ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
                            <p class="text-blue-100">ì´ìƒ ì—†ìŒ í™•ì¸ ê¸°ë¡ ê´€ë¦¬</p>
                        </div>
                        <div class="flex gap-3">
                            <button class="header-button" onclick="showView('member')" style="background: white; color: #667eea; padding: 10px 20px; border-radius: 10px; font-weight: 600; cursor: pointer; border: 2px solid white; transition: all 0.3s ease;">â† êµ¬ì„±ì› í˜ì´ì§€</button>
                            <button class="header-button" onclick="showView('ceo')" style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; padding: 10px 20px; border-radius: 10px; font-weight: 600; cursor: pointer; border: none; transition: all 0.3s ease;">ğŸ“Š CEO í˜ì´ì§€</button>
                        </div>
                    </div>
                </div>

                <!-- í†µê³„ ì¹´ë“œ -->
                <div class="admin-stats">
                    <div class="admin-stat-card">
                        <div class="admin-stat-label">ì´ í™•ì¸ ê±´ìˆ˜</div>
                        <div class="admin-stat-value" id="adminTotalCount">0</div>
                        <div style="font-size: 12px; color: #64748b; margin-top: 5px;">ì „ì²´ ì´ìƒ ì—†ìŒ í™•ì¸</div>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-label">ì˜¤ëŠ˜ í™•ì¸ ê±´ìˆ˜</div>
                        <div class="admin-stat-value" id="adminTodayCount">0</div>
                        <div style="font-size: 12px; color: #64748b; margin-top: 5px;">ê¸ˆì¼ í™•ì¸ëœ ê¸°ë¡</div>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-label">ìµœê·¼ í™•ì¸</div>
                        <div class="admin-stat-value" style="font-size: 18px;" id="adminLastCheck">-</div>
                        <div style="font-size: 12px; color: #64748b; margin-top: 5px;">ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°</div>
                    </div>
                </div>

                <!-- í…Œì´ë¸” -->
                <div class="bg-white rounded-xl p-6 shadow-md">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-bold text-gray-800">ğŸ“‹ ì´ìƒ ì—†ìŒ í™•ì¸ ê¸°ë¡</h2>
                        <button class="clear-all-btn" onclick="adminClearAll()">ì „ì²´ ê¸°ë¡ ì‚­ì œ</button>
                    </div>
                    
                    <div class="admin-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>ë²ˆí˜¸</th>
                                    <th>ì´ë¦„</th>
                                    <th>ë¶€ì„œ</th>
                                    <th>ì›”</th>
                                    <th>í™•ì¸ ì¼ì‹œ</th>
                                    <th>í˜ì´ì§€</th>
                                    <th>ì‘ì—…</th>
                                </tr>
                            </thead>
                            <tbody id="adminTableBody">
                                <tr>
                                    <td colspan="7" style="text-align: center; color: #94a3b8; padding: 40px;">
                                        ì•„ì§ í™•ì¸ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== Google Sheets URL ì„¤ì • =====
        const SHEET_URLS = {
            '9ì›”': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTxBvVil1szQqCeFl2qOVYnSSK16ZtlRlUji8sTtdgzAKLa4M73ngCHPHh2oewE-GAP5VQLsLV8f_wT/pub?gid=1760267560&single=true&output=csv',
            '10ì›”': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTxBvVil1szQqCeFl2qOVYnSSK16ZtlRlUji8sTtdgzAKLa4M73ngCHPHh2oewE-GAP5VQLsLV8f_wT/pub?gid=1965095219&single=true&output=csv',
            '11ì›”': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTxBvVil1szQqCeFl2qOVYnSSK16ZtlRlUji8sTtdgzAKLa4M73ngCHPHh2oewE-GAP5VQLsLV8f_wT/pub?gid=0&single=true&output=csv',
            'ì—°ì°¨': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTxBvVil1szQqCeFl2qOVYnSSK16ZtlRlUji8sTtdgzAKLa4M73ngCHPHh2oewE-GAP5VQLsLV8f_wT/pub?gid=1588070847&single=true&output=csv'
        };

        // ===== ì•”í˜¸ ê´€ë¦¬ ì‹œìŠ¤í…œ =====
        const ADMIN_PASSWORD = "admin2025";  // ê´€ë¦¬ì ì•”í˜¸ (ëª¨ë“  í˜ì´ì§€ ì ‘ê·¼ ê°€ëŠ¥)
        
        // êµ¬ì„±ì›ë³„ ì•”í˜¸ ì„¤ì • (ì´ë¦„|íšŒì‚¬ë‚´ì´ë¦„: ì•”í˜¸)
        // ê¸°ë³¸ ì•”í˜¸ëŠ” "íšŒì‚¬ë‚´ì´ë¦„" (ì˜ˆ: Jakeì˜ ì•”í˜¸ëŠ” "Jake")
        const USER_PASSWORDS = {
            // ê¸°ë³¸ ì„¤ì •: íšŒì‚¬ë‚´ ì´ë¦„ì„ ì•”í˜¸ë¡œ ì‚¬ìš©
            // ê°œë³„ ì„¤ì • ì˜ˆì‹œ:
            // 'ë°•ì§€í™˜|Jake': 'jake1234',
            // 'ê¹€ë³‘ì°¬|Liel': 'liel5678',
        };
        
        // ê¸°ë³¸ ì•”í˜¸ ìƒì„± í•¨ìˆ˜ (íšŒì‚¬ë‚´ ì´ë¦„)
        function getDefaultPassword(userKey) {
            const [name, compName] = userKey.split('|');
            return compName || name;  // íšŒì‚¬ë‚´ ì´ë¦„ì´ ì—†ìœ¼ë©´ ì´ë¦„ ì‚¬ìš©
        }
        
        // ì•”í˜¸ ê²€ì¦ í•¨ìˆ˜
        function getUserPassword(userKey) {
            // ê°œë³„ ì„¤ì •ëœ ì•”í˜¸ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ê¸°ë³¸ ì•”í˜¸
            return USER_PASSWORDS[userKey] || getDefaultPassword(userKey);
        }
        
        // ì„¸ì…˜ ê´€ë¦¬
        const authSession = {
            admin: false,  // ê´€ë¦¬ì ê¶Œí•œ
            users: new Set()  // ì¸ì¦ëœ ì‚¬ìš©ì ëª©ë¡
        };
        
        // ì•”í˜¸ ëª¨ë‹¬ ê´€ë ¨ ë³€ìˆ˜
        let pendingUserKey = null;  // ì•”í˜¸ ì…ë ¥ ëŒ€ê¸° ì¤‘ì¸ ì‚¬ìš©ì
        let pendingCallback = null;  // ì¸ì¦ ì„±ê³µ ì‹œ ì‹¤í–‰í•  ì½œë°±
        
        // ì•”í˜¸ ì…ë ¥ ëª¨ë‹¬ ì—´ê¸°
        function openPasswordModal(userKey, callback, isCeoView = false) {
            pendingUserKey = userKey;
            pendingCallback = callback;
            
            const modal = document.getElementById('passwordModal');
            const title = document.getElementById('passwordTitle');
            const subtitle = document.getElementById('passwordSubtitle');
            const input = document.getElementById('passwordInput');
            const error = document.getElementById('passwordError');
            
            if (isCeoView) {
                title.innerText = 'ê´€ë¦¬ì ì¸ì¦';
                subtitle.innerText = 'CEO í˜ì´ì§€ì— ì ‘ê·¼í•˜ë ¤ë©´ ê´€ë¦¬ì ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”';
            } else {
                const [name, compName] = userKey.split('|');
                const displayName = compName ? `${name} (${compName})` : name;
                title.innerText = 'êµ¬ì„±ì› ì¸ì¦';
                subtitle.innerText = `${displayName}ì˜ í˜ì´ì§€ì— ì ‘ê·¼í•˜ë ¤ë©´ ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”`;
                
                // íŒíŠ¸ í‘œì‹œ (ê¸°ë³¸ ì•”í˜¸ ì‚¬ìš© ì‹œ)
                if (!USER_PASSWORDS[userKey]) {
                    const hint = document.createElement('div');
                    hint.style.cssText = 'font-size: 12px; color: #94a3b8; margin-top: -20px; margin-bottom: 20px; text-align: center;';
                    hint.innerText = `ğŸ’¡ ê¸°ë³¸ ì•”í˜¸: íšŒì‚¬ë‚´ ì´ë¦„`;
                    subtitle.parentNode.insertBefore(hint, subtitle.nextSibling);
                }
            }
            
            input.value = '';
            input.classList.remove('error');
            error.classList.remove('active');
            modal.classList.add('active');
            input.focus();
            
            // Enter í‚¤ë¡œ ì œì¶œ
            input.onkeypress = (e) => {
                if (e.key === 'Enter') verifyPassword();
            };
        }
        
        // ì•”í˜¸ ì…ë ¥ ëª¨ë‹¬ ë‹«ê¸°
        function closePasswordModal() {
            const modal = document.getElementById('passwordModal');
            modal.classList.remove('active');
            pendingUserKey = null;
            pendingCallback = null;
        }
        
        
        // ì•”í˜¸ ê²€ì¦
        function verifyPassword() {
            const input = document.getElementById('passwordInput');
            const error = document.getElementById('passwordError');
            const enteredPassword = input.value.trim();
            
            if (!enteredPassword) {
                input.classList.add('error');
                error.innerText = 'âš ï¸ ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”';
                error.classList.add('active');
                return;
            }
            
            let isValid = false;
            
            // ê´€ë¦¬ì ì•”í˜¸ í™•ì¸
            if (enteredPassword === ADMIN_PASSWORD) {
                authSession.admin = true;
                isValid = true;
            } 
            // êµ¬ì„±ì› ê°œë³„ ì•”í˜¸ í™•ì¸
            else if (pendingUserKey) {
                const correctPassword = getUserPassword(pendingUserKey);
                if (enteredPassword === correctPassword) {
                    authSession.users.add(pendingUserKey);
                    isValid = true;
                }
            }
            
            if (isValid) {
                closePasswordModal();
                if (pendingCallback) {
                    pendingCallback();
                }
            } else {
                input.classList.add('error');
                input.value = '';
                error.innerText = 'âŒ ì•”í˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤';
                error.classList.add('active');
                
                setTimeout(() => {
                    input.classList.remove('error');
                }, 500);
            }
        }
        
        // ê¶Œí•œ í™•ì¸ í•¨ìˆ˜
        function hasAccess(userKey) {
            return authSession.admin || authSession.users.has(userKey);
        }
        
        function hasAdminAccess() {
            return authSession.admin;
        }
        
        // ì´ˆê¸° ë¡œê·¸ì¸ ì•”í˜¸ ê²€ì¦
        async function verifyInitialPassword() {
            const input = document.getElementById('passwordInput');
            const error = document.getElementById('passwordError');
            const enteredPassword = input.value.trim();
            
            if (!enteredPassword) {
                input.classList.add('error');
                error.innerText = 'âš ï¸ ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”';
                error.classList.add('active');
                return;
            }
            
            // ë¡œë”© ì‹œì‘
            document.getElementById('loadingOverlay').style.display = 'flex';
            
            // 1. ê´€ë¦¬ì ì•”í˜¸ í™•ì¸
            if (enteredPassword === ADMIN_PASSWORD) {
                authSession.admin = true;
                closePasswordModal();
                
                // CEO í˜ì´ì§€ë¡œ ì´ë™
                await initializeData();
                document.getElementById('loadingOverlay').style.display = 'none';
                showView('ceo');
                return;
            }
            
            // 2. ë°ì´í„° ë¡œë“œ
            await initializeData();
            
            // 3. ëª¨ë“  ì›”ì˜ ë°ì´í„°ì—ì„œ ì‚¬ìš©ì ì°¾ê¸° ë° í•´ë‹¹ ì›” í™•ì¸
            const months = ['9ì›”', '10ì›”', '11ì›”'];
            let foundUser = null;
            let userFirstMonth = null;
            
            for (const month of months) {
                const memberData = await loadSheetData(month);
                const userMap = new Map();
                
                // ì¤‘ë³µ ì œê±°í•˜ë©° ì‚¬ìš©ì ëª©ë¡ ìƒì„±
                memberData.forEach(r => {
                    const name = r['ì´ë¦„'];
                    const compName = r['íšŒì‚¬ë‚´ ì´ë¦„'] || '';
                    if (name && compName) {
                        const key = `${name}|${compName}`;
                        if (!userMap.has(key)) {
                            userMap.set(key, { name, compName });
                        }
                    }
                });
                
                // ì…ë ¥í•œ ì•”í˜¸ì™€ ë§¤ì¹­ë˜ëŠ” ì‚¬ìš©ì ì°¾ê¸°
                for (const [key, userData] of userMap) {
                    const correctPassword = getUserPassword(key);
                    if (enteredPassword === correctPassword) {
                        // ì‚¬ìš©ìë¥¼ ì°¾ì•˜ê³ , ì•„ì§ ì²« ë²ˆì§¸ ì›”ì„ ê¸°ë¡í•˜ì§€ ì•Šì•˜ë‹¤ë©´
                        if (!foundUser) {
                            foundUser = { key, ...userData };
                            userFirstMonth = month; // ë°ì´í„°ê°€ ìˆëŠ” ì²« ë²ˆì§¸ ì›” ê¸°ë¡
                        }
                        break;
                    }
                }
                
                // ì‚¬ìš©ìë¥¼ ì°¾ì•˜ìœ¼ë©´ ë” ì´ìƒ ê²€ìƒ‰í•˜ì§€ ì•ŠìŒ
                if (foundUser) break;
            }
            
            document.getElementById('loadingOverlay').style.display = 'none';
            
            if (foundUser) {
                // ì‚¬ìš©ì ì¸ì¦ ì„±ê³µ
                authSession.users.add(foundUser.key);
                closePasswordModal();
                
                // êµ¬ì„±ì› í˜ì´ì§€ë¡œ ì´ë™
                document.getElementById('memberView').classList.add('active');
                
                // í•´ë‹¹ êµ¬ì„±ì›ì´ ë°ì´í„°ê°€ ìˆëŠ” ì²« ë²ˆì§¸ ì›”ë¡œ ì´ë™
                currentMemberMonth = userFirstMonth;
                
                // ì›” íƒ­ í™œì„±í™”
                document.querySelectorAll('#memberMonthTabs .month-tab').forEach(t => t.classList.remove('active'));
                document.querySelector(`#memberMonthTabs .month-tab[data-month="${userFirstMonth}"]`)?.classList.add('active');
                
                // í•´ë‹¹ ì›” ë°ì´í„° ë¡œë“œ (ì´ˆê¸° ë¡œê·¸ì¸ ì‹œì—ëŠ” íŒì—… ê±´ë„ˆëœ€)
                await memberLoadMonth(userFirstMonth, true);
                
                // ì‚¬ìš©ì ì„ íƒ
                const selectElement = document.getElementById('memberUserSelect');
                selectElement.value = foundUser.key;
                selectedUserKey = foundUser.key;
                
                // ë°ì´í„° ê³„ì‚° ë° UI ì—…ë°ì´íŠ¸
                const calculatedData = memberCalculateData(foundUser.key);
                memberUpdateUI(calculatedData);
            } else {
                // ì•”í˜¸ ë¶ˆì¼ì¹˜
                input.classList.add('error');
                input.value = '';
                error.innerText = 'âŒ ì•”í˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤';
                error.classList.add('active');
                
                setTimeout(() => {
                    input.classList.remove('error');
                }, 500);
            }
        }


        const DATA_CACHE = {};
        let VACATION_DATA = [];
        let currentMemberMonth = '9ì›”', currentCeoMonth = '9ì›”';
        let ceoVacationDetails = [];
        let ceoMissingDetails = [];
        let selectedUserKey = null;

        async function loadSheetData(key) {
            if (DATA_CACHE[key]) return DATA_CACHE[key];
            const url = SHEET_URLS[key];
            if (!url) return [];
            try {
                const response = await fetch(url);
                const csvText = await response.text();
                return new Promise((resolve) => {
                    Papa.parse(csvText, {
                        header: true,
                        skipEmptyLines: true,
                        complete: (results) => { DATA_CACHE[key] = results.data; resolve(results.data); }
                    });
                });
            } catch (error) { console.error(`${key} ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:`, error); return []; }
        }

        function getVacationInfo(name, month) {
            const monthCol = month;
            const userRow = VACATION_DATA.find(row => row['ì´ë¦„'] === name);
            if (!userRow) return { used: 0, remain: 0 };
            return { used: parseFloat(userRow[monthCol]) || 0, remain: parseFloat(userRow['ì”ì—¬ ì—°ì°¨']) || 0 };
        }

        function getTotalVacationByMonth(month) {
            const monthCol = month;
            let total = 0;
            const details = [];
            VACATION_DATA.forEach(row => {
                const name = row['ì´ë¦„'], used = parseFloat(row[monthCol]) || 0;
                if (name && used > 0) { total += used; details.push({ name, used }); }
            });
            details.sort((a, b) => b.used - a.used);
            return { total, details };
        }

        async function initializeData() {
            document.getElementById('loadingOverlay').style.display = 'flex';
            try {
                VACATION_DATA = await loadSheetData('ì—°ì°¨');
                await loadSheetData('9ì›”');
                memberLoadMonth('9ì›”', true);
            } catch (error) { console.error('ì´ˆê¸° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error); }
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        function showView(v) {
            if (v === 'ceo') {
                // CEO ë·°ëŠ” ê´€ë¦¬ì ê¶Œí•œ í•„ìš”
                if (hasAdminAccess()) {
                    document.querySelectorAll('.view, .admin-view').forEach(el => el.classList.remove('active'));
                    document.getElementById('ceoView').classList.add('active');
                    ceoLoadMonth(currentCeoMonth);
                } else {
                    // ê´€ë¦¬ì ì•”í˜¸ ìš”êµ¬
                    openPasswordModal('CEO_VIEW', () => {
                        document.querySelectorAll('.view, .admin-view').forEach(el => el.classList.remove('active'));
                        document.getElementById('ceoView').classList.add('active');
                        ceoLoadMonth(currentCeoMonth);
                    }, true);
                }
            } else if (v === 'admin') {
                // ê´€ë¦¬ì ë·°ëŠ” ê´€ë¦¬ì ê¶Œí•œ í•„ìš”
                if (hasAdminAccess()) {
                    document.querySelectorAll('.view, .admin-view').forEach(el => el.classList.remove('active'));
                    document.getElementById('adminView').classList.add('active');
                    loadAdminData();
                } else {
                    // ê´€ë¦¬ì ì•”í˜¸ ìš”êµ¬
                    openPasswordModal('ADMIN_VIEW', () => {
                        document.querySelectorAll('.view, .admin-view').forEach(el => el.classList.remove('active'));
                        document.getElementById('adminView').classList.add('active');
                        loadAdminData();
                    }, true);
                }
            } else if (v === 'member') {
                document.querySelectorAll('.view, .admin-view').forEach(el => el.classList.remove('active'));
                document.getElementById('memberView').classList.add('active');
                memberLoadMonth(currentMemberMonth, true);
            }
        }
        
        // CEOìš©ì—ì„œ êµ¬ì„±ì›ìš©ìœ¼ë¡œ ì „í™˜ (íŠ¹ì • êµ¬ì„±ì› ìë™ ì„ íƒ)
        async function switchToMemberView(name, dept, month) {
            // 1. ë·° ì „í™˜
            showView('member');
            
            // 2. ì›” ì „í™˜
            currentMemberMonth = month;
            document.querySelectorAll('#memberMonthTabs .month-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`#memberMonthTabs .month-tab[data-month="${month}"]`)?.classList.add('active');
            
            // 3. í•´ë‹¹ ì›” ë°ì´í„° ë¡œë“œ (CEOì—ì„œ ì „í™˜ ì‹œì—ëŠ” íŒì—… ê±´ë„ˆëœ€)
            await memberLoadMonth(month, true);
            
            // 4. êµ¬ì„±ì› ì„ íƒ
            const userKey = `${name}|${dept}`;
            const selectElement = document.getElementById('memberUserSelect');
            
            // ì…€ë ‰íŠ¸ ë°•ìŠ¤ì— í•´ë‹¹ ê°’ì´ ìˆëŠ”ì§€ í™•ì¸
            const option = Array.from(selectElement.options).find(opt => opt.value === userKey);
            
            if (option) {
                selectElement.value = userKey;
                selectedUserKey = userKey;
                
                // change ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
                const event = new Event('change');
                selectElement.dispatchEvent(event);
            } else {
                console.warn(`êµ¬ì„±ì›ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${userKey}`);
            }
        }

        function showCeoVacationModal() {
            const overlay = document.getElementById('ceoVacationModalOverlay');
            const title = document.getElementById('ceoVacationModalTitle');
            const list = document.getElementById('ceoVacationModalList');
            title.innerText = `ğŸ–ï¸ ${currentCeoMonth} íœ´ê°€ ì‚¬ìš© ìƒì„¸`;
            list.innerHTML = ceoVacationDetails.length === 0 
                ? '<div class="text-center text-gray-400 py-4">íœ´ê°€ ì‚¬ìš© ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>'
                : ceoVacationDetails.map((item, idx) => `<div class="modal-list-item"><span class="flex items-center gap-2"><span class="w-6 h-6 flex items-center justify-center bg-green-100 text-green-600 rounded-full text-xs font-bold">${idx + 1}</span><span class="font-medium">${item.name}</span></span><span class="text-green-600 font-bold">${item.used}ì¼</span></div>`).join('');
            overlay.style.display = 'flex';
        }

        function showCeoMissingModal() {
            const overlay = document.getElementById('ceoMissingModalOverlay');
            const title = document.getElementById('ceoMissingModalTitle');
            const list = document.getElementById('ceoMissingModalList');
            title.innerText = `âš ï¸ ${currentCeoMonth} ê·¼ë¬´ ê¸°ë¡ ëˆ„ë½ ìƒì„¸`;
            list.innerHTML = ceoMissingDetails.length === 0 
                ? '<div class="text-center text-gray-400 py-4">ê·¼ë¬´ ê¸°ë¡ ëˆ„ë½ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>'
                : ceoMissingDetails.map((item, idx) => `<div class="modal-list-item"><span class="flex items-center gap-2"><span class="w-6 h-6 flex items-center justify-center bg-amber-100 text-amber-600 rounded-full text-xs font-bold">${idx + 1}</span><span class="font-medium">${item.name}</span></span><span class="text-amber-600 font-bold">${item.count}íšŒ</span></div>`).join('');
            overlay.style.display = 'flex';
        }
        
        let ceoTeamMembersData = {}; // ì¡°ì§ë³„ êµ¬ì„±ì› ë°ì´í„° ì €ì¥
        
        function showCeoTeamDetailModal(teamName) {
            const overlay = document.getElementById('ceoTeamDetailModalOverlay');
            const title = document.getElementById('ceoTeamDetailModalTitle');
            const list = document.getElementById('ceoTeamDetailModalList');
            
            const members = ceoTeamMembersData[teamName] || [];
            
            title.innerText = `ğŸ“Š ${teamName} êµ¬ì„±ì› ì´ˆê³¼ê·¼ë¬´ í˜„í™© (${currentCeoMonth})`;
            
            if (members.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-400 py-4">í•´ë‹¹ ì¡°ì§ì— ì´ˆê³¼ê·¼ë¬´ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            } else {
                list.innerHTML = members.map((item, idx) => {
                    const timeStr = ceoFormatHoursMinutes(item.overMins);
                    return `<div class="modal-list-item">
                        <span class="flex items-center gap-2">
                            <span class="w-6 h-6 flex items-center justify-center bg-blue-100 text-blue-600 rounded-full text-xs font-bold">${idx + 1}</span>
                            <span class="font-medium">${item.name}</span>
                        </span>
                        <span class="text-red-600 font-bold">${timeStr}</span>
                    </div>`;
                }).join('');
            }
            
            overlay.style.display = 'flex';
        }

        document.getElementById('ceoVacationModalClose').onclick = () => document.getElementById('ceoVacationModalOverlay').style.display = 'none';
        document.getElementById('ceoMissingModalClose').onclick = () => document.getElementById('ceoMissingModalOverlay').style.display = 'none';
        document.getElementById('ceoTeamDetailModalClose').onclick = () => document.getElementById('ceoTeamDetailModalOverlay').style.display = 'none';
        window.addEventListener('click', (e) => {
            if (e.target === document.getElementById('ceoVacationModalOverlay')) document.getElementById('ceoVacationModalOverlay').style.display = 'none';
            if (e.target === document.getElementById('ceoMissingModalOverlay')) document.getElementById('ceoMissingModalOverlay').style.display = 'none';
            if (e.target === document.getElementById('ceoTeamDetailModalOverlay')) document.getElementById('ceoTeamDetailModalOverlay').style.display = 'none';
        });

        // ===== êµ¬ì„±ì› ë·° =====
        let memberRawData = [], memberMyChart = null, memberModalChart = null, memberCurrentCalculatedData = null;

        // ê°œì¸/ì¡°ì§ íƒ­ ì „í™˜
        
        // ì¡°ì§ ì „ì²´ í‰ê·  ì¶œí‡´ê·¼ ê³„ì‚°
        function calculateOrgStats(month) {
            if (!memberRawData || memberRawData.length === 0) {
                return;
            }
            
            let totalInSum = 0;
            let totalOutSum = 0;
            let inCount = 0;
            let outCount = 0;
            
            // ëª¨ë“  ì¶œí‡´ê·¼ ê¸°ë¡ ìˆ˜ì§‘
            memberRawData.forEach(row => {
                const special = row['íŠ¹ì´ì‚¬í•­'] ? String(row['íŠ¹ì´ì‚¬í•­']).trim() : '';
                
                // ì…ì‚¬ì¼ ì´ì „ ì œì™¸
                if (special.includes('ì…ì‚¬ì¼ ì´ì „')) return;
                
                const inTime = memberParseToMinutes(row['ì¶œê·¼ì‹œê°']);
                const outTime = memberParseToMinutes(row['í‡´ê·¼ì‹œê°']);
                
                if (inTime > 0) {
                    totalInSum += inTime;
                    inCount++;
                }
                
                if (outTime > 0) {
                    totalOutSum += outTime;
                    outCount++;
                }
            });
            
            // í‰ê·  ê³„ì‚°
            const avgInMins = inCount > 0 ? totalInSum / inCount : 0;
            const avgOutMins = outCount > 0 ? totalOutSum / outCount : 0;
            
            console.log(`ğŸ“Š ${month} ì¡°ì§ í‰ê· : ì¶œê·¼=${inCount}ê±´ â†’ ${Math.floor(avgInMins/60)}:${String(Math.round(avgInMins%60)).padStart(2,'0')}, í‡´ê·¼=${outCount}ê±´ â†’ ${Math.floor(avgOutMins/60)}:${String(Math.round(avgOutMins%60)).padStart(2,'0')}`);
            
            // UI ì—…ë°ì´íŠ¸
            const inHour = Math.floor(avgInMins / 60);
            const inMin = Math.round(avgInMins % 60);
            document.getElementById('org_avg_in').innerText = `${String(inHour).padStart(2,'0')}:${String(inMin).padStart(2,'0')}`;
            
            const outHour = Math.floor(avgOutMins / 60);
            const outMin = Math.round(avgOutMins % 60);
            document.getElementById('org_avg_out').innerText = `${String(outHour).padStart(2,'0')}:${String(outMin).padStart(2,'0')}`;
        }
        
        // ë¶€ì„œ í‰ê·  ê³„ì‚° í•¨ìˆ˜
        function calculateDeptStats(userKey, month) {
            if (!memberRawData || memberRawData.length === 0 || !userKey) {
                // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ UI ì´ˆê¸°í™”
                document.getElementById('dept_avg_in').innerText = '-';
                document.getElementById('dept_avg_out').innerText = '-';
                return;
            }
            
            // ì„ íƒëœ ì‚¬ìš©ìì˜ ë¶€ì„œ(íšŒì‚¬ë‚´ ì´ë¦„) ì°¾ê¸°
            const [userName, userCompName] = userKey.split('|');
            const userDept = userCompName || userName;
            
            // ë¶€ì„œ-ì¡°ì§ ë§¤í•‘ êµ¬ì¶•
            const deptToTeamMap = {};
            memberRawData.forEach(row => {
                const dept = row['íšŒì‚¬ë‚´ ì´ë¦„'];
                const org = row['ì¡°ì§'];
                if (dept && org && !deptToTeamMap[dept]) {
                    const orgStr = String(org).trim();
                    let team = 'ê¸°íƒ€';
                    
                    // íŠ¹ë³„ ì¼€ì´ìŠ¤ë“¤
                    // GuyëŠ” CEOì§€ë§Œ ê²½ì˜ì§€ì›íŒ€ìœ¼ë¡œ ë¶„ë¥˜
                    if (dept === 'Guy') {
                        team = 'ê²½ì˜ì§€ì›íŒ€';
                    }
                    // DanteëŠ” ë©”ë””ì»¬íŒ€ìœ¼ë¡œ ë¶„ë¥˜
                    else if (dept === 'Dante') {
                        team = 'ë©”ë””ì»¬íŒ€';
                    }
                    // CEO ì œì™¸
                    else if (orgStr.includes('CEO') && !orgStr.includes('ê²½ì˜ì§€ì›')) {
                        team = 'EXCLUDED';
                    }
                    // ì¡°ì§ëª…ì—ì„œ íŒ€ ì¶”ì¶œ
                    else if (orgStr.includes('ê°œë°œíŒ€') || orgStr === 'CTO') {
                        team = 'ê°œë°œíŒ€';
                    }
                    else if (orgStr.includes('ê²½ì˜ì§€ì›íŒ€')) {
                        team = 'ê²½ì˜ì§€ì›íŒ€';
                    }
                    else if (orgStr.includes('ê¸°íš1íŒ€')) {
                        team = 'ê¸°íš1íŒ€';
                    }
                    else if (orgStr.includes('ê¸°íš2íŒ€') || orgStr.includes('COO')) {
                        team = 'ê¸°íš2íŒ€';
                    }
                    else if (orgStr.includes('ë©”ë””ì»¬íŒ€')) {
                        team = 'ë©”ë””ì»¬íŒ€';
                    }
                    else if (orgStr.includes('í’ˆì§ˆì±…ì„íŒ€')) {
                        team = 'í’ˆì§ˆì±…ì„íŒ€';
                    }
                    
                    deptToTeamMap[dept] = team;
                }
            });
            
            // ì„ íƒëœ ì‚¬ìš©ìì˜ íŒ€ ì°¾ê¸°
            const userTeam = deptToTeamMap[userDept] || 'ê¸°íƒ€';
            
            console.log(`ğŸ‘¤ ì„ íƒëœ ì‚¬ìš©ì: ${userDept}, ì†Œì† íŒ€: ${userTeam}`);
            
            // ê°™ì€ íŒ€ì— ì†í•œ ëª¨ë“  ì‚¬ìš©ìì˜ ì¶œí‡´ê·¼ ì‹œê°„ ìˆ˜ì§‘
            let totalInSum = 0;
            let totalOutSum = 0;
            let inCount = 0;
            let outCount = 0;
            
            memberRawData.forEach(row => {
                const dept = row['íšŒì‚¬ë‚´ ì´ë¦„'];
                const team = deptToTeamMap[dept];
                
                // ê°™ì€ íŒ€ì´ ì•„ë‹ˆë©´ ì œì™¸
                if (team !== userTeam) return;
                
                const special = row['íŠ¹ì´ì‚¬í•­'] ? String(row['íŠ¹ì´ì‚¬í•­']).trim() : '';
                
                // ì…ì‚¬ì¼ ì´ì „ ì œì™¸
                if (special.includes('ì…ì‚¬ì¼ ì´ì „')) return;
                
                const inTime = memberParseToMinutes(row['ì¶œê·¼ì‹œê°']);
                const outTime = memberParseToMinutes(row['í‡´ê·¼ì‹œê°']);
                
                if (inTime > 0) {
                    totalInSum += inTime;
                    inCount++;
                }
                
                if (outTime > 0) {
                    totalOutSum += outTime;
                    outCount++;
                }
            });
            
            // í‰ê·  ê³„ì‚°
            const avgInMins = inCount > 0 ? totalInSum / inCount : 0;
            const avgOutMins = outCount > 0 ? totalOutSum / outCount : 0;
            
            console.log(`ğŸ‘¥ ${userTeam} í‰ê· : ì¶œê·¼=${inCount}ê±´ â†’ ${Math.floor(avgInMins/60)}:${String(Math.round(avgInMins%60)).padStart(2,'0')}, í‡´ê·¼=${outCount}ê±´ â†’ ${Math.floor(avgOutMins/60)}:${String(Math.round(avgOutMins%60)).padStart(2,'0')}`);
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('dept_avg_title').innerText = `ğŸ‘¥ ${userTeam} í‰ê·  ì¶œí‡´ê·¼`;
            
            if (inCount > 0) {
                const inHour = Math.floor(avgInMins / 60);
                const inMin = Math.round(avgInMins % 60);
                document.getElementById('dept_avg_in').innerText = `${String(inHour).padStart(2,'0')}:${String(inMin).padStart(2,'0')}`;
                document.getElementById('dept_avg_in_label').innerText = `${userTeam} í‰ê·  (${inCount}ê±´)`;
            } else {
                document.getElementById('dept_avg_in').innerText = '-';
                document.getElementById('dept_avg_in_label').innerText = `${userTeam} í‰ê· `;
            }
            
            if (outCount > 0) {
                const outHour = Math.floor(avgOutMins / 60);
                const outMin = Math.round(avgOutMins % 60);
                document.getElementById('dept_avg_out').innerText = `${String(outHour).padStart(2,'0')}:${String(outMin).padStart(2,'0')}`;
                document.getElementById('dept_avg_out_label').innerText = `${userTeam} í‰ê·  (${outCount}ê±´)`;
            } else {
                document.getElementById('dept_avg_out').innerText = '-';
                document.getElementById('dept_avg_out_label').innerText = `${userTeam} í‰ê· `;
            }
        }
        

        async function memberSwitchMonth(m) {
            currentMemberMonth = m;
            document.querySelectorAll('#memberMonthTabs .month-tab').forEach(t => { t.classList.remove('active'); t.classList.add('loading'); });
            document.querySelector(`#memberMonthTabs .month-tab[data-month="${m}"]`).classList.add('active');
            await memberLoadMonth(m);
            document.querySelectorAll('#memberMonthTabs .month-tab').forEach(t => t.classList.remove('loading'));
        }

        async function memberLoadMonth(m, skipAlert = false) {
            memberRawData = await loadSheetData(m);
            if (!memberRawData.length) return;
            const userSet = new Set(), uniqueUsers = [];
            memberRawData.forEach(r => {
                const name = r['ì´ë¦„'], compName = r['íšŒì‚¬ë‚´ ì´ë¦„'] || '';
                if (name) { const key = `${name}|${compName}`; if (!userSet.has(key)) { userSet.add(key); uniqueUsers.push({ key, displayName: compName ? `${name} (${compName})` : name }); } }
            });
            const sel = document.getElementById('memberUserSelect');
            sel.innerHTML = '<option value="">ëŒ€ìƒì ì„ íƒ</option>';
            uniqueUsers.sort((a,b) => a.displayName.localeCompare(b.displayName)).forEach(u => { const o = document.createElement('option'); o.value = u.key; o.text = u.displayName; sel.appendChild(o); });
            sel.disabled = false;
            
            let calculatedData = null;
            if (selectedUserKey && uniqueUsers.some(u => u.key === selectedUserKey)) { 
                sel.value = selectedUserKey; 
                calculatedData = memberCalculateData(selectedUserKey);
                memberUpdateUI(calculatedData);
                calculateDeptStats(selectedUserKey, m);
            }
            else if (uniqueUsers.length > 0) { 
                selectedUserKey = uniqueUsers[0].key; 
                sel.value = selectedUserKey; 
                calculatedData = memberCalculateData(selectedUserKey);
                memberUpdateUI(calculatedData);
                calculateDeptStats(selectedUserKey, m);
            }
            
            // ì¡°ì§ í‰ê·  ì¶œí‡´ê·¼ ê³„ì‚°
            calculateOrgStats(m);
        }

        function memberFormatMinutes(mins, style = 'text') {
            if (!mins || mins === Infinity || mins === -Infinity) return '-';
            const h = Math.floor(mins / 60), m = Math.round(mins % 60);
            return style === 'colon' ? `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}` : `${h}ì‹œê°„ ${m}ë¶„`;
        }

        function memberParseToMinutes(val) {
            if (!val) return 0;
            if (typeof val === 'number') return Math.round(val * 24 * 60);
            if (typeof val === 'string') { const p = val.trim().split(':'); if (p.length >= 2) return parseInt(p[0]) * 60 + parseInt(p[1]); }
            return 0;
        }

        function memberFormatDaysToText(days) {
            if (!days || days === 0) return '0ì¼';
            const fullDays = Math.floor(days);
            const remainingHours = Math.round((days - fullDays) * 8);
            if (fullDays === 0) {
                return `${remainingHours}ì‹œê°„`;
            } else if (remainingHours === 0) {
                return `${fullDays}ì¼`;
            } else {
                return `${fullDays}ì¼ ${remainingHours}ì‹œê°„`;
            }
        }

        function memberInitChart(data = null) {
            const ctx = document.getElementById('memberWorkChart').getContext('2d');
            if (memberMyChart) memberMyChart.destroy();
            const d = data ? [data.stdHours, data.totalHours, data.overHours, data.vacationHours] : [0,0,0,0];
            memberMyChart = new Chart(ctx, {
                type: 'bar',
                data: { labels: ['ê¸°ì¤€ê·¼ë¡œ', 'ì´ ê·¼ë¬´', 'ì´ˆê³¼ ê·¼ë¬´', 'íœ´ê°€ ì‚¬ìš©'], datasets: [{ label: 'ì‹œê°„', data: d, backgroundColor: ['#94a3b8', '#8b5cf6', '#ef4444', '#10b981'], borderRadius: 6, barThickness: 50 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { callbacks: { label: c => ` ${c.parsed.y.toFixed(1)} ì‹œê°„` } } }, scales: { y: { beginAtZero: true, grid: { color: '#f1f5f9' } }, x: { grid: { display: false } } } }
            });
        }

        function memberCalculateData(key) {
            const [targetName, targetCompName] = key.split('|');
            const userRows = memberRawData.filter(r => r['ì´ë¦„'] === targetName && (r['íšŒì‚¬ë‚´ ì´ë¦„'] || '') === targetCompName);
            if (!userRows.length) return null;
            const dailyMap = new Map();
            
            userRows.forEach(row => {
                let rawDateValue = row['ë‚ ì§œ']; // ì›ë³¸ ë‚ ì§œë¥¼ ë¨¼ì € ì €ì¥
                
                // ë‚ ì§œ í˜•ì‹ ì •ê·œí™”: "2025. 9. 27" â†’ "2025-09-27"
                if (rawDateValue && typeof rawDateValue === 'string') {
                    // ì (.)ê³¼ ê³µë°±ì„ í•˜ì´í”ˆ(-)ìœ¼ë¡œ ë³€í™˜
                    rawDateValue = rawDateValue.replace(/\.\s*/g, '-').trim();
                    // ëì— í•˜ì´í”ˆì´ ìˆìœ¼ë©´ ì œê±°
                    rawDateValue = rawDateValue.replace(/-$/, '');
                }
                
                let dateStr = rawDateValue || 'ì•Œ ìˆ˜ ì—†ìŒ';
                if (typeof dateStr === 'string' && dateStr.includes('-')) { 
                    try { 
                        const d = new Date(dateStr); 
                        dateStr = `${d.getMonth()+1}/${d.getDate()}`; 
                    } catch(e) {} 
                }
                
                const total = memberParseToMinutes(row['ì´ ê·¼ë¬´']), vacation = memberParseToMinutes(row['íœ´ê°€ì‹œê°„']);
                let inTime = memberParseToMinutes(row['ì¶œê·¼ì‹œê°']), outTime = memberParseToMinutes(row['í‡´ê·¼ì‹œê°']);
                const hasHolidayType = row['íœ´ì¼êµ¬ë¶„'] && String(row['íœ´ì¼êµ¬ë¶„']).trim() !== '';
                const specialNote = row['íŠ¹ì´ì‚¬í•­'] ? String(row['íŠ¹ì´ì‚¬í•­']).trim() : '';
                const isBeforeJoinDate = specialNote.includes('ì…ì‚¬ì¼ ì´ì „');
                const isMissing = !row['ê·¼ë¬´ì •ì±…'] && !row['íœ´ê°€ì •ì±…'] && !row['íœ´ì¼êµ¬ë¶„'];
                
                if (!dailyMap.has(dateStr)) {
                    dailyMap.set(dateStr, { 
                        date: dateStr, 
                        rawDate: rawDateValue,  // ì›ë³¸ ë‚ ì§œ ì €ì¥ (ì´ë¯¸ ì •ê·œí™”ë¨)
                        total: 0, 
                        vacation: 0, 
                        in: inTime > 0 ? inTime : Infinity, 
                        out: outTime > 0 ? outTime : -Infinity, 
                        hasHolidayType: false, 
                        isBeforeJoinDate: false, 
                        isMissing: true, 
                        policies: [] 
                    });
                } else {
                    // ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë‚ ì§œë©´ rawDateë„ ì—…ë°ì´íŠ¸
                    const existing = dailyMap.get(dateStr);
                    if (!existing.rawDate && rawDateValue) {
                        existing.rawDate = rawDateValue;
                    }
                }
                
                const day = dailyMap.get(dateStr);
                day.total += total; 
                day.vacation += vacation;
                if (hasHolidayType) { day.hasHolidayType = true; }
                if (isBeforeJoinDate) { day.isBeforeJoinDate = true; }
                if (row['ê·¼ë¬´ì •ì±…']) { day.isMissing = false; day.policies.push(row['ê·¼ë¬´ì •ì±…']); }
                if (row['íœ´ê°€ì •ì±…'] || row['íœ´ì¼êµ¬ë¶„']) day.isMissing = false;
                if (inTime > 0 && inTime < day.in) day.in = inTime;
                if (outTime > 0 && outTime > day.out) day.out = outTime;
            });
            
            let workDays = 0, totalMins = 0, vacationMins = 0, clockInSum = 0, clockOutSum = 0, clockInCount = 0, clockOutCount = 0, dayByDay = [];
            
            // ìš”ì¼ë³„ ì´ˆê³¼ê·¼ë¬´ íšŸìˆ˜ (ì›”=0, í™”=1, ìˆ˜=2, ëª©=3, ê¸ˆ=4)
            const weekdayOvertime = [0, 0, 0, 0, 0];
            // ìš”ì¼ë³„ ì´ˆê³¼ê·¼ë¬´ ë‚ ì§œ ëª©ë¡
            const weekdayOvertimeDates = [[], [], [], [], []];
            // ìš”ì¼ë³„ ìµœëŒ€ ê°€ëŠ¥ íšŸìˆ˜ (í•´ë‹¹ ì›”ì— ê° ìš”ì¼ì´ ëª‡ ë²ˆ ìˆëŠ”ì§€)
            const weekdayMaxCount = [0, 0, 0, 0, 0];
            
            console.log('ğŸ” ìš”ì¼ë³„ ì´ˆê³¼ê·¼ë¬´ ê³„ì‚° ì‹œì‘');
            
            dailyMap.forEach(day => {
                const finalIn = day.in === Infinity ? 0 : day.in, finalOut = day.out === -Infinity ? 0 : day.out;
                const isWorkDay = !day.hasHolidayType && !day.isBeforeJoinDate;
                if (isWorkDay) workDays++;
                if (!day.isBeforeJoinDate) { totalMins += day.total + day.vacation; vacationMins += day.vacation; }
                if (finalIn > 0) { clockInSum += finalIn; clockInCount++; }
                if (finalOut > 0) { clockOutSum += finalOut; clockOutCount++; }
                
                // ìš”ì¼ë³„ ìµœëŒ€ ê°€ëŠ¥ íšŸìˆ˜ ê³„ì‚° (ëª¨ë“  ë‚ ì§œì˜ ìš”ì¼ ì¹´ìš´íŠ¸)
                if (day.rawDate) {
                    const dateStr = String(day.rawDate);
                    if (dateStr.includes('-')) {
                        try {
                            const dateObj = new Date(dateStr);
                            const dayOfWeek = dateObj.getDay();
                            // ì›”~ê¸ˆ (1~5)ë§Œ ì¹´ìš´íŠ¸
                            if (dayOfWeek >= 1 && dayOfWeek <= 5) {
                                weekdayMaxCount[dayOfWeek - 1]++;
                            }
                        } catch(e) {}
                    }
                }
                
                // ìš”ì¼ë³„ ì´ˆê³¼ê·¼ë¬´ ì¹´ìš´íŠ¸ (ì›”~ê¸ˆ, 8ì‹œê°„ ì´ìƒ)
                if (day.rawDate) {
                    const dateStr = String(day.rawDate);
                    console.log(`ë‚ ì§œ ì›ë³¸: "${dateStr}", íƒ€ì…: ${typeof dateStr}`);
                    
                    if (dateStr.includes('-')) {
                        try {
                            const dateObj = new Date(dateStr);
                            const dayOfWeek = dateObj.getDay(); // 0=ì¼, 1=ì›”, 2=í™”, 3=ìˆ˜, 4=ëª©, 5=ê¸ˆ, 6=í† 
                            const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
                            const totalHours = (day.total / 60).toFixed(1);
                            
                            console.log(`  â†’ ë‚ ì§œê°ì²´: ${dateObj.toLocaleDateString()}, ìš”ì¼: ${dayNames[dayOfWeek]}(${dayOfWeek}), ê·¼ë¬´: ${totalHours}ì‹œê°„(${day.total}ë¶„)`);
                            
                            // ì›”~ê¸ˆ (1~5)ì´ê³ , ì´ ê·¼ë¬´ì‹œê°„ì´ 8ì‹œê°„(480ë¶„) ì´ìƒì¸ ê²½ìš°
                            if (dayOfWeek >= 1 && dayOfWeek <= 5) {
                                if (day.total >= 480) {
                                    weekdayOvertime[dayOfWeek - 1]++;
                                    // ë‚ ì§œ ì •ë³´ë„ ì €ì¥ (í™”ë©´ í‘œì‹œìš© ë‚ ì§œì™€ ê·¼ë¬´ì‹œê°„)
                                    weekdayOvertimeDates[dayOfWeek - 1].push({
                                        date: day.date,  // "9/27" í˜•íƒœ
                                        rawDate: dateStr,  // "2025-9-27" í˜•íƒœ
                                        hours: totalHours  // ê·¼ë¬´ì‹œê°„
                                    });
                                    console.log(`  âœ… ${dayNames[dayOfWeek]} ì´ˆê³¼ê·¼ë¬´ ì¹´ìš´íŠ¸! (${day.total}ë¶„ >= 480ë¶„) â†’ í˜„ì¬: ${weekdayOvertime[dayOfWeek - 1]}íšŒ`);
                                } else {
                                    console.log(`  âšª ${dayNames[dayOfWeek]} ê·¼ë¬´ì‹œê°„ ë¶€ì¡± (${day.total}ë¶„ < 480ë¶„)`);
                                }
                            } else {
                                console.log(`  âš« ì£¼ë§(${dayNames[dayOfWeek]}) ì œì™¸`);
                            }
                        } catch(e) {
                            console.error('  âŒ ë‚ ì§œ íŒŒì‹± ì˜¤ë¥˜:', e);
                        }
                    } else {
                        console.log(`  âš ï¸ ë‚ ì§œ í˜•ì‹ ë¬¸ì œ: "-" ë¬¸ì ì—†ìŒ`);
                    }
                }
                
                dayByDay.push({ date: day.date, total: day.total, vacation: day.vacation, over: Math.max(0, day.total - 480), in: finalIn, out: finalOut, isWorkDay: isWorkDay, isMissing: day.isMissing && !day.isBeforeJoinDate, policy: [...new Set(day.policies)].join(', ') });
            });
            
            console.log('ğŸ“Š ìš”ì¼ë³„ ì´ˆê³¼ê·¼ë¬´ ìµœì¢… ê²°ê³¼:', weekdayOvertime, 'â† [ì›”, í™”, ìˆ˜, ëª©, ê¸ˆ]');
            console.log('   ì›”ìš”ì¼:', weekdayOvertime[0], 'íšŒ');
            console.log('   í™”ìš”ì¼:', weekdayOvertime[1], 'íšŒ');
            console.log('   ìˆ˜ìš”ì¼:', weekdayOvertime[2], 'íšŒ');
            console.log('   ëª©ìš”ì¼:', weekdayOvertime[3], 'íšŒ');
            console.log('   ê¸ˆìš”ì¼:', weekdayOvertime[4], 'íšŒ');
            console.log('ğŸ“… ìš”ì¼ë³„ ìµœëŒ€ ê°€ëŠ¥ íšŸìˆ˜:', weekdayMaxCount, 'â† [ì›”, í™”, ìˆ˜, ëª©, ê¸ˆ]');
            
            const stdMins = workDays * 480, overMins = Math.max(0, totalMins - stdMins);
            const avgIn = clockInCount > 0 ? clockInSum / clockInCount : 0, avgOut = clockOutCount > 0 ? clockOutSum / clockOutCount : 0;
            const vacationInfo = getVacationInfo(targetName, currentMemberMonth);
            
            // í•˜ë£¨ í‰ê·  ê·¼ë¬´ì‹œê°„ ê³„ì‚°
            const avgHoursPerDay = workDays > 0 ? totalMins / workDays / 60 : 0;
            
            memberCurrentCalculatedData = {
                name: targetCompName ? `${targetName} (${targetCompName})` : targetName, realName: targetName, dayByDay, workDays,
                stdHoursRaw: stdMins / 60, totalHoursRaw: totalMins / 60, overHoursRaw: overMins / 60, vacationHoursRaw: vacationMins / 60,
                vacationUsed: vacationInfo.used, vacationRemain: vacationInfo.remain,
                avgHoursPerDay: avgHoursPerDay,
                weekdayOvertime: weekdayOvertime,
                weekdayMaxCount: weekdayMaxCount,
                weekdayOvertimeDates: weekdayOvertimeDates,
                display: { workDays: `${workDays}ì¼`, stdHours: memberFormatMinutes(stdMins), totalHours: memberFormatMinutes(totalMins), overTime: memberFormatMinutes(overMins), vacation: memberFormatDaysToText(vacationInfo.used), remainVacation: memberFormatDaysToText(vacationInfo.remain), avgIn: avgIn > 0 ? memberFormatMinutes(avgIn, 'colon') : '-', avgOut: avgOut > 0 ? memberFormatMinutes(avgOut, 'colon') : '-', missing: `${dayByDay.filter(d => d.isMissing).length}ê±´` }
            };
            return memberCurrentCalculatedData;
        }

        function memberShowDetail(type) {
            if (!memberCurrentCalculatedData) return;
            const overlay = document.getElementById('memberModalOverlay'), title = document.getElementById('memberModalTitle'), list = document.getElementById('memberModalList'), ctx = document.getElementById('memberModalChart').getContext('2d');
            overlay.style.display = 'flex'; list.innerHTML = '';
            if (memberModalChart) memberModalChart.destroy();
            const labels = memberCurrentCalculatedData.dayByDay.map(d => d.date);
            let cfg = { type: 'bar', data: { labels, datasets: [] }, options: { responsive: true, maintainAspectRatio: false, plugins: { tooltip: { callbacks: { label: c => { const v = c.parsed.y; if (v === null) return null; if (type === 'avgIn' || type === 'avgOut') return ` ì‹œê°: ${memberFormatMinutes(v, 'colon')}`; if (type === 'missing' || type === 'workDays') return v === 1 ? ' í•´ë‹¹í•¨' : ' í•´ë‹¹ì—†ìŒ'; return ` ì‹œê°„: ${memberFormatMinutes(v)}`; } } } } } };
            switch(type) {
                case 'workDays': title.innerText = 'ğŸ“… í†µí•© ê·¼ë¬´ ì¼ì ìƒì„¸'; memberCurrentCalculatedData.dayByDay.filter(d => d.isWorkDay).forEach(d => { list.innerHTML += `<div class="modal-list-item"><span>${d.date}</span><span>${d.policy}</span></div>`; }); cfg.data.datasets.push({ label: 'ê·¼ë¬´ ì—¬ë¶€', data: memberCurrentCalculatedData.dayByDay.map(d => d.isWorkDay ? 1 : 0), backgroundColor: '#3b82f6' }); cfg.options.scales = { y: { display: false } }; break;
                case 'totalHours': title.innerText = 'ğŸ’¼ ì¼ìë³„ ê·¼ë¬´ ì‹œê°„'; cfg.data.datasets.push({ label: 'ë¶„', data: memberCurrentCalculatedData.dayByDay.map(d => d.total), backgroundColor: '#8b5cf6' }); memberCurrentCalculatedData.dayByDay.forEach(d => { if (d.total > 0) list.innerHTML += `<div class="modal-list-item"><span>${d.date}</span><span>${memberFormatMinutes(d.total)}</span></div>`; }); break;
                case 'overTime': title.innerText = 'ğŸ”¥ ì¼ìë³„ ì´ˆê³¼ ê·¼ë¬´'; cfg.data.datasets.push({ label: 'ë¶„', data: memberCurrentCalculatedData.dayByDay.map(d => d.over), backgroundColor: '#ef4444' }); memberCurrentCalculatedData.dayByDay.forEach(d => { if (d.over > 0) list.innerHTML += `<div class="modal-list-item"><span>${d.date}</span><span>${memberFormatMinutes(d.over)}</span></div>`; }); break;
                case 'vacation': title.innerText = 'ğŸ–ï¸ íœ´ê°€ ì‚¬ìš© ìƒì„¸'; memberCurrentCalculatedData.dayByDay.filter(d => d.vacation > 0).forEach(d => { list.innerHTML += `<div class="modal-list-item"><span>${d.date}</span><span>${memberFormatMinutes(d.vacation)}</span></div>`; }); cfg.data.datasets.push({ label: 'ë¶„', data: memberCurrentCalculatedData.dayByDay.map(d => d.vacation), backgroundColor: '#10b981' }); break;
                case 'missing': title.innerText = 'âš ï¸ ê¸°ë¡ ëˆ„ë½ ì¼ì'; cfg.data.datasets.push({ label: 'ëˆ„ë½', data: memberCurrentCalculatedData.dayByDay.map(d => d.isMissing ? 1 : 0), backgroundColor: '#ef4444' }); cfg.options.scales = { y: { display: false } }; memberCurrentCalculatedData.dayByDay.filter(d => d.isMissing).forEach(d => { list.innerHTML += `<div class="modal-list-item" style="color:#ef4444"><span>${d.date}</span><span>ê¸°ë¡ ì—†ìŒ</span></div>`; }); break;
                case 'avgIn': title.innerText = 'ğŸŒ… ì¼ìë³„ ì¶œê·¼ ì‹œê°'; cfg.type = 'line'; cfg.data.datasets.push({ label: 'ì¶œê·¼', data: memberCurrentCalculatedData.dayByDay.map(d => d.in > 0 ? d.in : null), borderColor: '#3b82f6', pointBackgroundColor: '#3b82f6', tension: 0.3, spanGaps: true }); cfg.options.scales = { y: { ticks: { callback: v => memberFormatMinutes(v, 'colon') } } }; memberCurrentCalculatedData.dayByDay.filter(d => d.in > 0).forEach(d => { list.innerHTML += `<div class="modal-list-item"><span>${d.date}</span><span>${memberFormatMinutes(d.in, 'colon')}</span></div>`; }); break;
                case 'avgOut': title.innerText = 'ğŸŒ† ì¼ìë³„ í‡´ê·¼ ì‹œê°'; cfg.type = 'line'; cfg.data.datasets.push({ label: 'í‡´ê·¼', data: memberCurrentCalculatedData.dayByDay.map(d => d.out > 0 ? d.out : null), borderColor: '#8b5cf6', pointBackgroundColor: '#8b5cf6', tension: 0.3, spanGaps: true }); cfg.options.scales = { y: { ticks: { callback: v => memberFormatMinutes(v, 'colon') } } }; memberCurrentCalculatedData.dayByDay.filter(d => d.out > 0).forEach(d => { list.innerHTML += `<div class="modal-list-item"><span>${d.date}</span><span>${memberFormatMinutes(d.out, 'colon')}</span></div>`; }); break;
            }
            memberModalChart = new Chart(ctx, cfg);
        }

        function memberUpdateUI(result) {
            if (!result) return;
            document.getElementById('memberReportTitle').innerText = `ğŸ“Š [${result.name}]ë‹˜ ê·¼íƒœ ì •ì‚° ë¦¬í¬íŠ¸ (${currentMemberMonth})`;
            document.getElementById('member_val_workDays').innerText = result.display.workDays;
            document.getElementById('member_val_stdHours').innerText = result.display.stdHours;
            document.getElementById('member_val_totalHours').innerText = result.display.totalHours;
            document.getElementById('member_val_overTime').innerText = result.display.overTime;
            document.getElementById('member_val_vacation').innerText = result.display.vacation;
            document.getElementById('member_val_remainVacation').innerText = result.display.remainVacation;
            document.getElementById('member_val_missing').innerText = result.display.missing;
            document.getElementById('member_val_avgIn').innerText = result.display.avgIn;
            document.getElementById('member_val_avgOut').innerText = result.display.avgOut;
            
            // ì´ ê·¼ë¬´ì‹œê°„ ì› ìƒ‰ìƒ ë³€ê²½ (ì´ ê·¼ë¬´ < ê¸°ì¤€ ê·¼ë¡œ â†’ ë¹¨ê°•)
            const totalDot = document.getElementById('total_status_dot');
            if (totalDot) {
                totalDot.classList.remove('green', 'red');
                if (result.totalHoursRaw < result.stdHoursRaw) {
                    totalDot.classList.add('red');
                    totalDot.setAttribute('data-tooltip', 'ê¸°ë¡ ëˆ„ë½ëœ ê±´ì´ ìˆì–´ ê¸°ì¤€ ê·¼ë¡œì‹œê°„ì— ë¯¸ì¹˜ì§€ ëª»í•©ë‹ˆë‹¤.');
                } else {
                    totalDot.classList.add('green');
                    totalDot.setAttribute('data-tooltip', 'ê¸°ë¡ ëˆ„ë½ëœ ê±´ì´ ì—†ìŠµë‹ˆë‹¤.');
                }
            }
            
            // ì´ˆê³¼ ê·¼ë¬´ ì› ìƒ‰ìƒ ë³€ê²½ (í•­ìƒ ë¹¨ê°•)
            const overtimeDot = document.getElementById('overtime_status_dot');
            if (overtimeDot) {
                overtimeDot.classList.remove('green', 'red');
                overtimeDot.classList.add('red');
                
                // '-' ë˜ëŠ” '0ì‹œê°„'ì¼ ë•ŒëŠ” "ì´ˆê³¼ ê·¼ë¬´ê°€ ì—†ìŠµë‹ˆë‹¤"
                if (result.display.overTime === '-' || result.display.overTime === '0ì‹œê°„') {
                    overtimeDot.setAttribute('data-tooltip', 'ì´ˆê³¼ ê·¼ë¬´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                } else {
                    overtimeDot.setAttribute('data-tooltip', 'ì´ˆê³¼ ê·¼ë¬´ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }
            
            // ê¸°ë¡ ëˆ„ë½ ì› ìƒ‰ìƒ ë³€ê²½ ('0ì¼' ë˜ëŠ” '0ê±´'ë§Œ ì´ˆë¡, ë‚˜ë¨¸ì§€ëŠ” ë¹¨ê°•)
            const missingDot = document.getElementById('missing_status_dot');
            if (missingDot) {
                missingDot.classList.remove('green', 'red');
                // '0ì¼' ë˜ëŠ” '0ê±´'ë§Œ ì •ìƒ(ì´ˆë¡), ë‚˜ë¨¸ì§€ëŠ” ëª¨ë‘ ë¬¸ì œ(ë¹¨ê°•)
                if (result.display.missing === '0ì¼' || result.display.missing === '0ê±´') {
                    missingDot.classList.add('green');
                    missingDot.setAttribute('data-tooltip', 'ê¸°ë¡ì´ ëˆ„ë½ëœ ë¶€ë¶„ì´ ì—†ìŠµë‹ˆë‹¤.');
                } else {
                    missingDot.classList.add('red');
                    missingDot.setAttribute('data-tooltip', 'ê¸°ë¡ì´ ëˆ„ë½ëœ ë¶€ë¶„ì´ ìˆìŠµë‹ˆë‹¤.');
                }
            }
            
            // í‰ê·  ì¶œê·¼ ì‹œê° ì› ìƒ‰ìƒ ë³€ê²½ ('-' â†’ ë¹¨ê°•)
            const avgInDot = document.getElementById('avgin_status_dot');
            if (avgInDot) {
                avgInDot.classList.remove('green', 'red');
                if (result.display.avgIn === '-') {
                    avgInDot.classList.add('red');
                    avgInDot.setAttribute('data-tooltip', 'ì¶œê·¼ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.');
                } else {
                    avgInDot.classList.add('green');
                    avgInDot.setAttribute('data-tooltip', 'ì´ë²ˆ ë‹¬ í‰ê·  ì¶œê·¼ ì‹œê°ì…ë‹ˆë‹¤.');
                }
            }
            
            // í‰ê·  í‡´ê·¼ ì‹œê° ì› ìƒ‰ìƒ ë³€ê²½ ('-' â†’ ë¹¨ê°•)
            const avgOutDot = document.getElementById('avgout_status_dot');
            if (avgOutDot) {
                avgOutDot.classList.remove('green', 'red');
                if (result.display.avgOut === '-') {
                    avgOutDot.classList.add('red');
                    avgOutDot.setAttribute('data-tooltip', 'í‡´ê·¼ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.');
                } else {
                    avgOutDot.classList.add('green');
                    avgOutDot.setAttribute('data-tooltip', 'ì´ë²ˆ ë‹¬ í‰ê·  í‡´ê·¼ ì‹œê°ì…ë‹ˆë‹¤.');
                }
            }
            
            // í•˜ë£¨ í‰ê·  ê·¼ë¬´ì‹œê°„ í‘œì‹œ
            const avgHours = Math.floor(result.avgHoursPerDay);
            const avgMins = Math.round((result.avgHoursPerDay - avgHours) * 60);
            document.getElementById('member_val_avgHoursPerDay').innerText = `${avgHours}.${String(avgMins).padStart(2,'0')}h`;
            
            // ìš”ì¼ë³„ ì´ˆê³¼ê·¼ë¬´ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            console.log('ğŸ“Š ì°¨íŠ¸ ì—…ë°ì´íŠ¸ í˜¸ì¶œ, ë°ì´í„°:', result.weekdayOvertime);
            if (result.weekdayOvertime && Array.isArray(result.weekdayOvertime)) {
                updateWeekdayOvertimeChart(result.weekdayOvertime);
            } else {
                console.error('âŒ ìš”ì¼ë³„ ë°ì´í„°ê°€ ì—†ê±°ë‚˜ ë°°ì—´ì´ ì•„ë‹˜:', result.weekdayOvertime);
                updateWeekdayOvertimeChart([0, 0, 0, 0, 0]);
            }
        }
        
        let weekdayOvertimeChart = null;
        
        function updateWeekdayOvertimeChart(weekdayData) {
            console.log('ğŸ¨ ìš”ì¼ë³„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì‹œì‘, ë°ì´í„°:', weekdayData);
            
            const ctx = document.getElementById('weekdayOvertimeChart');
            if (!ctx) {
                console.error('âŒ weekdayOvertimeChart ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ!');
                return;
            }
            
            if (weekdayOvertimeChart) {
                weekdayOvertimeChart.destroy();
            }
            
            // ë°ì´í„°ê°€ ëª¨ë‘ 0ì´ë©´ ìµœì†Œ 1ê°œë¼ë„ í‘œì‹œ
            const displayData = weekdayData.every(v => v === 0) ? [0, 0, 0, 0, 0] : weekdayData;
            
            weekdayOvertimeChart = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼'],
                    datasets: [{
                        label: 'ì´ˆê³¼ê·¼ë¬´ íšŸìˆ˜',
                        data: displayData,
                        backgroundColor: [
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(249, 115, 22, 0.8)',
                            'rgba(234, 179, 8, 0.8)',
                            'rgba(34, 197, 94, 0.8)',
                            'rgba(59, 130, 246, 0.8)'
                        ],
                        borderColor: [
                            'rgb(239, 68, 68)',
                            'rgb(249, 115, 22)',
                            'rgb(234, 179, 8)',
                            'rgb(34, 197, 94)',
                            'rgb(59, 130, 246)'
                        ],
                        borderWidth: 2,
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const actualCount = context.parsed.y;
                                    const dayIndex = context.dataIndex;
                                    
                                    // memberCurrentCalculatedDataì—ì„œ ìµœëŒ€ ê°€ëŠ¥ íšŸìˆ˜ ê°€ì ¸ì˜¤ê¸°
                                    if (memberCurrentCalculatedData && memberCurrentCalculatedData.weekdayMaxCount) {
                                        const maxCount = memberCurrentCalculatedData.weekdayMaxCount[dayIndex];
                                        return ` ${actualCount}/${maxCount}íšŒ`;
                                    }
                                    
                                    return ` ${actualCount}íšŒ`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                callback: function(value) {
                                    return value + 'íšŒ';
                                }
                            },
                            grid: { color: '#f1f5f9' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
            
            console.log('âœ… ì°¨íŠ¸ ìƒì„± ì™„ë£Œ!');
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¹ˆ ì°¨íŠ¸ ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                const ctx = document.getElementById('weekdayOvertimeChart');
                if (ctx && !weekdayOvertimeChart) {
                    console.log('ğŸ“Š ì´ˆê¸° ì°¨íŠ¸ ìƒì„±');
                    updateWeekdayOvertimeChart([0, 0, 0, 0, 0]);
                }
            }, 1000);
        });

        document.getElementById('memberUserSelect').addEventListener('change', e => { 
            if (e.target.value) { 
                const userKey = e.target.value;
                
                // ì´ë¯¸ ì¸ì¦ëœ ì‚¬ìš©ìì¸ì§€ í™•ì¸
                if (hasAccess(userKey)) {
                    selectedUserKey = userKey;
                    memberUpdateUI(memberCalculateData(userKey));
                    calculateDeptStats(userKey, currentMemberMonth);
                } else {
                    // ì•”í˜¸ ì…ë ¥ ìš”êµ¬
                    openPasswordModal(userKey, () => {
                        selectedUserKey = userKey;
                        memberUpdateUI(memberCalculateData(userKey));
                        calculateDeptStats(userKey, currentMemberMonth);
                    }, false);
                }
            } 
        });
        document.getElementById('memberModalClose').onclick = () => document.getElementById('memberModalOverlay').style.display = 'none';
        window.onclick = e => { if (e.target == document.getElementById('memberModalOverlay')) document.getElementById('memberModalOverlay').style.display = 'none'; };

        // ===== CEO ë·° =====
        let ceoRawData = [], ceoDeptChart = null, ceoTeamChart = null, ceoTrendChart = null;

        async function ceoSwitchMonth(m) {
            currentCeoMonth = m;
            document.querySelectorAll('#ceoMonthTabs .month-tab').forEach(t => { t.classList.remove('active'); t.classList.add('loading'); });
            document.querySelector(`#ceoMonthTabs .month-tab[data-month="${m}"]`).classList.add('active');
            await ceoLoadMonth(m);
            document.querySelectorAll('#ceoMonthTabs .month-tab').forEach(t => t.classList.remove('loading'));
        }

        async function ceoLoadMonth(m) { ceoRawData = await loadSheetData(m); if (ceoRawData.length) ceoProcessExcel(ceoRawData); }

        function ceoParseToMinutes(val) {
            if (!val) return 0;
            if (typeof val === 'number') return Math.round(val * 24 * 60);
            if (typeof val === 'string') { const p = val.trim().split(':'); if (p.length >= 2) return parseInt(p[0]) * 60 + parseInt(p[1]); }
            return 0;
        }

        function ceoFormatHours(mins) { return (mins / 60).toFixed(1); }
        
        function ceoFormatHoursMinutes(mins) {
            const hours = Math.floor(mins / 60);
            const minutes = Math.round(mins % 60);
            if (minutes === 0) {
                return `${hours}ì‹œê°„`;
            }
            return `${hours}ì‹œê°„ ${minutes}ë¶„`;
        }
        
        // í¼ì„¼íŠ¸ í•©ê³„ë¥¼ ì •í™•íˆ 100.0%ë¡œ ì¡°ì •
        function adjustPercentsTo100(values) {
            if (values.length === 0) return values;
            
            // ì†Œìˆ˜ì  ì²«ì§¸ ìë¦¬ë¡œ ë°˜ì˜¬ë¦¼
            const rounded = values.map(v => Math.round(v * 10) / 10);
            
            // í•©ê³„ ê³„ì‚°
            const sum = rounded.reduce((a, b) => a + b, 0);
            
            // 100ê³¼ì˜ ì°¨ì´ ê³„ì‚°
            const diff = Math.round((100 - sum) * 10) / 10;
            
            if (diff !== 0) {
                // ê°€ì¥ í° ê°’ì— ì°¨ì´ë¥¼ ë”í•´ì„œ 100%ë¡œ ë§ì¶¤
                const maxIndex = rounded.indexOf(Math.max(...rounded));
                rounded[maxIndex] = Math.round((rounded[maxIndex] + diff) * 10) / 10;
            }
            
            return rounded;
        }
        
        function formatMinutesToHoursMinutes(minutes) {
            const hours = Math.floor(minutes / 60);
            const mins = Math.round(minutes % 60);
            if (mins === 0) {
                return `${hours}ì‹œê°„`;
            }
            return `${hours}ì‹œê°„ ${mins}ë¶„`;
        }
        
        function formatHoursMinutes(decimalHours) {
            const hours = Math.floor(decimalHours);
            const minutes = Math.round((decimalHours - hours) * 60);
            if (minutes === 0) {
                return `${hours}ì‹œê°„`;
            }
            return `${hours}ì‹œê°„ ${minutes}ë¶„`;
        }

        function ceoGetTeamCategory(name) {
            if (!name) return 'ê¸°íƒ€';
            const n = name.trim();
            if (n.includes('CEO')) return 'EXCLUDED';
            if (n === 'ê°œë°œíŒ€' || n === 'ê°œë°œíŒ€ì¥' || n === 'CTO') return 'ê°œë°œíŒ€';
            if (n === 'ê²½ì˜ì§€ì›íŒ€' || n === 'ê²½ì˜ì§€ì›íŒ€ì¥') return 'ê²½ì˜ì§€ì›íŒ€';
            if (n === 'ê¸°íš1íŒ€' || n === 'ê¸°íš1íŒ€ì¥') return 'ê¸°íš1íŒ€';
            if (n === 'ê¸°íš2íŒ€' || n === 'COO, ê¸°íš2íŒ€ì¥') return 'ê¸°íš2íŒ€';
            if (n === 'ë©”ë””ì»¬íŒ€' || n === 'ë©”ë””ì»¬íŒ€ì¥') return 'ë©”ë””ì»¬íŒ€';
            if (n === 'í’ˆì§ˆì±…ì„íŒ€ì¥' || n === 'í’ˆì§ˆì±…ì„íŒ€') return 'í’ˆì§ˆì±…ì„íŒ€';
            return 'ê¸°íƒ€';
        }
        
        // ì¡°ì§ë³„ ìƒ‰ìƒ ë§¤í•‘
        const TEAM_COLORS = {
            'ê°œë°œíŒ€': '#3b82f6',      // íŒŒë‘
            'ê²½ì˜ì§€ì›íŒ€': '#10b981',  // ì´ˆë¡
            'ê¸°íš1íŒ€': '#f59e0b',     // ì£¼í™©
            'ê¸°íš2íŒ€': '#ef4444',     // ë¹¨ê°•
            'ë©”ë””ì»¬íŒ€': '#8b5cf6',    // ë³´ë¼
            'í’ˆì§ˆì±…ì„íŒ€': '#6366f1',  // ì¸ë””ê³ 
            'ê¸°íƒ€': '#94a3b8'         // íšŒìƒ‰
        };
        
        // í¼ì„¼íŠ¸ë¥¼ ì •í™•íˆ 100.0%ë¡œ ë§Œë“œëŠ” í•¨ìˆ˜
        function adjustPercentsTo100(values) {
            if (values.length === 0) return values;
            
            const total = values.reduce((sum, v) => sum + v, 0);
            if (total === 0) return values;
            
            // ë°˜ì˜¬ë¦¼
            const rounded = values.map(p => Math.round(p * 10) / 10);
            
            // í•©ê³„ ê³„ì‚°
            const sum = rounded.reduce((s, v) => s + v, 0);
            
            // 100ê³¼ì˜ ì°¨ì´
            const diff = Math.round((100 - sum) * 10) / 10;
            
            if (diff !== 0) {
                // ê°€ì¥ í° ê°’ì— ì°¨ì´ë¥¼ ë”í•¨
                const maxIndex = rounded.indexOf(Math.max(...rounded));
                rounded[maxIndex] = Math.round((rounded[maxIndex] + diff) * 10) / 10;
            }
            
            return rounded;
        }
        
        // ë¶€ì„œê°€ ì†í•œ ì¡°ì§ ì°¾ê¸° (ë™ì  ë§¤í•‘ ì‚¬ìš©)
        let currentDeptToTeamMap = {};
        
        function getDeptTeamCategory(deptName) {
            return currentDeptToTeamMap[deptName] || 'ê¸°íƒ€';
        }

        function ceoInitCharts(deptData, teamData, trendData) {
            console.log('ì°¨íŠ¸ ì´ˆê¸°í™” - ìš”ì¼ë³„ ë°ì´í„°:', trendData);
            
            // ë¶€ì„œë³„ ì°¨íŠ¸ (ë„ë„› ì°¨íŠ¸) - ì¡°ì§ ìƒ‰ìƒ ì ìš©
            const ctxDept = document.getElementById('ceoDeptChart').getContext('2d');
            if (ceoDeptChart) ceoDeptChart.destroy();
            
            // ë¶€ì„œë³„ ìƒ‰ìƒì„ ì¡°ì§ì— ë§ì¶° ì„¤ì •
            const deptColors = deptData.labels.map(deptName => {
                const teamCat = getDeptTeamCategory(deptName);
                return TEAM_COLORS[teamCat] || TEAM_COLORS['ê¸°íƒ€'];
            });
            
            ceoDeptChart = new Chart(ctxDept, { 
                type: 'doughnut', 
                data: { 
                    labels: deptData.labels, 
                    datasets: [{ 
                        data: deptData.values, 
                        backgroundColor: deptColors,
                        borderWidth: 0, 
                        hoverOffset: 20 
                    }] 
                }, 
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { 
                        legend: { 
                            position: 'bottom', 
                            labels: { 
                                usePointStyle: true, 
                                padding: 15, 
                                font: { size: 10 } 
                            } 
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    return ` ${label}: ${value.toFixed(1)}%`;
                                }
                            }
                        }
                    }, 
                    cutout: '65%' 
                } 
            });
            
            // ì¡°ì§ë³„ ì°¨íŠ¸ (íŒŒì´ ì°¨íŠ¸) - ì¡°ì§ ìƒ‰ìƒ ì ìš©
            const ctxTeam = document.getElementById('ceoTeamChart').getContext('2d');
            if (ceoTeamChart) ceoTeamChart.destroy();
            
            // ì¡°ì§ë³„ ìƒ‰ìƒ ì„¤ì •
            const teamColors = teamData.labels.map(teamName => TEAM_COLORS[teamName] || TEAM_COLORS['ê¸°íƒ€']);
            
            ceoTeamChart = new Chart(ctxTeam, { 
                type: 'pie', 
                data: { 
                    labels: teamData.labels, 
                    datasets: [{ 
                        data: teamData.values, 
                        backgroundColor: teamColors,
                        borderWidth: 2, 
                        borderColor: '#fff' 
                    }] 
                }, 
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const teamName = teamData.labels[index];
                            showCeoTeamDetailModal(teamName);
                        }
                    },
                    plugins: { 
                        legend: { 
                            position: 'bottom', 
                            labels: { 
                                usePointStyle: true, 
                                padding: 15, 
                                font: { size: 11, weight: 'bold' } 
                            },
                            onClick: (event, legendItem, legend) => {
                                const index = legendItem.index;
                                const teamName = teamData.labels[index];
                                showCeoTeamDetailModal(teamName);
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    return ` ${label}: ${value.toFixed(1)}%`;
                                }
                            }
                        }
                    } 
                } 
            });
            const ctxTrend = document.getElementById('ceoTrendChart').getContext('2d');
            if (ceoTrendChart) ceoTrendChart.destroy();
            ceoTrendChart = new Chart(ctxTrend, { 
                type: 'bar', 
                data: { 
                    labels: trendData.labels, 
                    datasets: [{ 
                        label: 'í‰ê·  ê·¼ë¬´ì‹œê°„', 
                        data: trendData.values, 
                        backgroundColor: '#3b82f6', 
                        borderRadius: 6, 
                        barThickness: 60 
                    }] 
                }, 
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { 
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return ` ${formatMinutesToHoursMinutes(context.parsed.y)}`;
                                }
                            }
                        }
                    }, 
                    scales: { 
                        y: { 
                            beginAtZero: true, 
                            grid: { color: '#f1f5f9' },
                            ticks: {
                                callback: function(value) {
                                    return formatMinutesToHoursMinutes(value);
                                }
                            },
                            title: {
                                display: true,
                                text: 'í‰ê·  ê·¼ë¬´ì‹œê°„',
                                font: { size: 12 }
                            }
                        }, 
                        x: { 
                            grid: { display: false },
                            title: {
                                display: true,
                                text: 'ìš”ì¼',
                                font: { size: 12 }
                            }
                        } 
                    } 
                } 
            });
        }

        function ceoProcessExcel(data) {
            const users = {}, departments = {}, teams = {}, weekdayTrend = {}, missingStats = {};
            const weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            const weekdayData = { 'ì›”': [], 'í™”': [], 'ìˆ˜': [], 'ëª©': [], 'ê¸ˆ': [], 'í† ': [], 'ì¼': [] };
            const dailyPersonData = {}; // ë‚ ì§œë³„, ì‚¬ëŒë³„ ê·¼ë¬´ì‹œê°„ í•©ì‚°ìš©
            const deptToTeamMap = {}; // ë¶€ì„œ-ì¡°ì§ ë™ì  ë§¤í•‘
            let totalOverMins = 0, totalMissingCount = 0;
            
            // ì²« íŒ¨ìŠ¤: ë¶€ì„œ-ì¡°ì§ ë§¤í•‘ êµ¬ì¶•
            data.forEach(row => {
                const dept = row['íšŒì‚¬ë‚´ ì´ë¦„'];
                const org = row['ì¡°ì§'];
                if (dept && org && !deptToTeamMap[dept]) {
                    const orgStr = String(org).trim();
                    let team = 'ê¸°íƒ€';
                    
                    // íŠ¹ë³„ ì¼€ì´ìŠ¤ë“¤
                    // GuyëŠ” CEOì§€ë§Œ ê²½ì˜ì§€ì›íŒ€ìœ¼ë¡œ ë¶„ë¥˜
                    if (dept === 'Guy') {
                        team = 'ê²½ì˜ì§€ì›íŒ€';
                    }
                    // DanteëŠ” ë©”ë””ì»¬íŒ€ìœ¼ë¡œ ë¶„ë¥˜
                    else if (dept === 'Dante') {
                        team = 'ë©”ë””ì»¬íŒ€';
                    }
                    // CEO ì œì™¸
                    else if (orgStr.includes('CEO') && !orgStr.includes('ê²½ì˜ì§€ì›')) {
                        team = 'EXCLUDED';
                    }
                    // ì¡°ì§ëª…ì—ì„œ íŒ€ ì¶”ì¶œ
                    else if (orgStr.includes('ê°œë°œíŒ€') || orgStr === 'CTO') {
                        team = 'ê°œë°œíŒ€';
                    }
                    else if (orgStr.includes('ê²½ì˜ì§€ì›íŒ€')) {
                        team = 'ê²½ì˜ì§€ì›íŒ€';
                    }
                    else if (orgStr.includes('ê¸°íš1íŒ€')) {
                        team = 'ê¸°íš1íŒ€';
                    }
                    else if (orgStr.includes('ê¸°íš2íŒ€') || orgStr.includes('COO')) {
                        team = 'ê¸°íš2íŒ€';
                    }
                    else if (orgStr.includes('ë©”ë””ì»¬íŒ€')) {
                        team = 'ë©”ë””ì»¬íŒ€';
                    }
                    else if (orgStr.includes('í’ˆì§ˆì±…ì„íŒ€')) {
                        team = 'í’ˆì§ˆì±…ì„íŒ€';
                    }
                    
                    deptToTeamMap[dept] = team;
                }
            });
            
            console.log('ë¶€ì„œ-ì¡°ì§ ë§¤í•‘:', deptToTeamMap);
            
            // ë‘ ë²ˆì§¸ íŒ¨ìŠ¤: ì‚¬ìš©ìë³„ ë‚ ì§œë³„ ë°ì´í„° ìˆ˜ì§‘
            data.forEach(row => {
                const name = row['ì´ë¦„'], dept = row['íšŒì‚¬ë‚´ ì´ë¦„'] || 'ë¯¸ë¶„ë¥˜';
                const dateStr = row['ë‚ ì§œ'];
                const workMins = ceoParseToMinutes(row['ì´ ê·¼ë¬´']);
                const vacationMins = ceoParseToMinutes(row['íœ´ê°€ì‹œê°„']);
                const inTime = row['ì¶œê·¼ì‹œê°'], outTime = row['í‡´ê·¼ì‹œê°'], policy = row['ê·¼ë¬´ì •ì±…'], leavePolicy = row['íœ´ê°€ì •ì±…'], holidayType = row['íœ´ì¼êµ¬ë¶„'];
                const specialNote = row['íŠ¹ì´ì‚¬í•­'] ? String(row['íŠ¹ì´ì‚¬í•­']).trim() : '';
                const isBeforeJoinDate = specialNote.includes('ì…ì‚¬ì¼ ì´ì „');
                if (!name) return;
                if (isBeforeJoinDate) return; // ì…ì‚¬ì¼ ì´ì „ ë°ì´í„°ëŠ” ëª¨ë“  ê³„ì‚°ì—ì„œ ì œì™¸
                
                const userId = `${name}_${dept}`;
                if (!users[userId]) { 
                    users[userId] = { 
                        name, 
                        dept, 
                        overMins: 0, 
                        totalMins: 0, 
                        workDays: 0,
                        missingCount: 0,
                        dailyMap: new Map() // ë‚ ì§œë³„ ë°ì´í„° ì €ì¥
                    }; 
                    if (!missingStats[name]) missingStats[name] = 0; 
                }
                
                const isOffDay = (holidayType && String(holidayType).trim() !== '');
                const isNoPolicy = !policy || String(policy).trim() === '';
                const isTimeMissing = (!inTime || String(inTime).trim() === '') || (!outTime || String(outTime).trim() === '');
                if (!isOffDay && isNoPolicy && isTimeMissing) { users[userId].missingCount++; totalMissingCount++; missingStats[name]++; }
                
                // ë‚ ì§œë³„ë¡œ ë°ì´í„° í•©ì‚°
                if (dateStr) {
                    let dateKey;
                    try {
                        const d = dateStr instanceof Date ? dateStr : new Date(dateStr);
                        dateKey = d.toISOString().split('T')[0];
                    } catch(e) {
                        dateKey = String(dateStr);
                    }
                    
                    if (!users[userId].dailyMap.has(dateKey)) {
                        users[userId].dailyMap.set(dateKey, {
                            workMins: 0,
                            vacationMins: 0,
                            hasHolidayType: false
                        });
                    }
                    
                    const dayData = users[userId].dailyMap.get(dateKey);
                    dayData.workMins += workMins;
                    dayData.vacationMins += vacationMins;
                    if (isOffDay) dayData.hasHolidayType = true;
                }
                
                // ë‚ ì§œë³„, ì‚¬ëŒë³„ë¡œ ê·¼ë¬´ì‹œê°„ í•©ì‚°
                if (!isOffDay && dateStr) {
                    try {
                        let d;
                        if (dateStr instanceof Date) {
                            d = dateStr;
                        } else if (typeof dateStr === 'string' && dateStr.includes('-')) {
                            d = new Date(dateStr);
                        } else {
                            d = new Date(dateStr);
                        }
                        const dayOfWeek = weekdays[d.getDay()];
                        const dateKey = `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
                        const personDateKey = `${name}_${dateKey}`;
                        
                        if (!dailyPersonData[personDateKey]) {
                            dailyPersonData[personDateKey] = {
                                name: name,
                                date: dateKey,
                                dayOfWeek: dayOfWeek,
                                totalMins: 0
                            };
                        }
                        dailyPersonData[personDateKey].totalMins += workMins;
                    } catch(e) {
                        console.error('ë‚ ì§œ íŒŒì‹± ì˜¤ë¥˜:', dateStr, e);
                    }
                }
            });
            
            // ì„¸ ë²ˆì§¸ íŒ¨ìŠ¤: ê° ì‚¬ìš©ìë³„ ê·¼ë¬´ì¼ ê³„ì‚° ë° ì´ˆê³¼ê·¼ë¬´ ì¬ê³„ì‚°
            Object.values(users).forEach(user => {
                let workDays = 0;
                let totalMins = 0;
                
                user.dailyMap.forEach((dayData, dateKey) => {
                    // ê·¼ë¬´ì¼ íŒë‹¨: íœ´ì¼êµ¬ë¶„ì´ ì—†ëŠ” ë‚ 
                    if (!dayData.hasHolidayType) {
                        workDays++;
                    }
                    // ì´ ê·¼ë¬´ì‹œê°„ = ì‹¤ì œ ê·¼ë¬´ + íœ´ê°€ì‹œê°„
                    totalMins += dayData.workMins + dayData.vacationMins;
                });
                
                user.workDays = workDays;
                user.totalMins = totalMins;
                
                // êµ¬ì„±ì›ìš©ê³¼ ë™ì¼í•œ ë°©ì‹: ì›” ì „ì²´ ì´í•© ê¸°ì¤€
                const stdMins = workDays * 480;
                user.overMins = Math.max(0, totalMins - stdMins);
                
                totalOverMins += user.overMins;
                
                // ë¶€ì„œë³„, ì¡°ì§ë³„ ì´ˆê³¼ê·¼ë¬´ë„ ì¬ì§‘ê³„
                if (!departments[user.dept]) departments[user.dept] = 0;
                departments[user.dept] += user.overMins;
                
                const teamCat = deptToTeamMap[user.dept] || 'ê¸°íƒ€';
                if (teamCat !== 'EXCLUDED') {
                    if (!teams[teamCat]) teams[teamCat] = 0;
                    teams[teamCat] += user.overMins;
                }
            });
            
            // í•©ì‚°ëœ ë°ì´í„°ë¥¼ weekdayDataì— ì¶”ê°€ (0ë³´ë‹¤ í° ê²½ìš°ë§Œ)
            Object.values(dailyPersonData).forEach(personDay => {
                if (personDay.totalMins > 0 && weekdayData[personDay.dayOfWeek]) {
                    weekdayData[personDay.dayOfWeek].push(personDay.totalMins);
                }
            });
            
            const weekdayLabels = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ'];
            const weekdayValues = weekdayLabels.map(day => {
                const dayData = weekdayData[day];
                if (dayData.length === 0) return 0;
                const avgMins = dayData.reduce((sum, val) => sum + val, 0) / dayData.length;
                // ë¶„ ë‹¨ìœ„ ê·¸ëŒ€ë¡œ ì €ì¥ (ë‚˜ì¤‘ì— í‘œì‹œí•  ë•Œ ì‹œê°„/ë¶„ìœ¼ë¡œ ë³€í™˜)
                return avgMins;
            });
            console.log('ìš”ì¼ë³„ ë°ì´í„° ìˆ˜:', weekdayLabels.map((day, i) => `${day}: ${weekdayData[day].length}ê°œ`));
            console.log('ìš”ì¼ë³„ í‰ê· ê°’(ë¶„):', weekdayLabels.map((day, i) => {
                const mins = weekdayValues[i];
                const hours = Math.floor(mins / 60);
                const minutes = Math.round(mins % 60);
                return `${day}: ${hours}ì‹œê°„ ${minutes}ë¶„`;
            }));
            const vacationData = getTotalVacationByMonth(currentCeoMonth);
            ceoVacationDetails = vacationData.details;
            ceoMissingDetails = Object.entries(missingStats).filter(([name, count]) => count > 0).sort((a, b) => b[1] - a[1]).map(([name, count]) => ({ name, count }));
            const userList = Object.values(users);
            document.getElementById('ceo_stat_totalPeople').innerText = `${userList.length} ëª…`;
            document.getElementById('ceo_stat_totalOver').innerText = ceoFormatHoursMinutes(totalOverMins);
            document.getElementById('ceo_stat_missingCount').innerText = `${totalMissingCount} ê±´`;
            document.getElementById('ceo_stat_totalVacation').innerText = `${vacationData.total.toFixed(1)} ì¼`;
            document.getElementById('ceoPopupNameList').innerHTML = userList.sort((a,b) => a.name.localeCompare(b.name)).map(u => `<div class="flex justify-between items-center py-2 border-b border-gray-50 hover:bg-blue-50 px-1 rounded cursor-pointer transition-colors" onclick="switchToMemberView('${u.name}', '${u.dept}', currentCeoMonth)"><span class="font-bold text-gray-700">${u.name}</span><span class="text-[10px] bg-blue-50 text-blue-600 px-2 py-0.5 rounded-full font-medium">${u.dept}</span></div>`).join('');
            const top5 = [...userList].sort((a,b) => b.overMins - a.overMins).slice(0, 5);
            document.getElementById('ceoTopList').innerHTML = top5.map((u,i) => `<div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl"><div class="flex items-center gap-3"><span class="w-7 h-7 flex items-center justify-center bg-gray-200 rounded-full text-[10px] font-bold">${i+1}</span><div><p class="text-sm font-bold text-gray-800">${u.name}</p><p class="text-[10px] text-gray-500">${u.dept}</p></div></div><div class="text-right"><p class="text-red-600 text-sm font-bold">${ceoFormatHoursMinutes(u.overMins)}</p></div></div>`).join('');
            // ì´ˆê³¼ê·¼ë¬´ê°€ 0ë³´ë‹¤ í° ë¶€ì„œë§Œ í•„í„°ë§
            const deptEntries = Object.entries(departments).filter(([dept, mins]) => mins > 0);
            const deptLabels = deptEntries.map(([dept, mins]) => dept);
            const deptValuesRaw = deptEntries.map(([dept, mins]) => mins);
            const deptTotal = deptValuesRaw.reduce((sum, v) => sum + v, 0);
            const deptValuesPercent = deptTotal > 0 ? deptValuesRaw.map(v => (v / deptTotal * 100)) : deptValuesRaw;
            const deptValues = adjustPercentsTo100(deptValuesPercent);
            
            const teamLabels = Object.keys(teams);
            const teamValuesRaw = Object.values(teams);
            const teamTotal = teamValuesRaw.reduce((sum, v) => sum + v, 0);
            const teamValuesPercent = teamTotal > 0 ? teamValuesRaw.map(v => (v / teamTotal * 100)) : teamValuesRaw;
            const teamValues = adjustPercentsTo100(teamValuesPercent);
            
            // ë¶€ì„œ-ì¡°ì§ ë§¤í•‘ì„ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥ (ì°¨íŠ¸ ìƒ‰ìƒ ë§¤í•‘ì— ì‚¬ìš©)
            currentDeptToTeamMap = deptToTeamMap;
            
            // ì¡°ì§ë³„ êµ¬ì„±ì› ë°ì´í„° êµ¬ì¶•
            ceoTeamMembersData = {};
            userList.forEach(user => {
                const team = deptToTeamMap[user.dept] || 'ê¸°íƒ€';
                if (team !== 'EXCLUDED' && user.overMins > 0) {
                    if (!ceoTeamMembersData[team]) {
                        ceoTeamMembersData[team] = [];
                    }
                    ceoTeamMembersData[team].push({
                        name: user.name,
                        dept: user.dept,
                        overMins: user.overMins
                    });
                }
            });
            
            // ê° ì¡°ì§ë³„ë¡œ ì´ˆê³¼ê·¼ë¬´ ì‹œê°„ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
            Object.keys(ceoTeamMembersData).forEach(team => {
                ceoTeamMembersData[team].sort((a, b) => b.overMins - a.overMins);
            });
            
            ceoInitCharts({ labels: deptLabels, values: deptValues }, { labels: teamLabels, values: teamValues }, { labels: weekdayLabels, values: weekdayValues });
        }

        ceoInitCharts({labels:[],values:[]},{labels:[],values:[]},{labels:[],values:[]});
        
        // ===== ê´€ë¦¬ì í˜ì´ì§€ ê¸°ëŠ¥ =====
        
        // ì´ìƒ ì—†ìŒ ì €ì¥
        function saveNoIssue(pageType) {
            const now = new Date();
            const dateStr = now.toLocaleString('ko-KR', { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit',
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });
            
            // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            let userName = 'ì•Œ ìˆ˜ ì—†ìŒ';
            let userDept = 'ì•Œ ìˆ˜ ì—†ìŒ';
            let currentMonth = '';
            
            if (pageType === 'member') {
                // êµ¬ì„±ì› í˜ì´ì§€ì—ì„œëŠ” ì„ íƒëœ ì‚¬ìš©ì ì´ë¦„
                currentMonth = currentMemberMonth;
                const selectElement = document.getElementById('memberUserSelect');
                if (selectElement && selectElement.value) {
                    const userKey = selectElement.value;
                    // userKey í˜•ì‹: "ì´ë¦„|íšŒì‚¬ë‚´ì´ë¦„"
                    const userName_raw = userKey.split('|')[0];
                    userName = userName_raw;
                    
                    // memberRawDataì—ì„œ ë¶€ì„œ ì°¾ê¸°
                    if (memberRawData && memberRawData.length > 0) {
                        const userRecord = memberRawData.find(r => r['ì´ë¦„'] === userName_raw);
                        if (userRecord) {
                            userDept = userRecord['ë¶€ì„œ'] || 'ì•Œ ìˆ˜ ì—†ìŒ';
                        }
                    }
                }
            } else if (pageType === 'ceo') {
                currentMonth = currentCeoMonth;
                userName = 'CEO';
                userDept = 'ê²½ì˜ì§€ì›íŒ€';
            }
            
            const record = {
                id: Date.now(),
                name: userName,
                dept: userDept,
                datetime: dateStr,
                month: currentMonth,
                page: pageType === 'ceo' ? 'CEO í˜ì´ì§€' : 'êµ¬ì„±ì› í˜ì´ì§€',
                timestamp: now.getTime()
            };
            
            // localStorageì— ì €ì¥
            let records = JSON.parse(localStorage.getItem('noIssueRecords') || '[]');
            records.push(record);
            localStorage.setItem('noIssueRecords', JSON.stringify(records));
            
            alert('ì´ìƒ ì—†ìŒì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤!');
        }
        
        // ê´€ë¦¬ì ë°ì´í„° ë¡œë“œ
        function loadAdminData() {
            const records = JSON.parse(localStorage.getItem('noIssueRecords') || '[]');
            
            // í†µê³„ ê³„ì‚°
            const totalCount = records.length;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const todayCount = records.filter(r => {
                const recordDate = new Date(r.timestamp);
                recordDate.setHours(0, 0, 0, 0);
                return recordDate.getTime() === today.getTime();
            }).length;
            
            const lastCheck = records.length > 0 
                ? records[records.length - 1].datetime 
                : '-';
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            document.getElementById('adminTotalCount').innerText = totalCount;
            document.getElementById('adminTodayCount').innerText = todayCount;
            document.getElementById('adminLastCheck').innerText = lastCheck;
            
            // í…Œì´ë¸” ì—…ë°ì´íŠ¸
            const tbody = document.getElementById('adminTableBody');
            if (records.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; color: #94a3b8; padding: 40px;">
                            ì•„ì§ í™•ì¸ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                `;
            } else {
                tbody.innerHTML = records
                    .sort((a, b) => b.timestamp - a.timestamp) // ìµœì‹ ìˆœ ì •ë ¬
                    .map((r, idx) => `
                        <tr>
                            <td>${records.length - idx}</td>
                            <td style="font-weight: 600;">${r.name}</td>
                            <td><span style="background: #e0f2fe; color: #0369a1; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">${r.dept}</span></td>
                            <td><span style="background: #f0fdf4; color: #15803d; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">${r.month || '-'}</span></td>
                            <td>${r.datetime}</td>
                            <td>${r.page}</td>
                            <td>
                                <button class="delete-btn" onclick="adminDeleteRecord(${r.id})">ì‚­ì œ</button>
                            </td>
                        </tr>
                    `)
                    .join('');
            }
        }
        
        // ê¸°ë¡ ì‚­ì œ
        function adminDeleteRecord(id) {
            if (!confirm('ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            let records = JSON.parse(localStorage.getItem('noIssueRecords') || '[]');
            records = records.filter(r => r.id !== id);
            localStorage.setItem('noIssueRecords', JSON.stringify(records));
            
            loadAdminData();
        }
        
        // ì „ì²´ ê¸°ë¡ ì‚­ì œ
        function adminClearAll() {
            if (!confirm('ì •ë§ë¡œ ëª¨ë“  ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) return;
            
            localStorage.removeItem('noIssueRecords');
            loadAdminData();
            alert('ëª¨ë“  ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        // ì´ˆê¸° ë¡œê·¸ì¸ ì•”í˜¸ ì…ë ¥ì°½ Enter í‚¤ ì§€ì›
        document.getElementById('passwordInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                verifyInitialPassword();
            }
        });
        
        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ ì•”í˜¸ ì…ë ¥ì°½ì— í¬ì»¤ìŠ¤
        document.getElementById('passwordInput').focus();
        
        console.log('âœ… Google Sheets ì—°ë™ ê·¼íƒœ ë¶„ì„ ì‹œìŠ¤í…œ ë¡œë“œ ì™„ë£Œ');
    </script>
</body>
</html>
