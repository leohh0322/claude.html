<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í†µí•© ê·¼íƒœ ë¶„ì„ ì‹œìŠ¤í…œ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background: #f4f7fa; }
        .view { display: none; }
        .view.active { display: block; }
        .month-tabs { display: flex; gap: 12px; margin-bottom: 30px; padding: 20px; background: white; border-radius: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); flex-wrap: wrap; }
        .month-tab { padding: 12px 24px; border-radius: 10px; background: #f1f5f9; color: #64748b; border: 2px solid transparent; cursor: pointer; font-weight: 600; transition: all 0.3s ease; font-size: 14px; }
        .month-tab:hover { background: #e2e8f0; transform: translateY(-2px); }
        .month-tab.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-color: #667eea; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
        .month-tab.loading { opacity: 0.6; cursor: wait; }
        .stat-card { transition: all 0.3s ease; position: relative; }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-card.clickable { cursor: pointer; }
        .member-list-popup { visibility: hidden; opacity: 0; position: absolute; top: calc(100% + 10px); left: 0; width: 280px; max-height: 350px; background: white; border-radius: 12px; box-shadow: 0 15px 35px rgba(0,0,0,0.2); z-index: 100; padding: 16px; border: 1px solid #e2e8f0; overflow-y: auto; transition: opacity 0.2s ease, visibility 0.2s ease; }
        .stat-card:hover .member-list-popup { visibility: visible; opacity: 1; }
        .member-list-popup::-webkit-scrollbar { width: 6px; }
        .member-list-popup::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 10px; }
        .info-card { background: #f8fafc; border-radius: 12px; padding: 20px; border-left: 4px solid #cbd5e1; transition: transform 0.2s; cursor: pointer; position: relative; }
        .info-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); background: #f1f5f9; }
        .info-card::after { content: 'ğŸ”'; position: absolute; top: 10px; right: 10px; font-size: 12px; opacity: 0.3; }
        .info-card.blue { border-left-color: #3b82f6; }
        .info-card.green { border-left-color: #10b981; }
        .info-card.red { border-left-color: #ef4444; }
        .info-card.purple { border-left-color: #8b5cf6; }
        .info-card.cyan { border-left-color: #06b6d4; }
        .label { font-size: 12px; color: #64748b; font-weight: 600; text-transform: uppercase; margin-bottom: 5px; }
        .value { font-size: 24px; font-weight: 800; color: #1e293b; }
        .sub-value { font-size: 13px; color: #94a3b8; margin-top: 4px; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(4px); }
        .modal-content { background: white; width: 90%; max-width: 800px; border-radius: 20px; padding: 30px; position: relative; max-height: 85vh; overflow-y: auto; }
        .modal-close { position: absolute; top: 20px; right: 20px; font-size: 24px; cursor: pointer; color: #64748b; }
        .modal-title { font-size: 20px; font-weight: 700; margin-bottom: 20px; color: #1e293b; border-bottom: 2px solid #f1f5f9; padding-bottom: 10px; }
        .modal-chart-wrapper { height: 350px; width: 100%; margin-bottom: 20px; }
        .modal-list-wrapper { max-height: 400px; overflow-y: auto; background: #f8fafc; border-radius: 10px; padding: 15px; }
        .modal-list-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e2e8f0; font-size: 14px; }
        .modal-list-item:last-child { border-bottom: none; }
        .nav-button { position: fixed; top: 20px; left: 20px; background: white; color: #667eea; border: none; padding: 10px 20px; border-radius: 10px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.15); transition: all 0.3s ease; z-index: 999; }
        .nav-button:hover { background: #667eea; color: white; transform: translateY(-2px); box-shadow: 0 6px 16px rgba(0,0,0,0.2); }
        select { background: white; color: #1f2937; }
        select option { color: #1f2937; background: white; }
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; }
        .loading-spinner { width: 50px; height: 50px; border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .loading-text { margin-top: 20px; font-size: 16px; color: #64748b; }
        .remain-vacation-card { background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); border-radius: 16px; padding: 24px; color: white; margin-bottom: 24px; box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3); }
        .remain-vacation-card .label { color: rgba(255, 255, 255, 0.9); font-size: 14px; margin-bottom: 8px; }
        .remain-vacation-card .value { color: white; font-size: 36px; font-weight: 900; }
        .remain-vacation-card .sub-value { color: rgba(255, 255, 255, 0.8); font-size: 14px; margin-top: 8px; }
    </style>
</head>
<body>
    <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Google Sheetsì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>

    <!-- êµ¬ì„±ì› ë·° -->
    <div id="memberView" class="view active">
        <button class="nav-button" onclick="showView('ceo')">CEOìš©ìœ¼ë¡œ ì´ë™ â†’</button>
        <div class="modal-overlay" id="memberModalOverlay">
            <div class="modal-content">
                <span class="modal-close" id="memberModalClose">&times;</span>
                <div class="modal-title" id="memberModalTitle">ìƒì„¸ ë‚´ì—­</div>
                <div class="modal-chart-wrapper"><canvas id="memberModalChart"></canvas></div>
                <div class="modal-list-wrapper" id="memberModalList"></div>
            </div>
        </div>
        <div class="p-6 md:p-10">
            <div class="max-w-7xl mx-auto bg-white rounded-2xl shadow-lg overflow-hidden">
                <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-8">
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
                        <div>
                            <h1 id="memberReportTitle" class="text-3xl font-bold mb-2">ğŸ“Š ê·¼íƒœ ì •ì‚° ë¦¬í¬íŠ¸</h1>
                            <p class="opacity-90">ì›”ë³„ íƒ­ì„ ì„ íƒí•˜ê³  êµ¬ì„±ì›ì„ ì„ íƒí•˜ì„¸ìš”</p>
                        </div>
                        <div class="flex items-center gap-4 bg-white bg-opacity-20 p-4 rounded-xl backdrop-blur-sm">
                            <select id="memberUserSelect" disabled class="px-4 py-2.5 rounded-lg border-none font-medium bg-white text-gray-800">
                                <option>ëŒ€ìƒì ì„ íƒ</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="month-tabs" id="memberMonthTabs">
                    <div class="month-tab active" data-month="9ì›”" onclick="memberSwitchMonth('9ì›”')">ğŸ“… 9ì›”</div>
                    <div class="month-tab" data-month="10ì›”" onclick="memberSwitchMonth('10ì›”')">ğŸ“… 10ì›”</div>
                    <div class="month-tab" data-month="11ì›”" onclick="memberSwitchMonth('11ì›”')">ğŸ“… 11ì›”</div>
                </div>
                <div class="p-8">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <div class="info-card blue" onclick="memberShowDetail('workDays')">
                                    <div class="label">ğŸ“… ê·¼ë¬´ì¼</div>
                                    <div class="value" id="member_val_workDays">-</div>
                                    <div class="sub-value">ì¤‘ë³µ ì œì™¸ ê·¼ë¬´ ì¼ìˆ˜</div>
                                </div>
                                <div class="info-card blue">
                                    <div class="label">â±ï¸ ê¸°ì¤€ ê·¼ë¡œì‹œê°„</div>
                                    <div class="value" id="member_val_stdHours">-</div>
                                    <div class="sub-value">ê·¼ë¬´ì¼ Ã— 8ì‹œê°„</div>
                                </div>
                                <div class="info-card purple" onclick="memberShowDetail('totalHours')">
                                    <div class="label">ğŸ’¼ ì´ ê·¼ë¬´ì‹œê°„</div>
                                    <div class="value" id="member_val_totalHours">-</div>
                                    <div class="sub-value">ì‹¤ì œ ê·¼ë¬´ í•©ê³„</div>
                                </div>
                                <div class="info-card red" onclick="memberShowDetail('overTime')">
                                    <div class="label">ğŸ”¥ ì´ˆê³¼ ê·¼ë¬´</div>
                                    <div class="value" id="member_val_overTime">-</div>
                                    <div class="sub-value">ì´ ê·¼ë¬´ - ê¸°ì¤€ ì‹œê°„</div>
                                </div>
                                <div class="info-card green" onclick="memberShowDetail('vacation')">
                                    <div class="label">ğŸ–ï¸ íœ´ê°€ ì‚¬ìš©</div>
                                    <div class="value" id="member_val_vacation">-</div>
                                    <div class="sub-value">ì´ë²ˆ ë‹¬ ì‚¬ìš©í•œ ì—°ì°¨</div>
                                </div>
                                <div class="info-card red" onclick="memberShowDetail('missing')">
                                    <div class="label">âš ï¸ ê¸°ë¡ ëˆ„ë½</div>
                                    <div class="value" id="member_val_missing">-</div>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <div class="info-card" onclick="memberShowDetail('avgIn')">
                                    <div class="label">ğŸŒ… í‰ê·  ì¶œê·¼ ì‹œê°</div>
                                    <div class="value" id="member_val_avgIn">-</div>
                                </div>
                                <div class="info-card" onclick="memberShowDetail('avgOut')">
                                    <div class="label">ğŸŒ† í‰ê·  í‡´ê·¼ ì‹œê°</div>
                                    <div class="value" id="member_val_avgOut">-</div>
                                </div>
                            </div>
                        </div>
                        <div class="lg:col-span-1">
                            <!-- ì”ì—¬ ì—°ì°¨ ì¹´ë“œ -->
                            <div class="remain-vacation-card">
                                <div class="label">ğŸ’ ì”ì—¬ ì—°ì°¨</div>
                                <div class="value" id="member_val_remainVacation">-</div>
                                <div class="sub-value">í˜„ì¬ ì‚¬ìš© ê°€ëŠ¥í•œ ì—°ì°¨</div>
                            </div>
                            
                            <!-- ê·¼ë¬´ ì‹œê°„ ë¶„ì„ ì°¨íŠ¸ -->
                            <div class="bg-gray-50 rounded-xl p-6 border border-gray-200">
                                <h3 class="text-lg font-bold text-gray-800 mb-6 text-center">ğŸ“ˆ ê·¼ë¬´ ì‹œê°„ ë¶„ì„</h3>
                                <div style="height: 320px;"><canvas id="memberWorkChart"></canvas></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CEO ë·° -->
    <div id="ceoView" class="view">
        <button class="nav-button" onclick="showView('member')">â† êµ¬ì„±ì›ìš©ìœ¼ë¡œ ì´ë™</button>
        
        <!-- CEO íœ´ê°€ ìƒì„¸ ëª¨ë‹¬ -->
        <div class="modal-overlay" id="ceoVacationModalOverlay">
            <div class="modal-content">
                <span class="modal-close" id="ceoVacationModalClose">&times;</span>
                <div class="modal-title" id="ceoVacationModalTitle">ğŸ–ï¸ íœ´ê°€ ì‚¬ìš© ìƒì„¸</div>
                <div class="modal-list-wrapper" id="ceoVacationModalList"></div>
            </div>
        </div>
        
        <!-- CEO ê·¼ë¬´ ê¸°ë¡ ëˆ„ë½ ëª¨ë‹¬ -->
        <div class="modal-overlay" id="ceoMissingModalOverlay">
            <div class="modal-content">
                <span class="modal-close" id="ceoMissingModalClose">&times;</span>
                <div class="modal-title" id="ceoMissingModalTitle">âš ï¸ ê·¼ë¬´ ê¸°ë¡ ëˆ„ë½ ìƒì„¸</div>
                <div class="modal-list-wrapper" id="ceoMissingModalList"></div>
            </div>
        </div>
        
        <div class="p-6 md:p-10">
            <div class="max-w-7xl mx-auto">
                <header class="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-6">
                    <h1 class="text-3xl font-bold text-gray-800 flex items-center gap-3">
                        <span class="bg-blue-600 p-2 rounded-lg text-white text-xl">ğŸ“Š</span>
                        ì „ì‚¬ ê·¼íƒœ ë¶„ì„ ëŒ€ì‹œë³´ë“œ
                    </h1>
                </header>
                <div class="month-tabs" id="ceoMonthTabs">
                    <div class="month-tab active" data-month="9ì›”" onclick="ceoSwitchMonth('9ì›”')">ğŸ“… 9ì›”</div>
                    <div class="month-tab" data-month="10ì›”" onclick="ceoSwitchMonth('10ì›”')">ğŸ“… 10ì›”</div>
                    <div class="month-tab" data-month="11ì›”" onclick="ceoSwitchMonth('11ì›”')">ğŸ“… 11ì›”</div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="stat-card bg-white p-6 rounded-2xl shadow-sm border border-gray-100 cursor-pointer">
                        <p class="text-sm font-medium text-gray-500 mb-1">ì´ ë¶„ì„ ì¸ì›</p>
                        <h3 id="ceo_stat_totalPeople" class="text-3xl font-bold text-gray-800">- ëª…</h3>
                        <div class="member-list-popup" id="ceoMemberPopup">
                            <p class="text-xs font-bold text-blue-600 mb-3 border-b pb-2 sticky top-0 bg-white">ë¶„ì„ëœ êµ¬ì„±ì› ëª…ë‹¨</p>
                            <div id="ceoPopupNameList" class="space-y-2 text-sm text-gray-600"></div>
                        </div>
                    </div>
                    <div class="stat-card bg-white p-6 rounded-2xl shadow-sm border border-gray-100 border-l-4 border-l-red-500">
                        <p class="text-sm font-medium text-gray-500 mb-1">ì´ ì´ˆê³¼ê·¼ë¬´ ì‹œê°„</p>
                        <h3 id="ceo_stat_totalOver" class="text-3xl font-bold text-red-600">- ì‹œê°„</h3>
                    </div>
                    <div class="stat-card clickable bg-white p-6 rounded-2xl shadow-sm border border-gray-100 border-l-4 border-l-amber-500" onclick="showCeoMissingModal()">
                        <p class="text-sm font-medium text-gray-500 mb-1">âš ï¸ ê·¼ë¬´ ê¸°ë¡ ëˆ„ë½</p>
                        <h3 id="ceo_stat_missingCount" class="text-3xl font-bold text-amber-600">- ê±´</h3>
                        <p class="text-xs text-gray-400 mt-1">í´ë¦­í•˜ì—¬ ìƒì„¸ ë³´ê¸°</p>
                    </div>
                    <div class="stat-card clickable bg-white p-6 rounded-2xl shadow-sm border border-gray-100 border-l-4 border-l-green-500" onclick="showCeoVacationModal()">
                        <p class="text-sm font-medium text-gray-500 mb-1">ğŸ–ï¸ ì´ íœ´ê°€ ì‚¬ìš©</p>
                        <h3 id="ceo_stat_totalVacation" class="text-3xl font-bold text-green-600">- ì¼</h3>
                        <p class="text-xs text-gray-400 mt-1">í´ë¦­í•˜ì—¬ ìƒì„¸ ë³´ê¸°</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                    <div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-bold text-gray-800 italic"># ì¡°ì§ë³„ ì´ˆê³¼ê·¼ë¬´ ë¹„ì¤‘</h3>
                            <span class="text-xs text-gray-400">íŒ€ ë‹¨ìœ„ í•©ê³„</span>
                        </div>
                        <div class="h-[300px] flex items-center justify-center"><canvas id="ceoTeamChart"></canvas></div>
                    </div>
                    <div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-bold text-gray-800 italic"># ì¸ì›ë³„ ì´ˆê³¼ê·¼ë¬´ ë¹„ì¤‘</h3>
                            <span class="text-xs text-gray-400">ì „ì²´ ëŒ€ë¹„ ì ìœ ìœ¨</span>
                        </div>
                        <div class="h-[300px] flex items-center justify-center"><canvas id="ceoDeptChart"></canvas></div>
                    </div>
                    <div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-bold text-gray-800 mb-6 italic"># ì´ˆê³¼ê·¼ë¬´ Top 5 êµ¬ì„±ì›</h3>
                        <div id="ceoTopList" class="space-y-4"></div>
                    </div>
                </div>
                <div class="grid grid-cols-1 gap-8">
                    <div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-bold text-gray-800 mb-6 italic"># ìš”ì¼ë³„ ê·¼ë¬´ ê°•ë„ ì¶”ì´</h3>
                        <div class="h-[300px]"><canvas id="ceoTrendChart"></canvas></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== Google Sheets URL ì„¤ì • =====
        const SHEET_URLS = {
            '9ì›”': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTxBvVil1szQqCeFl2qOVYnSSK16ZtlRlUji8sTtdgzAKLa4M73ngCHPHh2oewE-GAP5VQLsLV8f_wT/pub?gid=1760267560&single=true&output=csv',
            '10ì›”': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTxBvVil1szQqCeFl2qOVYnSSK16ZtlRlUji8sTtdgzAKLa4M73ngCHPHh2oewE-GAP5VQLsLV8f_wT/pub?gid=1965095219&single=true&output=csv',
            '11ì›”': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTxBvVil1szQqCeFl2qOVYnSSK16ZtlRlUji8sTtdgzAKLa4M73ngCHPHh2oewE-GAP5VQLsLV8f_wT/pub?gid=0&single=true&output=csv',
            'ì—°ì°¨': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTxBvVil1szQqCeFl2qOVYnSSK16ZtlRlUji8sTtdgzAKLa4M73ngCHPHh2oewE-GAP5VQLsLV8f_wT/pub?gid=1588070847&single=true&output=csv'
        };

        const DATA_CACHE = {};
        let VACATION_DATA = [];
        let currentMemberMonth = '9ì›”', currentCeoMonth = '9ì›”';
        let ceoVacationDetails = [];
        let ceoMissingDetails = [];
        let selectedUserKey = null;

        async function loadSheetData(key) {
            if (DATA_CACHE[key]) return DATA_CACHE[key];
            const url = SHEET_URLS[key];
            if (!url) return [];
            try {
                const response = await fetch(url);
                const csvText = await response.text();
                return new Promise((resolve) => {
                    Papa.parse(csvText, {
                        header: true,
                        skipEmptyLines: true,
                        complete: (results) => { DATA_CACHE[key] = results.data; resolve(results.data); }
                    });
                });
            } catch (error) { console.error(`${key} ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:`, error); return []; }
        }

        function getVacationInfo(name, month) {
            const monthCol = month;
            const userRow = VACATION_DATA.find(row => row['ì´ë¦„'] === name);
            if (!userRow) return { used: 0, remain: 0 };
            return { used: parseFloat(userRow[monthCol]) || 0, remain: parseFloat(userRow['ì”ì—¬ ì—°ì°¨']) || 0 };
        }

        function getTotalVacationByMonth(month) {
            const monthCol = month;
            let total = 0;
            const details = [];
            VACATION_DATA.forEach(row => {
                const name = row['ì´ë¦„'], used = parseFloat(row[monthCol]) || 0;
                if (name && used > 0) { total += used; details.push({ name, used }); }
            });
            details.sort((a, b) => b.used - a.used);
            return { total, details };
        }

        async function initializeData() {
            document.getElementById('loadingOverlay').style.display = 'flex';
            try {
                VACATION_DATA = await loadSheetData('ì—°ì°¨');
                await loadSheetData('9ì›”');
                memberLoadMonth('9ì›”');
            } catch (error) { console.error('ì´ˆê¸° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error); }
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        function showView(v) {
            document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
            if (v === 'member') { document.getElementById('memberView').classList.add('active'); memberLoadMonth(currentMemberMonth); }
            else if (v === 'ceo') { document.getElementById('ceoView').classList.add('active'); ceoLoadMonth(currentCeoMonth); }
        }

        function showCeoVacationModal() {
            const overlay = document.getElementById('ceoVacationModalOverlay');
            const title = document.getElementById('ceoVacationModalTitle');
            const list = document.getElementById('ceoVacationModalList');
            title.innerText = `ğŸ–ï¸ ${currentCeoMonth} íœ´ê°€ ì‚¬ìš© ìƒì„¸`;
            list.innerHTML = ceoVacationDetails.length === 0 
                ? '<div class="text-center text-gray-400 py-4">íœ´ê°€ ì‚¬ìš© ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>'
                : ceoVacationDetails.map((item, idx) => `<div class="modal-list-item"><span class="flex items-center gap-2"><span class="w-6 h-6 flex items-center justify-center bg-green-100 text-green-600 rounded-full text-xs font-bold">${idx + 1}</span><span class="font-medium">${item.name}</span></span><span class="text-green-600 font-bold">${item.used}ì¼</span></div>`).join('');
            overlay.style.display = 'flex';
        }

        function showCeoMissingModal() {
            const overlay = document.getElementById('ceoMissingModalOverlay');
            const title = document.getElementById('ceoMissingModalTitle');
            const list = document.getElementById('ceoMissingModalList');
            title.innerText = `âš ï¸ ${currentCeoMonth} ê·¼ë¬´ ê¸°ë¡ ëˆ„ë½ ìƒì„¸`;
            list.innerHTML = ceoMissingDetails.length === 0 
                ? '<div class="text-center text-gray-400 py-4">ê·¼ë¬´ ê¸°ë¡ ëˆ„ë½ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>'
                : ceoMissingDetails.map((item, idx) => `<div class="modal-list-item"><span class="flex items-center gap-2"><span class="w-6 h-6 flex items-center justify-center bg-amber-100 text-amber-600 rounded-full text-xs font-bold">${idx + 1}</span><span class="font-medium">${item.name}</span></span><span class="text-amber-600 font-bold">${item.count}íšŒ</span></div>`).join('');
            overlay.style.display = 'flex';
        }

        document.getElementById('ceoVacationModalClose').onclick = () => document.getElementById('ceoVacationModalOverlay').style.display = 'none';
        document.getElementById('ceoMissingModalClose').onclick = () => document.getElementById('ceoMissingModalOverlay').style.display = 'none';
        window.addEventListener('click', (e) => {
            if (e.target === document.getElementById('ceoVacationModalOverlay')) document.getElementById('ceoVacationModalOverlay').style.display = 'none';
            if (e.target === document.getElementById('ceoMissingModalOverlay')) document.getElementById('ceoMissingModalOverlay').style.display = 'none';
        });

        // ===== êµ¬ì„±ì› ë·° =====
        let memberRawData = [], memberMyChart = null, memberModalChart = null, memberCurrentCalculatedData = null;

        async function memberSwitchMonth(m) {
            currentMemberMonth = m;
            document.querySelectorAll('#memberMonthTabs .month-tab').forEach(t => { t.classList.remove('active'); t.classList.add('loading'); });
            document.querySelector(`#memberMonthTabs .month-tab[data-month="${m}"]`).classList.add('active');
            await memberLoadMonth(m);
            document.querySelectorAll('#memberMonthTabs .month-tab').forEach(t => t.classList.remove('loading'));
        }

        async function memberLoadMonth(m) {
            memberRawData = await loadSheetData(m);
            if (!memberRawData.length) return;
            const userSet = new Set(), uniqueUsers = [];
            memberRawData.forEach(r => {
                const name = r['ì´ë¦„'], compName = r['íšŒì‚¬ë‚´ ì´ë¦„'] || '';
                if (name) { const key = `${name}|${compName}`; if (!userSet.has(key)) { userSet.add(key); uniqueUsers.push({ key, displayName: compName ? `${name} (${compName})` : name }); } }
            });
            const sel = document.getElementById('memberUserSelect');
            sel.innerHTML = '<option value="">ëŒ€ìƒì ì„ íƒ</option>';
            uniqueUsers.sort((a,b) => a.displayName.localeCompare(b.displayName)).forEach(u => { const o = document.createElement('option'); o.value = u.key; o.text = u.displayName; sel.appendChild(o); });
            sel.disabled = false;
            if (selectedUserKey && uniqueUsers.some(u => u.key === selectedUserKey)) { sel.value = selectedUserKey; memberUpdateUI(memberCalculateData(selectedUserKey)); }
            else if (uniqueUsers.length > 0) { selectedUserKey = uniqueUsers[0].key; sel.value = selectedUserKey; memberUpdateUI(memberCalculateData(selectedUserKey)); }
        }

        function memberFormatMinutes(mins, style = 'text') {
            if (!mins || mins === Infinity || mins === -Infinity) return '-';
            const h = Math.floor(mins / 60), m = Math.round(mins % 60);
            return style === 'colon' ? `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}` : `${h}ì‹œê°„ ${m}ë¶„`;
        }

        function memberParseToMinutes(val) {
            if (!val) return 0;
            if (typeof val === 'number') return Math.round(val * 24 * 60);
            if (typeof val === 'string') { const p = val.trim().split(':'); if (p.length >= 2) return parseInt(p[0]) * 60 + parseInt(p[1]); }
            return 0;
        }

        function memberFormatDaysToText(days) {
            if (!days || days === 0) return '0ì¼';
            const fullDays = Math.floor(days);
            const remainingHours = Math.round((days - fullDays) * 8);
            if (fullDays === 0) {
                return `${remainingHours}ì‹œê°„`;
            } else if (remainingHours === 0) {
                return `${fullDays}ì¼`;
            } else {
                return `${fullDays}ì¼ ${remainingHours}ì‹œê°„`;
            }
        }

        function memberInitChart(data = null) {
            const ctx = document.getElementById('memberWorkChart').getContext('2d');
            if (memberMyChart) memberMyChart.destroy();
            const d = data ? [data.stdHours, data.totalHours, data.overHours, data.vacationHours] : [0,0,0,0];
            memberMyChart = new Chart(ctx, {
                type: 'bar',
                data: { labels: ['ê¸°ì¤€ê·¼ë¡œ', 'ì´ ê·¼ë¬´', 'ì´ˆê³¼ ê·¼ë¬´', 'íœ´ê°€ ì‚¬ìš©'], datasets: [{ label: 'ì‹œê°„', data: d, backgroundColor: ['#94a3b8', '#8b5cf6', '#ef4444', '#10b981'], borderRadius: 6, barThickness: 50 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { callbacks: { label: c => ` ${c.parsed.y.toFixed(1)} ì‹œê°„` } } }, scales: { y: { beginAtZero: true, grid: { color: '#f1f5f9' } }, x: { grid: { display: false } } } }
            });
        }

        function memberCalculateData(key) {
            const [targetName, targetCompName] = key.split('|');
            const userRows = memberRawData.filter(r => r['ì´ë¦„'] === targetName && (r['íšŒì‚¬ë‚´ ì´ë¦„'] || '') === targetCompName);
            if (!userRows.length) return null;
            const dailyMap = new Map();
            userRows.forEach(row => {
                let dateStr = row['ë‚ ì§œ'] || 'ì•Œ ìˆ˜ ì—†ìŒ';
                if (typeof dateStr === 'string' && dateStr.includes('-')) { try { const d = new Date(dateStr); dateStr = `${d.getMonth()+1}/${d.getDate()}`; } catch(e) {} }
                const total = memberParseToMinutes(row['ì´ ê·¼ë¬´']), vacation = memberParseToMinutes(row['íœ´ê°€ì‹œê°„']);
                let inTime = memberParseToMinutes(row['ì¶œê·¼ì‹œê°']), outTime = memberParseToMinutes(row['í‡´ê·¼ì‹œê°']);
                const isWorkDay = !!row['ê·¼ë¬´ì •ì±…'], isMissing = !row['ê·¼ë¬´ì •ì±…'] && !row['íœ´ê°€ì •ì±…'] && !row['íœ´ì¼êµ¬ë¶„'];
                if (!dailyMap.has(dateStr)) dailyMap.set(dateStr, { date: dateStr, total: 0, vacation: 0, in: inTime > 0 ? inTime : Infinity, out: outTime > 0 ? outTime : -Infinity, isWorkDay: false, isMissing: true, policies: [] });
                const day = dailyMap.get(dateStr);
                day.total += total; day.vacation += vacation;
                if (isWorkDay) { day.isWorkDay = true; day.isMissing = false; if (row['ê·¼ë¬´ì •ì±…']) day.policies.push(row['ê·¼ë¬´ì •ì±…']); }
                if (row['íœ´ê°€ì •ì±…'] || row['íœ´ì¼êµ¬ë¶„']) day.isMissing = false;
                if (inTime > 0 && inTime < day.in) day.in = inTime;
                if (outTime > 0 && outTime > day.out) day.out = outTime;
            });
            let workDays = 0, totalMins = 0, vacationMins = 0, clockInSum = 0, clockOutSum = 0, clockInCount = 0, clockOutCount = 0, dayByDay = [];
            dailyMap.forEach(day => {
                const finalIn = day.in === Infinity ? 0 : day.in, finalOut = day.out === -Infinity ? 0 : day.out;
                if (day.isWorkDay) workDays++;
                totalMins += day.total; vacationMins += day.vacation;
                if (finalIn > 0) { clockInSum += finalIn; clockInCount++; }
                if (finalOut > 0) { clockOutSum += finalOut; clockOutCount++; }
                dayByDay.push({ date: day.date, total: day.total, vacation: day.vacation, over: Math.max(0, day.total - 480), in: finalIn, out: finalOut, isWorkDay: day.isWorkDay, isMissing: day.isMissing, policy: [...new Set(day.policies)].join(', ') });
            });
            const stdMins = workDays * 480, overMins = Math.max(0, totalMins - stdMins);
            const avgIn = clockInCount > 0 ? clockInSum / clockInCount : 0, avgOut = clockOutCount > 0 ? clockOutSum / clockOutCount : 0;
            const vacationInfo = getVacationInfo(targetName, currentMemberMonth);
            memberCurrentCalculatedData = {
                name: targetCompName ? `${targetName} (${targetCompName})` : targetName, realName: targetName, dayByDay, workDays,
                stdHoursRaw: stdMins / 60, totalHoursRaw: totalMins / 60, overHoursRaw: overMins / 60, vacationHoursRaw: vacationMins / 60,
                vacationUsed: vacationInfo.used, vacationRemain: vacationInfo.remain,
                display: { workDays: `${workDays}ì¼`, stdHours: memberFormatMinutes(stdMins), totalHours: memberFormatMinutes(totalMins), overTime: memberFormatMinutes(overMins), vacation: memberFormatDaysToText(vacationInfo.used), remainVacation: memberFormatDaysToText(vacationInfo.remain), avgIn: avgIn > 0 ? memberFormatMinutes(avgIn, 'colon') : '-', avgOut: avgOut > 0 ? memberFormatMinutes(avgOut, 'colon') : '-', missing: `${dayByDay.filter(d => d.isMissing).length}ê±´` }
            };
            return memberCurrentCalculatedData;
        }

        function memberShowDetail(type) {
            if (!memberCurrentCalculatedData) return;
            const overlay = document.getElementById('memberModalOverlay'), title = document.getElementById('memberModalTitle'), list = document.getElementById('memberModalList'), ctx = document.getElementById('memberModalChart').getContext('2d');
            overlay.style.display = 'flex'; list.innerHTML = '';
            if (memberModalChart) memberModalChart.destroy();
            const labels = memberCurrentCalculatedData.dayByDay.map(d => d.date);
            let cfg = { type: 'bar', data: { labels, datasets: [] }, options: { responsive: true, maintainAspectRatio: false, plugins: { tooltip: { callbacks: { label: c => { const v = c.parsed.y; if (v === null) return null; if (type === 'avgIn' || type === 'avgOut') return ` ì‹œê°: ${memberFormatMinutes(v, 'colon')}`; if (type === 'missing' || type === 'workDays') return v === 1 ? ' í•´ë‹¹í•¨' : ' í•´ë‹¹ì—†ìŒ'; return ` ì‹œê°„: ${memberFormatMinutes(v)}`; } } } } } };
            switch(type) {
                case 'workDays': title.innerText = 'ğŸ“… í†µí•© ê·¼ë¬´ ì¼ì ìƒì„¸'; memberCurrentCalculatedData.dayByDay.filter(d => d.isWorkDay).forEach(d => { list.innerHTML += `<div class="modal-list-item"><span>${d.date}</span><span>${d.policy}</span></div>`; }); cfg.data.datasets.push({ label: 'ê·¼ë¬´ ì—¬ë¶€', data: memberCurrentCalculatedData.dayByDay.map(d => d.isWorkDay ? 1 : 0), backgroundColor: '#3b82f6' }); cfg.options.scales = { y: { display: false } }; break;
                case 'totalHours': title.innerText = 'ğŸ’¼ ì¼ìë³„ ê·¼ë¬´ ì‹œê°„'; cfg.data.datasets.push({ label: 'ë¶„', data: memberCurrentCalculatedData.dayByDay.map(d => d.total), backgroundColor: '#8b5cf6' }); memberCurrentCalculatedData.dayByDay.forEach(d => { if (d.total > 0) list.innerHTML += `<div class="modal-list-item"><span>${d.date}</span><span>${memberFormatMinutes(d.total)}</span></div>`; }); break;
                case 'overTime': title.innerText = 'ğŸ”¥ ì¼ìë³„ ì´ˆê³¼ ê·¼ë¬´'; cfg.data.datasets.push({ label: 'ë¶„', data: memberCurrentCalculatedData.dayByDay.map(d => d.over), backgroundColor: '#ef4444' }); memberCurrentCalculatedData.dayByDay.forEach(d => { if (d.over > 0) list.innerHTML += `<div class="modal-list-item"><span>${d.date}</span><span>${memberFormatMinutes(d.over)}</span></div>`; }); break;
                case 'vacation': title.innerText = 'ğŸ–ï¸ íœ´ê°€ ì‚¬ìš© ìƒì„¸'; memberCurrentCalculatedData.dayByDay.filter(d => d.vacation > 0).forEach(d => { list.innerHTML += `<div class="modal-list-item"><span>${d.date}</span><span>${memberFormatMinutes(d.vacation)}</span></div>`; }); cfg.data.datasets.push({ label: 'ë¶„', data: memberCurrentCalculatedData.dayByDay.map(d => d.vacation), backgroundColor: '#10b981' }); break;
                case 'missing': title.innerText = 'âš ï¸ ê¸°ë¡ ëˆ„ë½ ì¼ì'; cfg.data.datasets.push({ label: 'ëˆ„ë½', data: memberCurrentCalculatedData.dayByDay.map(d => d.isMissing ? 1 : 0), backgroundColor: '#ef4444' }); cfg.options.scales = { y: { display: false } }; memberCurrentCalculatedData.dayByDay.filter(d => d.isMissing).forEach(d => { list.innerHTML += `<div class="modal-list-item" style="color:#ef4444"><span>${d.date}</span><span>ê¸°ë¡ ì—†ìŒ</span></div>`; }); break;
                case 'avgIn': title.innerText = 'ğŸŒ… ì¼ìë³„ ì¶œê·¼ ì‹œê°'; cfg.type = 'line'; cfg.data.datasets.push({ label: 'ì¶œê·¼', data: memberCurrentCalculatedData.dayByDay.map(d => d.in > 0 ? d.in : null), borderColor: '#3b82f6', pointBackgroundColor: '#3b82f6', tension: 0.3, spanGaps: true }); cfg.options.scales = { y: { ticks: { callback: v => memberFormatMinutes(v, 'colon') } } }; memberCurrentCalculatedData.dayByDay.filter(d => d.in > 0).forEach(d => { list.innerHTML += `<div class="modal-list-item"><span>${d.date}</span><span>${memberFormatMinutes(d.in, 'colon')}</span></div>`; }); break;
                case 'avgOut': title.innerText = 'ğŸŒ† ì¼ìë³„ í‡´ê·¼ ì‹œê°'; cfg.type = 'line'; cfg.data.datasets.push({ label: 'í‡´ê·¼', data: memberCurrentCalculatedData.dayByDay.map(d => d.out > 0 ? d.out : null), borderColor: '#8b5cf6', pointBackgroundColor: '#8b5cf6', tension: 0.3, spanGaps: true }); cfg.options.scales = { y: { ticks: { callback: v => memberFormatMinutes(v, 'colon') } } }; memberCurrentCalculatedData.dayByDay.filter(d => d.out > 0).forEach(d => { list.innerHTML += `<div class="modal-list-item"><span>${d.date}</span><span>${memberFormatMinutes(d.out, 'colon')}</span></div>`; }); break;
            }
            memberModalChart = new Chart(ctx, cfg);
        }

        function memberUpdateUI(result) {
            if (!result) return;
            document.getElementById('memberReportTitle').innerText = `ğŸ“Š [${result.name}]ë‹˜ ê·¼íƒœ ì •ì‚° ë¦¬í¬íŠ¸ (${currentMemberMonth})`;
            document.getElementById('member_val_workDays').innerText = result.display.workDays;
            document.getElementById('member_val_stdHours').innerText = result.display.stdHours;
            document.getElementById('member_val_totalHours').innerText = result.display.totalHours;
            document.getElementById('member_val_overTime').innerText = result.display.overTime;
            document.getElementById('member_val_vacation').innerText = result.display.vacation;
            document.getElementById('member_val_remainVacation').innerText = result.display.remainVacation;
            document.getElementById('member_val_missing').innerText = result.display.missing;
            document.getElementById('member_val_avgIn').innerText = result.display.avgIn;
            document.getElementById('member_val_avgOut').innerText = result.display.avgOut;
            memberInitChart({ stdHours: result.stdHoursRaw, totalHours: result.totalHoursRaw, overHours: result.overHoursRaw, vacationHours: result.vacationUsed * 8 });
        }

        document.getElementById('memberUserSelect').addEventListener('change', e => { if (e.target.value) { selectedUserKey = e.target.value; memberUpdateUI(memberCalculateData(e.target.value)); } });
        document.getElementById('memberModalClose').onclick = () => document.getElementById('memberModalOverlay').style.display = 'none';
        window.onclick = e => { if (e.target == document.getElementById('memberModalOverlay')) document.getElementById('memberModalOverlay').style.display = 'none'; };
        memberInitChart();

        // ===== CEO ë·° =====
        let ceoRawData = [], ceoDeptChart = null, ceoTeamChart = null, ceoTrendChart = null;

        async function ceoSwitchMonth(m) {
            currentCeoMonth = m;
            document.querySelectorAll('#ceoMonthTabs .month-tab').forEach(t => { t.classList.remove('active'); t.classList.add('loading'); });
            document.querySelector(`#ceoMonthTabs .month-tab[data-month="${m}"]`).classList.add('active');
            await ceoLoadMonth(m);
            document.querySelectorAll('#ceoMonthTabs .month-tab').forEach(t => t.classList.remove('loading'));
        }

        async function ceoLoadMonth(m) { ceoRawData = await loadSheetData(m); if (ceoRawData.length) ceoProcessExcel(ceoRawData); }

        function ceoParseToMinutes(val) {
            if (!val) return 0;
            if (typeof val === 'number') return Math.round(val * 24 * 60);
            if (typeof val === 'string') { const p = val.trim().split(':'); if (p.length >= 2) return parseInt(p[0]) * 60 + parseInt(p[1]); }
            return 0;
        }

        function ceoFormatHours(mins) { return (mins / 60).toFixed(1); }

        function ceoGetTeamCategory(name) {
            if (!name) return 'ê¸°íƒ€';
            const n = name.trim();
            if (n.includes('CEO')) return 'EXCLUDED';
            if (n === 'ê°œë°œíŒ€' || n === 'ê°œë°œíŒ€ì¥' || n === 'CTO') return 'ê°œë°œíŒ€';
            if (n === 'ê²½ì˜ì§€ì›íŒ€' || n === 'ê²½ì˜ì§€ì›íŒ€ì¥') return 'ê²½ì˜ì§€ì›íŒ€';
            if (n === 'ê¸°íš1íŒ€' || n === 'ê¸°íš1íŒ€ì¥') return 'ê¸°íš1íŒ€';
            if (n === 'ê¸°íš2íŒ€' || n === 'COO, ê¸°íš2íŒ€ì¥') return 'ê¸°íš2íŒ€';
            if (n === 'ë©”ë””ì»¬íŒ€' || n === 'ë©”ë””ì»¬íŒ€ì¥') return 'ë©”ë””ì»¬íŒ€';
            if (n === 'í’ˆì§ˆì±…ì„íŒ€ì¥' || n === 'í’ˆì§ˆì±…ì„íŒ€') return 'í’ˆì§ˆì±…ì„íŒ€';
            return 'ê¸°íƒ€';
        }

        function ceoInitCharts(deptData, teamData, trendData) {
            const ctxDept = document.getElementById('ceoDeptChart').getContext('2d');
            if (ceoDeptChart) ceoDeptChart.destroy();
            ceoDeptChart = new Chart(ctxDept, { type: 'doughnut', data: { labels: deptData.labels, datasets: [{ data: deptData.values, backgroundColor: ['#3b82f6','#10b981','#f59e0b','#ef4444','#8b5cf6','#6366f1','#94a3b8'], borderWidth: 0, hoverOffset: 20 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { usePointStyle: true, padding: 15, font: { size: 10 } } } }, cutout: '65%' } });
            const ctxTeam = document.getElementById('ceoTeamChart').getContext('2d');
            if (ceoTeamChart) ceoTeamChart.destroy();
            ceoTeamChart = new Chart(ctxTeam, { type: 'pie', data: { labels: teamData.labels, datasets: [{ data: teamData.values, backgroundColor: ['#2563eb','#10b981','#f59e0b','#ef4444','#8b5cf6','#6366f1','#475569'], borderWidth: 2, borderColor: '#fff' }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { usePointStyle: true, padding: 15, font: { size: 11, weight: 'bold' } } } } } });
            const ctxTrend = document.getElementById('ceoTrendChart').getContext('2d');
            if (ceoTrendChart) ceoTrendChart.destroy();
            ceoTrendChart = new Chart(ctxTrend, { type: 'bar', data: { labels: trendData.labels, datasets: [{ label: 'ìš”ì¼ë³„ í‰ê·  ê·¼ë¬´ì‹œê°„ (h)', data: trendData.values, backgroundColor: '#3b82f6', borderRadius: 6, barThickness: 50 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, grid: { color: '#f1f5f9' } }, x: { grid: { display: false } } } } });
        }

        function ceoProcessExcel(data) {
            const users = {}, departments = {}, teams = {}, weekdayTrend = {}, missingStats = {};
            const weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            const weekdayData = { 'ì›”': [], 'í™”': [], 'ìˆ˜': [], 'ëª©': [], 'ê¸ˆ': [], 'í† ': [], 'ì¼': [] };
            let totalOverMins = 0, totalMissingCount = 0;
            data.forEach(row => {
                const name = row['ì´ë¦„'], dept = row['íšŒì‚¬ë‚´ ì´ë¦„'] || 'ë¯¸ë¶„ë¥˜';
                const dateStr = row['ë‚ ì§œ'];
                const workMins = ceoParseToMinutes(row['ì´ ê·¼ë¬´']);
                const inTime = row['ì¶œê·¼ì‹œê°'], outTime = row['í‡´ê·¼ì‹œê°'], policy = row['ê·¼ë¬´ì •ì±…'], leavePolicy = row['íœ´ê°€ì •ì±…'], holidayType = row['íœ´ì¼êµ¬ë¶„'];
                if (!name) return;
                const userId = `${name}_${dept}`;
                if (!users[userId]) { users[userId] = { name, dept, overMins: 0, totalMins: 0, missingCount: 0 }; if (!missingStats[name]) missingStats[name] = 0; }
                const isOffDay = (leavePolicy && String(leavePolicy).trim() !== '') || (holidayType && String(holidayType).trim() !== '') || (holidayType === 'íœ´ë¬´ì¼') || (holidayType === 'ì£¼íœ´ì¼');
                const isNoPolicy = !policy || String(policy).trim() === '';
                const isTimeMissing = (!inTime || String(inTime).trim() === '') || (!outTime || String(outTime).trim() === '');
                if (!isOffDay && isNoPolicy && isTimeMissing) { users[userId].missingCount++; totalMissingCount++; missingStats[name]++; }
                const dayOver = Math.max(0, workMins - 480);
                users[userId].overMins += dayOver; users[userId].totalMins += workMins;
                if (!departments[dept]) departments[dept] = 0; departments[dept] += dayOver;
                const teamCat = ceoGetTeamCategory(row['ì¡°ì§']);
                if (teamCat !== 'EXCLUDED') { if (!teams[teamCat]) teams[teamCat] = 0; teams[teamCat] += dayOver; }
                if (!isOffDay && dateStr && typeof dateStr === 'string' && dateStr.includes('-')) {
                    try {
                        const d = new Date(dateStr);
                        const dayOfWeek = weekdays[d.getDay()];
                        if (weekdayData[dayOfWeek]) {
                            weekdayData[dayOfWeek].push(workMins);
                        }
                    } catch(e) {}
                }
                totalOverMins += dayOver;
            });
            const weekdayLabels = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'];
            const weekdayValues = weekdayLabels.map(day => {
                const dayData = weekdayData[day];
                if (dayData.length === 0) return 0;
                const avg = dayData.reduce((sum, val) => sum + val, 0) / dayData.length;
                return ceoFormatHours(avg);
            });
            const vacationData = getTotalVacationByMonth(currentCeoMonth);
            ceoVacationDetails = vacationData.details;
            ceoMissingDetails = Object.entries(missingStats).filter(([name, count]) => count > 0).sort((a, b) => b[1] - a[1]).map(([name, count]) => ({ name, count }));
            const userList = Object.values(users);
            document.getElementById('ceo_stat_totalPeople').innerText = `${userList.length} ëª…`;
            document.getElementById('ceo_stat_totalOver').innerText = `${ceoFormatHours(totalOverMins)} h`;
            document.getElementById('ceo_stat_missingCount').innerText = `${totalMissingCount} ê±´`;
            document.getElementById('ceo_stat_totalVacation').innerText = `${vacationData.total.toFixed(1)} ì¼`;
            document.getElementById('ceoPopupNameList').innerHTML = userList.sort((a,b) => a.name.localeCompare(b.name)).map(u => `<div class="flex justify-between items-center py-2 border-b border-gray-50 hover:bg-gray-50 px-1 rounded"><span class="font-bold text-gray-700">${u.name}</span><span class="text-[10px] bg-blue-50 text-blue-600 px-2 py-0.5 rounded-full font-medium">${u.dept}</span></div>`).join('');
            const top5 = [...userList].sort((a,b) => b.overMins - a.overMins).slice(0, 5);
            document.getElementById('ceoTopList').innerHTML = top5.map((u,i) => `<div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl"><div class="flex items-center gap-3"><span class="w-7 h-7 flex items-center justify-center bg-gray-200 rounded-full text-[10px] font-bold">${i+1}</span><div><p class="text-sm font-bold text-gray-800">${u.name}</p><p class="text-[10px] text-gray-500">${u.dept}</p></div></div><div class="text-right"><p class="text-red-600 text-sm font-bold">${ceoFormatHours(u.overMins)}h</p></div></div>`).join('');
            const deptLabels = Object.keys(departments), deptValues = Object.values(departments).map(v => ceoFormatHours(v));
            const teamLabels = Object.keys(teams), teamValues = Object.values(teams).map(v => ceoFormatHours(v));
            ceoInitCharts({ labels: deptLabels, values: deptValues }, { labels: teamLabels, values: teamValues }, { labels: weekdayLabels, values: weekdayValues });
        }

        ceoInitCharts({labels:[],values:[]},{labels:[],values:[]},{labels:[],values:[]});
        initializeData();
        console.log('âœ… Google Sheets ì—°ë™ ê·¼íƒœ ë¶„ì„ ì‹œìŠ¤í…œ ë¡œë“œ ì™„ë£Œ');
    </script>
</body>
</html>
